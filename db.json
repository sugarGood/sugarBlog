{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.css","path":"fancybox/jquery.fancybox.min.css","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.js","path":"fancybox/jquery.fancybox.min.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/js/jquery-3.4.1.min.js","path":"js/jquery-3.4.1.min.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/js/script.js","path":"js/script.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff2","path":"css/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":1,"renderable":1},{"_id":"themes/pure/source/favicon.png","path":"favicon.png","modified":0,"renderable":1},{"_id":"themes/pure/source/css/style.css","path":"css/style.css","modified":0,"renderable":1},{"_id":"themes/pure/source/css/style.min.css","path":"css/style.min.css","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.svg","path":"fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.eot","path":"fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/README.md","path":"fonts/README.md","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.ttf","path":"fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/pure/source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.woff","path":"fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/pure/source/images/thumb-default.png","path":"images/thumb-default.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/xingqiu-qrcode.jpg","path":"images/xingqiu-qrcode.jpg","modified":0,"renderable":1},{"_id":"themes/pure/source/js/application.js","path":"js/application.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.js","path":"js/plugin.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/application.min.js","path":"js/application.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.js.map","path":"js/plugin.js.map","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.min.js","path":"js/plugin.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/images/donate/wechatpayimg.png","path":"images/donate/wechatpayimg.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/donate/alipayimg.png","path":"images/donate/alipayimg.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/SzsFox-logo.png","path":"images/favatar/SzsFox-logo.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/idesign-logo.png","path":"images/favatar/idesign-logo.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/chuangzaoshi-logo.png","path":"images/favatar/chuangzaoshi-logo.png","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"acad91ace80b80295b11a9b7ad4c29a2dcfdd8fb","modified":1683728201007},{"_id":"node_modules/hexo-theme-landscape/package.json","hash":"9a94875cbf4c27fbe2e63da0496242addc6d2876","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/_config.yml","hash":"b608c1f1322760dce9805285a602a95832730a2e","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/README.md","hash":"d2772ece6d4422ccdaa0359c3e07588834044052","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/en.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/hu.yml","hash":"284d557130bf54a74e7dcef9d42096130e4d9550","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/it.yml","hash":"89b7d91306b2c1a0f3ac023b657bf974f798a1e8","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/mn.yml","hash":"2e7523951072a9403ead3840ad823edd1084c116","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/tr.yml","hash":"a1cdbfa17682d7a971de8ab8588bf57c74224b5b","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/scripts/fancybox.js","hash":"c857d7a5e4a5d71c743a009c5932bf84229db428","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/languages/zh-CN.yml","hash":"1efd95774f401c80193eac6ee3f1794bfe93dc5a","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/js/script.js","hash":"998ed4c5b147e1299bf62beebf33514474f28112","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/layout.ejs","hash":"0d1765036e4874500e68256fedb7470e96eeb6ee","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/style.styl","hash":"9c451e5efd72c5bb8b56e8c2b94be731e99db05b","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_variables.styl","hash":"581b0cbefdaa5f894922133989dd2d3bf71ded79","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/footer.ejs","hash":"3656eb692254346671abc03cb3ba1459829e0dce","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/article.ejs","hash":"dfd555c00e85ffc4207c88968d12b219c1f086ec","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive.ejs","hash":"7cb70a7a54f8c7ae49b10d1f37c0a9b74eab8826","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/after-footer.ejs","hash":"414914ebb159fac1922b056b905e570ac7521925","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/gauges-analytics.ejs","hash":"21a1e2a3907d1a3dad1cd0ab855fe6735f233c74","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/google-analytics.ejs","hash":"2ea7442ea1e1a8ab4e41e26c563f58413b59a3d0","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/header.ejs","hash":"c1acd247e14588cdf101a69460cb8319c18cd078","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/head.ejs","hash":"f215d92a882247a7cc5ea80b241bedfcec0ea6ca","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/recent_posts.ejs","hash":"60c4b012dcc656438ff59997e60367e5a21ab746","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/article.styl","hash":"80759482d07063c091e940f964a1cf6693d3d406","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/header.styl","hash":"85ab11e082f4dd86dde72bed653d57ec5381f30c","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/highlight.styl","hash":"bf4e7be1968dad495b04e83c95eac14c4d0ad7c0","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/date.ejs","hash":"f1458584b679545830b75bef2526e2f3eb931045","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/js/jquery-3.4.1.min.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/title.ejs","hash":"4d7e62574ddf46de9b41605fe3140d77b5ddb26d","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1683710778135},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1683710778135},{"_id":"themes/hexo-theme-pure/.gitignore","hash":"204766bf9e2d6fe1fce5b9b02b8edfac2d235830","modified":1683728425104},{"_id":"themes/hexo-theme-pure/LICENSE","hash":"82ce1e15ddeabeaaca60e2186b5a3ce42b1a9c49","modified":1683728425104},{"_id":"themes/hexo-theme-pure/_config.yml","hash":"94c0bc7c06b3c96ba594a91ec4b40345e1b8618b","modified":1683728425105},{"_id":"themes/hexo-theme-pure/package.json","hash":"d5bad0f074925c46e8ee5a75d385346d2fcea850","modified":1683728425131},{"_id":"themes/hexo-theme-pure/_config.yml.example","hash":"a3b55d01598967db40da6f740b38cdba4f17d7bc","modified":1683728425105},{"_id":"themes/hexo-theme-pure/languages/default.yml","hash":"ed342f9158f13fafaf51baa4cc89df4d8aa31720","modified":1683728425109},{"_id":"themes/hexo-theme-pure/README.md","hash":"94fe451bf920cec6152e7bf9cbff4ccf0af0febc","modified":1683728425104},{"_id":"themes/hexo-theme-pure/languages/en.yml","hash":"ed342f9158f13fafaf51baa4cc89df4d8aa31720","modified":1683728425110},{"_id":"themes/hexo-theme-pure/README.cn.md","hash":"c14beac2aa2b6e6deb5359600b215d0ae348c0a4","modified":1683728425104},{"_id":"themes/hexo-theme-pure/languages/zh-TW.yml","hash":"387ad2ca1b2a01dac36f768a6116a2033c3ac142","modified":1683728425110},{"_id":"themes/hexo-theme-pure/languages/zh-CN.yml","hash":"399061d959807b41e333808b4c7851ca290a82fe","modified":1683728425110},{"_id":"themes/hexo-theme-pure/scripts/thumbnail.js","hash":"4a7385e533f3567758bc995a8be5eb3e7839ac9c","modified":1683728425147},{"_id":"themes/hexo-theme-pure/layout/about.ejs","hash":"4b64515ccc801cc9eba637a1e1909c6c4dd203f6","modified":1683728425128},{"_id":"themes/hexo-theme-pure/layout/books.ejs","hash":"75cbd31d3551c730e8a683bd5b08562881a95b51","modified":1683728425129},{"_id":"themes/hexo-theme-pure/layout/index.ejs","hash":"44418dbf1fb82392b8e1e4cc910d16a383190433","modified":1683728425129},{"_id":"themes/hexo-theme-pure/layout/links.ejs","hash":"ee90a5f2a9d19bc02682ea3a59177b947f7f7284","modified":1683728425130},{"_id":"themes/hexo-theme-pure/layout/post.ejs","hash":"fbfed3c882059e757b23ff57924400683631594b","modified":1683728425130},{"_id":"themes/hexo-theme-pure/layout/categories.ejs","hash":"9cc7b5f5af40fd7ec641bf0f5a5f8f1ce1ac22d5","modified":1683728425129},{"_id":"themes/hexo-theme-pure/layout/archive.ejs","hash":"62847ac8ce2562908c01d69f7f6886e24a6ded40","modified":1683728425128},{"_id":"themes/hexo-theme-pure/layout/category.ejs","hash":"b3f7a96fbaf201a65ed64d509edc29976542fbfb","modified":1683728425129},{"_id":"themes/hexo-theme-pure/layout/page.ejs","hash":"fbfed3c882059e757b23ff57924400683631594b","modified":1683728425130},{"_id":"themes/hexo-theme-pure/layout/repository.ejs","hash":"0ecad33b6c1ec741eb3b02bb47a3824ac3749d09","modified":1683728425131},{"_id":"themes/hexo-theme-pure/source/favicon.png","hash":"89875d3b018552e396fc5f0bd8ff5d9f5d4a5d71","modified":1683728425150},{"_id":"themes/hexo-theme-pure/layout/tags.ejs","hash":"76bc71f3dfd8a5b1aa14b09dec7b460b14f5028a","modified":1683728425131},{"_id":"themes/hexo-theme-pure/layout/tag.ejs","hash":"30d8ddd84c9aa87dff1be02af308097cf4e72448","modified":1683728425131},{"_id":"themes/hexo-theme-pure/_source/404/index.md","hash":"16638b081d796638565ca462f3c87339b9a0577e","modified":1683728425106},{"_id":"themes/hexo-theme-pure/.github/ISSUE_TEMPLATE/bug_report.md","hash":"16dbe91b392ef9debb7abeffde473668d3337eb2","modified":1683728425103},{"_id":"themes/hexo-theme-pure/.github/ISSUE_TEMPLATE/custom.md","hash":"a3b49dff53b405dbafe2e96834313fc329710007","modified":1683728425103},{"_id":"themes/hexo-theme-pure/.github/ISSUE_TEMPLATE/feature_request.md","hash":"205a69ba038cf76affcdc1f39d88a8cb8079fc12","modified":1683728425103},{"_id":"themes/hexo-theme-pure/_source/about/index.md","hash":"b72470146e8244886e15715e0cae79b4130305e8","modified":1683728425107},{"_id":"themes/hexo-theme-pure/_source/books/index.md","hash":"d913d58987f539ac2ca4cca366ebf42f8b1a03d1","modified":1683728425107},{"_id":"themes/hexo-theme-pure/_source/_data/gallery.yml","hash":"eef9b025c2a81fdc714967d0c7b21bed9d55cff5","modified":1683728425106},{"_id":"themes/hexo-theme-pure/layout/layout.ejs","hash":"71bdeba7b8be0c4f56a87ad05da2c6d4254da55e","modified":1683728425130},{"_id":"themes/hexo-theme-pure/_source/_data/links.yml","hash":"a5e31f35ebb8e1e8811f2e3d957cf4d4835aa2f9","modified":1683728425106},{"_id":"themes/hexo-theme-pure/_source/repository/index.md","hash":"bf2bec13066d7d53fc05a334876eb482e6f95825","modified":1683728425109},{"_id":"themes/hexo-theme-pure/_source/tags/index.md","hash":"c35ba8af5acf41102909a9f9c1349a24d89f97a6","modified":1683728425109},{"_id":"themes/hexo-theme-pure/_source/links/index.md","hash":"d768332d0d322fe39267dbbda05b931488c27d7e","modified":1683728425108},{"_id":"themes/hexo-theme-pure/_source/categories/index.md","hash":"b0006184ce9570766e7c7507d20fede1079f4992","modified":1683728425108},{"_id":"themes/hexo-theme-pure/layout/_common/footer.ejs","hash":"caec54ce31577207e1fd31aefa017bde99a8027c","modified":1683728425111},{"_id":"themes/hexo-theme-pure/layout/_common/header.ejs","hash":"c05070274965692a270c7e07ad9f4dad6f2c5888","modified":1683728425111},{"_id":"themes/hexo-theme-pure/layout/_common/script.ejs","hash":"3045da0c1979946694b628fbef39c01cc98b6e75","modified":1683728425111},{"_id":"themes/hexo-theme-pure/layout/_common/social.ejs","hash":"2bcdc7b0ee3905e724b01c2efa1ca6b47a846e1f","modified":1683728425112},{"_id":"themes/hexo-theme-pure/layout/_script/fancybox.ejs","hash":"4558b5713926735d874deb14d8b21ed2e597b714","modified":1683728425123},{"_id":"themes/hexo-theme-pure/layout/_common/head.ejs","hash":"4135b80c40cc970f9dc30fdd02e4f3e0a8b0af67","modified":1683728425111},{"_id":"themes/hexo-theme-pure/layout/_script/douban.ejs","hash":"6e671c659b282b690a5d61e842b5d5f38dced6d7","modified":1683728425123},{"_id":"themes/hexo-theme-pure/layout/_script/comment.ejs","hash":"d5c98ab345952bb11d9ee69a9c1e3432b6760c55","modified":1683728425123},{"_id":"themes/hexo-theme-pure/layout/_script/pv.ejs","hash":"a464706b7a903e25d34b104bdfb298b260abc132","modified":1683728425124},{"_id":"themes/hexo-theme-pure/layout/_script/repository.ejs","hash":"42b6602f478c9afa4e462716dcfcc76875c0df7d","modified":1683728425124},{"_id":"themes/hexo-theme-pure/layout/_search/baidu.ejs","hash":"89848cc8e0190ca76cc26d42c6880a23e370702e","modified":1683728425125},{"_id":"themes/hexo-theme-pure/layout/_script/search.ejs","hash":"2b784d15581df4309f56682896b725da7d44fcdd","modified":1683728425125},{"_id":"themes/hexo-theme-pure/layout/_script/mathjax.ejs","hash":"7a64d98212769423425102a441fca52eb6930fff","modified":1683728425124},{"_id":"themes/hexo-theme-pure/layout/_search/insight.ejs","hash":"14b1ec0bdb911ab6d92046c78d371264afc4fb19","modified":1683728425126},{"_id":"themes/hexo-theme-pure/layout/_search/index-mobile.ejs","hash":"5e9a5cc9bdc05fabf939db494c3937cc0df48a72","modified":1683728425125},{"_id":"themes/hexo-theme-pure/layout/_search/index.ejs","hash":"2c1f06dac5710e5fd073f3e5739545f3f6a0a56f","modified":1683728425125},{"_id":"themes/hexo-theme-pure/layout/_script/analytics.ejs","hash":"db2967c6902ceb67caa70364935ef3441b10432f","modified":1683728425123},{"_id":"themes/hexo-theme-pure/layout/_partial/archive-book.ejs","hash":"944913dcabd09c10d3014c844abf851f4dfdba8d","modified":1683728425112},{"_id":"themes/hexo-theme-pure/layout/_partial/archive-post.ejs","hash":"513892fae41de4e68963c95a9358285714274bb4","modified":1683728425113},{"_id":"themes/hexo-theme-pure/layout/_partial/archive-link.ejs","hash":"a8a387f9e7289a6524cf46d7ab76c34fff37f4bf","modified":1683728425113},{"_id":"themes/hexo-theme-pure/layout/_partial/archive-list.ejs","hash":"15ebb5d7cc3f07e6bf5ffa783c3d2feabd252fc1","modified":1683728425113},{"_id":"themes/hexo-theme-pure/layout/_partial/archive-category.ejs","hash":"4be88eec64fd40c7e1b74df8ccb6c8cdfa3e7a17","modified":1683728425112},{"_id":"themes/hexo-theme-pure/layout/_search/swiftype.ejs","hash":"dc548a83c33b5a598683bf2e1cb723bc3be4a76b","modified":1683728425126},{"_id":"themes/hexo-theme-pure/layout/_partial/archive-tag.ejs","hash":"db8cba32bf6655a8d21fe8c8ccd0695b049e1d4c","modified":1683728425114},{"_id":"themes/hexo-theme-pure/layout/_partial/archive-repository.ejs","hash":"01fabc035fe48a494581f5680ed23f355e0e59ce","modified":1683728425113},{"_id":"themes/hexo-theme-pure/layout/_partial/archive.ejs","hash":"c196b54f92eff017a48e02bacc029dd82edc8cf9","modified":1683728425114},{"_id":"themes/hexo-theme-pure/layout/_partial/article-about.ejs","hash":"47bbb53fe9cca05928c45782c6897c8a94d597ff","modified":1683728425114},{"_id":"themes/hexo-theme-pure/layout/_partial/item-post.ejs","hash":"c5d1add53ce45df5f851f19023b2e4f16dad43ef","modified":1683728425115},{"_id":"themes/hexo-theme-pure/layout/_partial/article.ejs","hash":"8af3bcfc07c344cefa0655dbe83f3c1a55954899","modified":1683728425114},{"_id":"themes/hexo-theme-pure/layout/_partial/sidebar-toc.ejs","hash":"1d90de80d5eb2b10be6cad6fa0bfb465cbc5c9f1","modified":1683728425118},{"_id":"themes/hexo-theme-pure/layout/_partial/pagination.ejs","hash":"cc450ee5638f180332b3c4b747c5337b89d5a0c8","modified":1683728425115},{"_id":"themes/hexo-theme-pure/layout/_widget/category.ejs","hash":"83c8ce4b099951d58b2be5006f6963afbbe7d4e9","modified":1683728425127},{"_id":"themes/hexo-theme-pure/layout/_widget/tag.ejs","hash":"24823a881a6c15fd846c7f4780eb90fe869a813b","modified":1683728425127},{"_id":"themes/hexo-theme-pure/layout/_widget/board.ejs","hash":"9811bab46dcf436c6d05ae78acd62bc25751df78","modified":1683728425127},{"_id":"themes/hexo-theme-pure/layout/_widget/archive.ejs","hash":"b250fb0f63286f9648cd8bf428bed6a88901b481","modified":1683728425126},{"_id":"themes/hexo-theme-pure/layout/_partial/sidebar.ejs","hash":"a6662f79f7fd6f1cc9b5180672ba8e1d0192fbe2","modified":1683728425118},{"_id":"themes/hexo-theme-pure/layout/_widget/tagcloud.ejs","hash":"e6967ec160b93a5f466a73a36745833e644d04c0","modified":1683728425128},{"_id":"themes/hexo-theme-pure/layout/_partial/sidebar-about.ejs","hash":"17787edc304543c8658c7f51076022bda6ad227d","modified":1683728425118},{"_id":"themes/hexo-theme-pure/source/fonts/README.md","hash":"b5b2aac1b36a86dac2217d242d650e026c5a3b0c","modified":1683728425150},{"_id":"themes/hexo-theme-pure/source/fonts/iconfont.eot","hash":"6819d9bb643bdeafc17bfecb0746ae641b018fdf","modified":1683728425151},{"_id":"themes/hexo-theme-pure/source/fonts/iconfont.woff","hash":"78d29194287b8885d25212048c4f787705212a6e","modified":1683728425153},{"_id":"themes/hexo-theme-pure/layout/_widget/recent_posts.ejs","hash":"8932ce5283a7e6a356c6840104a7d6984f2ea986","modified":1683728425127},{"_id":"themes/hexo-theme-pure/source/fonts/iconfont.ttf","hash":"9b8837f9f79cf6ab794736301d0665345183a20c","modified":1683728425152},{"_id":"themes/hexo-theme-pure/source/images/avatar.jpg","hash":"f86eafc318f3900319b25057811720168f24d248","modified":1683728425153},{"_id":"themes/hexo-theme-pure/source/images/xingqiu-qrcode.jpg","hash":"ef2c2848dc79db6df7c752510651ed8ba57f2daf","modified":1683728425156},{"_id":"themes/hexo-theme-pure/source/js/application.min.js","hash":"34d765e982c7d6360c37f82202d99f63ac40e408","modified":1683728425156},{"_id":"themes/hexo-theme-pure/source/images/thumb-default.png","hash":"e8403b97ed9251f9f5207765b0ce796c5000b4ba","modified":1683728425155},{"_id":"themes/hexo-theme-pure/source/js/application.js","hash":"c29f52f5ed2d1a5d8185b115f2962d22e707e19e","modified":1683728425156},{"_id":"themes/hexo-theme-pure/source/js/insight.js","hash":"a1b773d9ce470bf0e2f8fdca1b6fac2ac3d31aeb","modified":1683728425157},{"_id":"themes/hexo-theme-pure/layout/_script/_analytics/tencent-analytics.ejs","hash":"19585fc666e13a2816d74a8046998ac7fd36f75c","modified":1683728425119},{"_id":"themes/hexo-theme-pure/layout/_script/_analytics/google-analytics.ejs","hash":"4557389e499b89982eb005a821208fdd3dbac627","modified":1683728425119},{"_id":"themes/hexo-theme-pure/layout/_script/_repository/gitee.ejs","hash":"be7fed016f5332b597af6a5d5de262cc4fe939a0","modified":1683728425121},{"_id":"themes/hexo-theme-pure/layout/_script/_analytics/baidu-analytics.ejs","hash":"829778c19025882fe73cf1b297a36a9d0eff39a1","modified":1683728425119},{"_id":"themes/hexo-theme-pure/layout/_script/_repository/github.ejs","hash":"4df2172813297fcfb9ab894f668f21230f2e9e77","modified":1683728425122},{"_id":"themes/hexo-theme-pure/layout/_script/_search/baidu.ejs","hash":"72b48dcaab830b615c71f6e810e96100b715c682","modified":1683728425122},{"_id":"themes/hexo-theme-pure/layout/_script/_repository/legacy.ejs","hash":"9ed1e7de79bd661065b9c071957c54e58c38827c","modified":1683728425122},{"_id":"themes/hexo-theme-pure/layout/_script/_search/insight.ejs","hash":"f95c3289c03fa084afce64e3c399cb5127707f56","modified":1683728425122},{"_id":"themes/hexo-theme-pure/layout/_script/_comment/gitment.ejs","hash":"0af71b5b354fdddd576fbd55c3aeb0221af71e7d","modified":1683728425120},{"_id":"themes/hexo-theme-pure/layout/_script/_comment/disqus.ejs","hash":"98dac12a9cbf47098b49183893d714355e2e5999","modified":1683728425120},{"_id":"themes/hexo-theme-pure/layout/_script/_comment/youyan.ejs","hash":"96fcc36560a8367e6c4ba9ec1e82d0c5a730b1b4","modified":1683728425121},{"_id":"themes/hexo-theme-pure/layout/_script/_comment/gitalk.ejs","hash":"d6bf1cfaa9167dcfb9ffab20c6670c53a008e838","modified":1683728425120},{"_id":"themes/hexo-theme-pure/layout/_partial/post/date.ejs","hash":"8cbaef422bd7f3d1581d1198dd1c36e4c0e1e46e","modified":1683728425116},{"_id":"themes/hexo-theme-pure/layout/_script/_comment/valine.ejs","hash":"19120669bfea521e0b9d2df5bf3a34f0ecb8bb68","modified":1683728425121},{"_id":"themes/hexo-theme-pure/layout/_script/_comment/livere.ejs","hash":"2cc7b1cb7bdf157fe6470eb34a613963df75afa3","modified":1683728425120},{"_id":"themes/hexo-theme-pure/layout/_partial/post/category.ejs","hash":"20ef0d47ec3d2de7d94db9778ddac092dc2bd4b5","modified":1683728425115},{"_id":"themes/hexo-theme-pure/layout/_partial/post/copyright.ejs","hash":"c690e62e930ac7e66a5982aa95e146324e9b1e7f","modified":1683728425116},{"_id":"themes/hexo-theme-pure/layout/_partial/post/donate.ejs","hash":"bdef9836ca91b3e45498a9d98bcaec69e6627ced","modified":1683728425116},{"_id":"themes/hexo-theme-pure/layout/_partial/post/gallery.ejs","hash":"b0bf3f5d923c261ca2b5fabab513f1ec2708c8ca","modified":1683728425116},{"_id":"themes/hexo-theme-pure/layout/_partial/post/comment.ejs","hash":"0ef132fc45042b28411e3334e77b6e2a7f47fae2","modified":1683728425115},{"_id":"themes/hexo-theme-pure/layout/_partial/post/title.ejs","hash":"d4a460a35e2112d0c7414fd5e19b3a16093f1caf","modified":1683728425118},{"_id":"themes/hexo-theme-pure/layout/_partial/post/pv.ejs","hash":"946f4bcfa5e5dc4d60c05916c8187bd2c06d1a95","modified":1683728425117},{"_id":"themes/hexo-theme-pure/layout/_partial/post/tag.ejs","hash":"8fd470b8d52606a90d475f7da9dbbed32742b1c9","modified":1683728425117},{"_id":"themes/hexo-theme-pure/layout/_partial/post/wordcount.ejs","hash":"81e9a89734505f54fef83dc74d2e277dab1bfa75","modified":1683728425118},{"_id":"themes/hexo-theme-pure/source/images/donate/alipayimg.png","hash":"9562f23f2eb57841c65dc769b6cc43a2cf0efa94","modified":1683728425154},{"_id":"themes/hexo-theme-pure/layout/_partial/post/thumbnail.ejs","hash":"0d8b9a3aeaed95b74e292c593f0a8225711bfdca","modified":1683728425117},{"_id":"themes/hexo-theme-pure/source/images/donate/wechatpayimg.png","hash":"c0844d9a633696cb00ae64fde06f0f924f63b596","modified":1683728425154},{"_id":"themes/hexo-theme-pure/source/images/favatar/SzsFox-logo.png","hash":"d71fcc73b7bc2a439d8c7ba461137856d190bd76","modified":1683728425154},{"_id":"themes/hexo-theme-pure/screenshot/pure-theme-blue.png","hash":"6146890a68d5ea9d343c48d50151ddd5a2a1872c","modified":1683728425134},{"_id":"themes/hexo-theme-pure/screenshot/pure-theme-black.png","hash":"10b40f398af7eb7e8ba2bf2f2a959d8779fc1fe1","modified":1683728425133},{"_id":"themes/hexo-theme-pure/screenshot/pure-theme-green.png","hash":"12ec0c6033cb2762839fdf75434bbb4fbf946022","modified":1683728425135},{"_id":"themes/hexo-theme-pure/screenshot/pure-theme-purple.png","hash":"9855d2eb0acd23370209354f232471df8f4f72e2","modified":1683728425136},{"_id":"themes/hexo-theme-pure/screenshot/pure.png","hash":"8f4cfd8d7edfa4fbffdf375291302d9807f5cc1c","modified":1683728425137},{"_id":"themes/hexo-theme-pure/source/images/favatar/chuangzaoshi-logo.png","hash":"7fa5734072050952159a02d330bbc008b5a99122","modified":1683728425155},{"_id":"themes/hexo-theme-pure/source/images/favatar/idesign-logo.png","hash":"6b150a2dbb9912b7a7662255c27e4d4baaecee71","modified":1683728425155},{"_id":"themes/hexo-theme-pure/source/js/jquery.min.js","hash":"dacc1f76630a9708add066819b1aabf8dce01056","modified":1683728425158},{"_id":"themes/hexo-theme-pure/source/js/plugin.min.js","hash":"4eded164f8b6f5187fbf10065873ebeee5ab8787","modified":1683728425160},{"_id":"themes/hexo-theme-pure/layout/_partial/post/nav.ejs","hash":"5b4119092b890c156a4e85e15be2cbcebf89fcbd","modified":1683728425117},{"_id":"themes/hexo-theme-pure/source/css/style.css","hash":"fca937c3b6b2c631dc48d7bf2db062c425c3a084","modified":1683728425148},{"_id":"themes/hexo-theme-pure/source/css/style.min.css","hash":"4e46cbfadf9f0c5c236239a163058a3f525492ce","modified":1683728425149},{"_id":"themes/hexo-theme-pure/source/fonts/iconfont.svg","hash":"1af91521f1c29c231ffc19d7f64696ddcd71470b","modified":1683728425152},{"_id":"themes/hexo-theme-pure/source/js/plugin.js.map","hash":"1730c0cc660f863120aca0a439d7264e2e245fc5","modified":1683728425160},{"_id":"themes/hexo-theme-pure/source/js/plugin.js","hash":"59cb2985d8d21653f0f80ef327517eca86af0ac6","modified":1683728425159},{"_id":"themes/hexo-theme-pure/screenshot/pure.psd","hash":"a31cea40b45bdc31f051fca2f1e2f4ecbaee1a94","modified":1683728425146},{"_id":"source/_posts/Mysql.md","hash":"88b843d9a74556c48b83ed58faa71a1fa297f64b","modified":1683858186764},{"_id":"source/tages/index.md","hash":"33988377b5c94c6550a1ae16aa4649eeb36fc06a","modified":1683859005645},{"_id":"source/tags/index.md","hash":"982a982a8c4e0412a866aeefb3ddf3c2c573d6af","modified":1683860801973},{"_id":"themes/hexo-theme-pure/package-lock.json","hash":"bc1265d7187f56cdba1b6dcc267fed2591f0cd53","modified":1683860469054},{"_id":"themes/pure/.gitignore","hash":"204766bf9e2d6fe1fce5b9b02b8edfac2d235830","modified":1683860658362},{"_id":"themes/pure/README.md","hash":"94fe451bf920cec6152e7bf9cbff4ccf0af0febc","modified":1683860658364},{"_id":"themes/pure/_config.yml","hash":"94c0bc7c06b3c96ba594a91ec4b40345e1b8618b","modified":1683860658364},{"_id":"themes/pure/package.json","hash":"83641e3411f9e20bb67a09baef60893e69b89ed9","modified":1683861092040},{"_id":"themes/pure/languages/default.yml","hash":"ed342f9158f13fafaf51baa4cc89df4d8aa31720","modified":1683860658370},{"_id":"themes/pure/LICENSE","hash":"82ce1e15ddeabeaaca60e2186b5a3ce42b1a9c49","modified":1683860658363},{"_id":"themes/pure/languages/en.yml","hash":"ed342f9158f13fafaf51baa4cc89df4d8aa31720","modified":1683860658370},{"_id":"themes/pure/languages/zh-TW.yml","hash":"387ad2ca1b2a01dac36f768a6116a2033c3ac142","modified":1683860658371},{"_id":"themes/pure/_config.yml.example","hash":"a3b55d01598967db40da6f740b38cdba4f17d7bc","modified":1683860658365},{"_id":"themes/pure/languages/zh-CN.yml","hash":"399061d959807b41e333808b4c7851ca290a82fe","modified":1683860658370},{"_id":"themes/pure/layout/about.ejs","hash":"4b64515ccc801cc9eba637a1e1909c6c4dd203f6","modified":1683860658397},{"_id":"themes/pure/layout/archive.ejs","hash":"62847ac8ce2562908c01d69f7f6886e24a6ded40","modified":1683860658397},{"_id":"themes/pure/layout/categories.ejs","hash":"9cc7b5f5af40fd7ec641bf0f5a5f8f1ce1ac22d5","modified":1683860658398},{"_id":"themes/pure/layout/category.ejs","hash":"b3f7a96fbaf201a65ed64d509edc29976542fbfb","modified":1683860658398},{"_id":"themes/pure/layout/links.ejs","hash":"ee90a5f2a9d19bc02682ea3a59177b947f7f7284","modified":1683860658399},{"_id":"themes/pure/layout/layout.ejs","hash":"71bdeba7b8be0c4f56a87ad05da2c6d4254da55e","modified":1683860658399},{"_id":"themes/pure/layout/page.ejs","hash":"fbfed3c882059e757b23ff57924400683631594b","modified":1683860658399},{"_id":"themes/pure/layout/post.ejs","hash":"fbfed3c882059e757b23ff57924400683631594b","modified":1683860658400},{"_id":"themes/pure/layout/repository.ejs","hash":"0ecad33b6c1ec741eb3b02bb47a3824ac3749d09","modified":1683860658400},{"_id":"themes/pure/layout/tags.ejs","hash":"76bc71f3dfd8a5b1aa14b09dec7b460b14f5028a","modified":1683860658401},{"_id":"themes/pure/layout/tag.ejs","hash":"30d8ddd84c9aa87dff1be02af308097cf4e72448","modified":1683860658400},{"_id":"themes/pure/layout/books.ejs","hash":"75cbd31d3551c730e8a683bd5b08562881a95b51","modified":1683860658397},{"_id":"themes/pure/layout/index.ejs","hash":"44418dbf1fb82392b8e1e4cc910d16a383190433","modified":1683860658398},{"_id":"themes/pure/README.cn.md","hash":"c14beac2aa2b6e6deb5359600b215d0ae348c0a4","modified":1683860658363},{"_id":"themes/pure/scripts/thumbnail.js","hash":"4a7385e533f3567758bc995a8be5eb3e7839ac9c","modified":1683860658421},{"_id":"themes/pure/source/favicon.png","hash":"89875d3b018552e396fc5f0bd8ff5d9f5d4a5d71","modified":1683860658425},{"_id":"themes/pure/.github/ISSUE_TEMPLATE/custom.md","hash":"a3b49dff53b405dbafe2e96834313fc329710007","modified":1683860658361},{"_id":"themes/pure/layout/_common/footer.ejs","hash":"caec54ce31577207e1fd31aefa017bde99a8027c","modified":1683860658371},{"_id":"themes/pure/.github/ISSUE_TEMPLATE/feature_request.md","hash":"205a69ba038cf76affcdc1f39d88a8cb8079fc12","modified":1683860658362},{"_id":"themes/pure/layout/_common/head.ejs","hash":"4135b80c40cc970f9dc30fdd02e4f3e0a8b0af67","modified":1683860658372},{"_id":"themes/pure/layout/_partial/archive-category.ejs","hash":"4be88eec64fd40c7e1b74df8ccb6c8cdfa3e7a17","modified":1683860658373},{"_id":"themes/pure/layout/_common/social.ejs","hash":"2bcdc7b0ee3905e724b01c2efa1ca6b47a846e1f","modified":1683860658373},{"_id":"themes/pure/layout/_partial/archive-book.ejs","hash":"944913dcabd09c10d3014c844abf851f4dfdba8d","modified":1683860658373},{"_id":"themes/pure/.github/ISSUE_TEMPLATE/bug_report.md","hash":"16dbe91b392ef9debb7abeffde473668d3337eb2","modified":1683860658361},{"_id":"themes/pure/layout/_common/script.ejs","hash":"3045da0c1979946694b628fbef39c01cc98b6e75","modified":1683860658372},{"_id":"themes/pure/layout/_partial/archive-list.ejs","hash":"15ebb5d7cc3f07e6bf5ffa783c3d2feabd252fc1","modified":1683860658374},{"_id":"themes/pure/layout/_partial/archive-post.ejs","hash":"513892fae41de4e68963c95a9358285714274bb4","modified":1683860658374},{"_id":"themes/pure/layout/_partial/archive-link.ejs","hash":"a8a387f9e7289a6524cf46d7ab76c34fff37f4bf","modified":1683860658374},{"_id":"themes/pure/layout/_partial/archive-tag.ejs","hash":"db8cba32bf6655a8d21fe8c8ccd0695b049e1d4c","modified":1683860658375},{"_id":"themes/pure/layout/_partial/archive-repository.ejs","hash":"01fabc035fe48a494581f5680ed23f355e0e59ce","modified":1683860658375},{"_id":"themes/pure/layout/_partial/archive.ejs","hash":"c196b54f92eff017a48e02bacc029dd82edc8cf9","modified":1683860658376},{"_id":"themes/pure/layout/_partial/item-post.ejs","hash":"c5d1add53ce45df5f851f19023b2e4f16dad43ef","modified":1683860658377},{"_id":"themes/pure/layout/_partial/article-about.ejs","hash":"47bbb53fe9cca05928c45782c6897c8a94d597ff","modified":1683860658376},{"_id":"themes/pure/layout/_partial/article.ejs","hash":"8af3bcfc07c344cefa0655dbe83f3c1a55954899","modified":1683860658376},{"_id":"themes/pure/layout/_partial/sidebar.ejs","hash":"a6662f79f7fd6f1cc9b5180672ba8e1d0192fbe2","modified":1683860658383},{"_id":"themes/pure/layout/_partial/pagination.ejs","hash":"cc450ee5638f180332b3c4b747c5337b89d5a0c8","modified":1683860658377},{"_id":"themes/pure/layout/_partial/sidebar-about.ejs","hash":"17787edc304543c8658c7f51076022bda6ad227d","modified":1683860658382},{"_id":"themes/pure/layout/_script/analytics.ejs","hash":"db2967c6902ceb67caa70364935ef3441b10432f","modified":1683860658390},{"_id":"themes/pure/layout/_script/mathjax.ejs","hash":"7a64d98212769423425102a441fca52eb6930fff","modified":1683860658391},{"_id":"themes/pure/layout/_script/douban.ejs","hash":"6e671c659b282b690a5d61e842b5d5f38dced6d7","modified":1683860658390},{"_id":"themes/pure/layout/_script/fancybox.ejs","hash":"4558b5713926735d874deb14d8b21ed2e597b714","modified":1683860658391},{"_id":"themes/pure/layout/_script/pv.ejs","hash":"a464706b7a903e25d34b104bdfb298b260abc132","modified":1683860658391},{"_id":"themes/pure/layout/_script/repository.ejs","hash":"42b6602f478c9afa4e462716dcfcc76875c0df7d","modified":1683860658392},{"_id":"themes/pure/layout/_script/search.ejs","hash":"2b784d15581df4309f56682896b725da7d44fcdd","modified":1683860658392},{"_id":"themes/pure/layout/_widget/archive.ejs","hash":"b250fb0f63286f9648cd8bf428bed6a88901b481","modified":1683860658394},{"_id":"themes/pure/layout/_widget/board.ejs","hash":"9811bab46dcf436c6d05ae78acd62bc25751df78","modified":1683860658395},{"_id":"themes/pure/layout/_partial/sidebar-toc.ejs","hash":"1d90de80d5eb2b10be6cad6fa0bfb465cbc5c9f1","modified":1683860658383},{"_id":"themes/pure/layout/_widget/category.ejs","hash":"83c8ce4b099951d58b2be5006f6963afbbe7d4e9","modified":1683860658395},{"_id":"themes/pure/layout/_widget/tag.ejs","hash":"24823a881a6c15fd846c7f4780eb90fe869a813b","modified":1683860658396},{"_id":"themes/pure/layout/_widget/tagcloud.ejs","hash":"e6967ec160b93a5f466a73a36745833e644d04c0","modified":1683860658396},{"_id":"themes/pure/_source/404/index.md","hash":"16638b081d796638565ca462f3c87339b9a0577e","modified":1683860658365},{"_id":"themes/pure/layout/_common/header.ejs","hash":"c05070274965692a270c7e07ad9f4dad6f2c5888","modified":1683860658372},{"_id":"themes/pure/layout/_search/baidu.ejs","hash":"89848cc8e0190ca76cc26d42c6880a23e370702e","modified":1683860658393},{"_id":"themes/pure/layout/_search/index.ejs","hash":"2c1f06dac5710e5fd073f3e5739545f3f6a0a56f","modified":1683860658393},{"_id":"themes/pure/layout/_search/index-mobile.ejs","hash":"5e9a5cc9bdc05fabf939db494c3937cc0df48a72","modified":1683860658393},{"_id":"themes/pure/_source/about/index.md","hash":"b72470146e8244886e15715e0cae79b4130305e8","modified":1683860658367},{"_id":"themes/pure/layout/_search/swiftype.ejs","hash":"dc548a83c33b5a598683bf2e1cb723bc3be4a76b","modified":1683860658394},{"_id":"themes/pure/_source/_data/gallery.yml","hash":"eef9b025c2a81fdc714967d0c7b21bed9d55cff5","modified":1683860658366},{"_id":"themes/pure/_source/_data/links.yml","hash":"a5e31f35ebb8e1e8811f2e3d957cf4d4835aa2f9","modified":1683860658366},{"_id":"themes/pure/_source/links/index.md","hash":"d768332d0d322fe39267dbbda05b931488c27d7e","modified":1683860658368},{"_id":"themes/pure/layout/_search/insight.ejs","hash":"14b1ec0bdb911ab6d92046c78d371264afc4fb19","modified":1683860658394},{"_id":"themes/pure/_source/books/index.md","hash":"d913d58987f539ac2ca4cca366ebf42f8b1a03d1","modified":1683860658367},{"_id":"themes/pure/_source/categories/index.md","hash":"b0006184ce9570766e7c7507d20fede1079f4992","modified":1683860658367},{"_id":"themes/pure/layout/_widget/recent_posts.ejs","hash":"8932ce5283a7e6a356c6840104a7d6984f2ea986","modified":1683860658395},{"_id":"themes/pure/_source/repository/index.md","hash":"bf2bec13066d7d53fc05a334876eb482e6f95825","modified":1683860658369},{"_id":"themes/pure/_source/tags/index.md","hash":"c35ba8af5acf41102909a9f9c1349a24d89f97a6","modified":1683860658369},{"_id":"themes/pure/source/fonts/README.md","hash":"b5b2aac1b36a86dac2217d242d650e026c5a3b0c","modified":1683860658426},{"_id":"themes/pure/source/fonts/iconfont.eot","hash":"6819d9bb643bdeafc17bfecb0746ae641b018fdf","modified":1683860658427},{"_id":"themes/pure/source/fonts/iconfont.ttf","hash":"9b8837f9f79cf6ab794736301d0665345183a20c","modified":1683860658429},{"_id":"themes/pure/source/images/avatar.jpg","hash":"f86eafc318f3900319b25057811720168f24d248","modified":1683860658430},{"_id":"themes/pure/source/fonts/iconfont.woff","hash":"78d29194287b8885d25212048c4f787705212a6e","modified":1683860658430},{"_id":"themes/pure/source/js/application.js","hash":"c29f52f5ed2d1a5d8185b115f2962d22e707e19e","modified":1683860658434},{"_id":"themes/pure/layout/_script/comment.ejs","hash":"d5c98ab345952bb11d9ee69a9c1e3432b6760c55","modified":1683860658390},{"_id":"themes/pure/source/images/thumb-default.png","hash":"e8403b97ed9251f9f5207765b0ce796c5000b4ba","modified":1683860658433},{"_id":"themes/pure/source/images/xingqiu-qrcode.jpg","hash":"ef2c2848dc79db6df7c752510651ed8ba57f2daf","modified":1683860658434},{"_id":"themes/pure/source/js/application.min.js","hash":"34d765e982c7d6360c37f82202d99f63ac40e408","modified":1683860658435},{"_id":"themes/pure/source/js/insight.js","hash":"a1b773d9ce470bf0e2f8fdca1b6fac2ac3d31aeb","modified":1683860658435},{"_id":"themes/pure/layout/_partial/post/category.ejs","hash":"20ef0d47ec3d2de7d94db9778ddac092dc2bd4b5","modified":1683860658378},{"_id":"themes/pure/layout/_partial/post/donate.ejs","hash":"bdef9836ca91b3e45498a9d98bcaec69e6627ced","modified":1683860658379},{"_id":"themes/pure/layout/_partial/post/gallery.ejs","hash":"b0bf3f5d923c261ca2b5fabab513f1ec2708c8ca","modified":1683860658380},{"_id":"themes/pure/layout/_partial/post/date.ejs","hash":"8cbaef422bd7f3d1581d1198dd1c36e4c0e1e46e","modified":1683860658378},{"_id":"themes/pure/layout/_partial/post/nav.ejs","hash":"5b4119092b890c156a4e85e15be2cbcebf89fcbd","modified":1683860658380},{"_id":"themes/pure/layout/_partial/post/tag.ejs","hash":"8fd470b8d52606a90d475f7da9dbbed32742b1c9","modified":1683860658381},{"_id":"themes/pure/layout/_partial/post/comment.ejs","hash":"0ef132fc45042b28411e3334e77b6e2a7f47fae2","modified":1683860658378},{"_id":"themes/pure/layout/_partial/post/pv.ejs","hash":"946f4bcfa5e5dc4d60c05916c8187bd2c06d1a95","modified":1683860658380},{"_id":"themes/pure/layout/_partial/post/title.ejs","hash":"d4a460a35e2112d0c7414fd5e19b3a16093f1caf","modified":1683860658381},{"_id":"themes/pure/layout/_script/_analytics/google-analytics.ejs","hash":"4557389e499b89982eb005a821208fdd3dbac627","modified":1683860658384},{"_id":"themes/pure/layout/_partial/post/thumbnail.ejs","hash":"0d8b9a3aeaed95b74e292c593f0a8225711bfdca","modified":1683860658381},{"_id":"themes/pure/layout/_partial/post/copyright.ejs","hash":"c690e62e930ac7e66a5982aa95e146324e9b1e7f","modified":1683860658378},{"_id":"themes/pure/layout/_script/_repository/gitee.ejs","hash":"be7fed016f5332b597af6a5d5de262cc4fe939a0","modified":1683860658387},{"_id":"themes/pure/layout/_partial/post/wordcount.ejs","hash":"81e9a89734505f54fef83dc74d2e277dab1bfa75","modified":1683860658382},{"_id":"themes/pure/layout/_script/_repository/github.ejs","hash":"4df2172813297fcfb9ab894f668f21230f2e9e77","modified":1683860658388},{"_id":"themes/pure/layout/_script/_analytics/baidu-analytics.ejs","hash":"829778c19025882fe73cf1b297a36a9d0eff39a1","modified":1683860658383},{"_id":"themes/pure/layout/_script/_search/insight.ejs","hash":"f95c3289c03fa084afce64e3c399cb5127707f56","modified":1683860658389},{"_id":"themes/pure/layout/_script/_analytics/tencent-analytics.ejs","hash":"19585fc666e13a2816d74a8046998ac7fd36f75c","modified":1683860658384},{"_id":"themes/pure/layout/_script/_repository/legacy.ejs","hash":"9ed1e7de79bd661065b9c071957c54e58c38827c","modified":1683860658388},{"_id":"themes/pure/layout/_script/_comment/gitalk.ejs","hash":"d6bf1cfaa9167dcfb9ffab20c6670c53a008e838","modified":1683860658385},{"_id":"themes/pure/layout/_script/_comment/gitment.ejs","hash":"0af71b5b354fdddd576fbd55c3aeb0221af71e7d","modified":1683860658386},{"_id":"themes/pure/layout/_script/_comment/disqus.ejs","hash":"98dac12a9cbf47098b49183893d714355e2e5999","modified":1683860658385},{"_id":"themes/pure/layout/_script/_search/baidu.ejs","hash":"72b48dcaab830b615c71f6e810e96100b715c682","modified":1683860658389},{"_id":"themes/pure/layout/_script/_comment/livere.ejs","hash":"2cc7b1cb7bdf157fe6470eb34a613963df75afa3","modified":1683860658386},{"_id":"themes/pure/layout/_script/_comment/youyan.ejs","hash":"96fcc36560a8367e6c4ba9ec1e82d0c5a730b1b4","modified":1683860658387},{"_id":"themes/pure/source/images/favatar/SzsFox-logo.png","hash":"d71fcc73b7bc2a439d8c7ba461137856d190bd76","modified":1683860658432},{"_id":"themes/pure/layout/_script/_comment/valine.ejs","hash":"19120669bfea521e0b9d2df5bf3a34f0ecb8bb68","modified":1683860658386},{"_id":"themes/pure/source/images/favatar/idesign-logo.png","hash":"6b150a2dbb9912b7a7662255c27e4d4baaecee71","modified":1683860658433},{"_id":"themes/pure/source/images/donate/wechatpayimg.png","hash":"c0844d9a633696cb00ae64fde06f0f924f63b596","modified":1683860658431},{"_id":"themes/pure/source/images/favatar/chuangzaoshi-logo.png","hash":"7fa5734072050952159a02d330bbc008b5a99122","modified":1683860658432},{"_id":"themes/pure/screenshot/pure-theme-black.png","hash":"10b40f398af7eb7e8ba2bf2f2a959d8779fc1fe1","modified":1683860658403},{"_id":"themes/pure/screenshot/pure-theme-green.png","hash":"12ec0c6033cb2762839fdf75434bbb4fbf946022","modified":1683860658406},{"_id":"themes/pure/screenshot/pure-theme-blue.png","hash":"6146890a68d5ea9d343c48d50151ddd5a2a1872c","modified":1683860658404},{"_id":"themes/pure/screenshot/pure.png","hash":"8f4cfd8d7edfa4fbffdf375291302d9807f5cc1c","modified":1683860658408},{"_id":"themes/pure/screenshot/pure-theme-purple.png","hash":"9855d2eb0acd23370209354f232471df8f4f72e2","modified":1683860658407},{"_id":"themes/pure/source/images/donate/alipayimg.png","hash":"9562f23f2eb57841c65dc769b6cc43a2cf0efa94","modified":1683860658431},{"_id":"themes/pure/source/js/plugin.min.js","hash":"4eded164f8b6f5187fbf10065873ebeee5ab8787","modified":1683860658440},{"_id":"themes/pure/source/js/jquery.min.js","hash":"dacc1f76630a9708add066819b1aabf8dce01056","modified":1683860658436},{"_id":"themes/pure/source/css/style.min.css","hash":"4e46cbfadf9f0c5c236239a163058a3f525492ce","modified":1683860658425},{"_id":"themes/pure/source/css/style.css","hash":"fca937c3b6b2c631dc48d7bf2db062c425c3a084","modified":1683860658424},{"_id":"themes/pure/source/fonts/iconfont.svg","hash":"1af91521f1c29c231ffc19d7f64696ddcd71470b","modified":1683860658428},{"_id":"themes/pure/source/js/plugin.js","hash":"59cb2985d8d21653f0f80ef327517eca86af0ac6","modified":1683860658438},{"_id":"themes/pure/source/js/plugin.js.map","hash":"1730c0cc660f863120aca0a439d7264e2e245fc5","modified":1683860658439},{"_id":"themes/pure/screenshot/pure.psd","hash":"a31cea40b45bdc31f051fca2f1e2f4ecbaee1a94","modified":1683860658421},{"_id":"themes/pure/package-lock.json","hash":"e7cd866e18a5e19adc4e67852e10097ab3cee84a","modified":1683861092038}],"Category":[],"Data":[],"Page":[{"title":"tags","date":"2023-05-12T02:35:11.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: \"tags\"\ndate: 2023-05-12 10:35:11\n---","updated":"2023-05-12T03:06:41.973Z","path":"tags/index.html","_id":"clhjz8u6d0000l4sc0e25f46z","comments":1,"layout":"page","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2023-05-10T14:16:41.007Z","updated":"2023-05-10T14:16:41.007Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhhsdbwe0000l0sc8yxefo8y","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"Mysql","_content":"# sql\n\n![Mysql](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648093341473-68f1e895-bb41-45cb-9b0e-cb0d7797a3e7.png#averageHue=%23ecefe2&clientId=ub35db475-a524-4&from=paste&id=ub86e15fd&originHeight=1440&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=true&size=609051&status=done&style=none&taskId=udd5444c6-42b3-4ee3-b7f0-c6b67a2ffc1&title=Mysql%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%9B%BE \"Mysql\")\nMySQL  Server \n\nServer  MySQL \n\n InnoDBMyISAMMemory  InnoDB MySQL 5.5.5 \n\n create table  InnoDB create table  engine=memory, \n\n Server \n## \n\n```sql\nmysql -h$ip -P$port -u$user -p\n```\n -p \n\n mysql  TCP \n\n- \"**Access denied for user**\"\n- \n- \n\n\n\n\n show processlist  show processlist  Command Sleep\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648100906726-b843b434-66a0-4c16-923d-149c872f5402.png#averageHue=%23060208&clientId=ub35db475-a524-4&from=paste&id=uec2e5d2a&originHeight=163&originWidth=875&originalType=url&ratio=1&rotation=0&showTitle=false&size=27260&status=done&style=none&taskId=u34b2b0d5-b675-4b6c-a3b8-99d595321e3&title=)\n **wait_timeout ** 8 ** Lost connection to MySQL server during query**\n\n\n\n\n\n MySQL  MySQL OOM MySQL \n\n\n\n- \n-  MySQL 5.7 mysql_reset_connection \n\n## \n select \n\nMySQL  key-value key value  key value \n\nMySQL \n\n****\n\n\n\n MySQL  **query_cache_type**  DEMAND SQL  SQL_CACHE \n```sql\nmysql> select SQL_CACHE * from T where ID=10\n```\nMySQL 8.0  8.0 \n\n## \nMySQL  SQL \n\nMySQL  SQL \n\n SQL MySQL \n\nMySQL \"select\"T TID ID\n\n SQL  MySQL **You have an error in your SQL syntax** select s\n\n## \nMySQL \n\njoin\n\n join\n```sql\nmysql> select * from t1 join t2 using(ID) where t1.c=10 and t2.d=20;\n```\n\n-  t1  c=10  ID  ID  t2 t2  d  20\n-  t2  d=20  ID  ID  t1 t1  c  10\n\n\n\n\n\n## \nMySQL \n\n T  ( precheck )\n\n\n\n T ID \n\n-  InnoDB  ID  10\n- \n- \n\n\n\n\n\n rows_examined \n\n rows_examined \n\n\nmysqlserviceinnodb\nservice \nmysqltcp(8)  mysql\n# \n`DMLinsert,update,delete,create redo log()  binlog() `\n## redo log\n### WAL\n**MySQL  WAL WAL  Write-Ahead Logging**\n MySQL  IO \n\nInnoDB InnoDB \n\n`redo logioredo log `\n`WAL IO   IO  redo log.`\n\nInnoDB  redo log  4  1GB 4GB \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648108055998-29f22c92-5ea3-442e-9fdc-a5bb73578294.png#averageHue=%23f3f0e9&clientId=ub35db475-a524-4&from=paste&id=ub0653dee&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=230615&status=done&style=none&taskId=u4fa0be29-3fc3-491d-8a98-4028c4e8501&title=)write pos  3  0 checkpoint \n\nwrite pos  checkpoint  write pos  checkpoint**** checkpoint \n\n redo logInnoDB  **crash-safe**\n`redo log  InnoDBInnoDB InnoDB redo log() crash-safe mysql`\n\n** redo log  redo log  **\n\n### redo log \n![MySQL redo log ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877429762-363312e7-1539-40de-9cab-ac46d3c8e06c.png#averageHue=%23ecebd6&clientId=u84cf85c6-a1db-4&from=paste&id=ue760740b&originHeight=639&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=59527&status=done&style=none&taskId=ubb09edc4-d7a5-47b0-80c5-4fa65d36482&title=MySQL%20redo%20log%20%E5%AD%98%E5%82%A8%E7%8A%B6%E6%80%81 \"MySQL redo log \")\n\n\n1.  redo log buffer  MySQL \n2.  (write)fsync) page cache \n3.  hard disk\n\n redo log buffer wirte  page cache \n redo log InnoDB  **innodb_flush_log_at_trx_commit** \n\n1.  0  redo log  redo log buffer  ;\n2.  1  redo log \n3.  2  redo log  page cache\n\nInnoDB  1  redo log buffer  write  page cache fsync \n`binlogbinlogbinlog cacheredo logredo log buffer`\n redo log  redo log buffer  redo log ** redo log**\n\n redo log \n\n1. redo log buffer  innodb_log_buffer_size  write fsync page cache`innodb_log_buffer_size  innodb , 8MB`\n2.  redo log buffer  A  redo log  buffer  B  innodb_flush_log_at_trx_commit  1 B  redo log buffer  A  redo log buffer \n\n` innodb_flush_log_at_trx_commit  1 redo log  prepare `\n\n MySQL  1 sync_binlog  innodb_flush_log_at_trx_commit  1 redo logprepare  binlog\n\n## binlog\nMySQL  Server  MySQL ,redo log  InnoDB  Server  binlog\n\n MySQL  InnoDB MySQL  MyISAM MyISAM  crash-safe binlog  InnoDB  MySQL  binlog  crash-safe  InnoDB  redo log  crash-safe \n`binlogcrashbinlog,binlogredologcheck pointwrite pos (write poscheck point)redolog`\n`redo log  binlog  redo log  redo log binlog   crash  redo log  binlog binlog  binlog  innoDB `\n\n\n\n- redo log  InnoDB binlog  MySQL  Server \n- redo log binlog  ID=2  c  1 \n- redo log binlog  binlog \n\n### \n InnoDB  update \n\n1.  ID=2 ID  ID=2 \n2.  1 N N+1\n3.  redo log  redo log  prepare \n4.  binlog binlog \n5.  redo log commit\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648113221297-708a4029-be16-4b31-9538-1ef82cece307.png#averageHue=%23ecede2&clientId=ub35db475-a524-4&from=paste&height=487&id=eROFt&originHeight=731&originWidth=513&originalType=binary&ratio=1&rotation=0&showTitle=false&size=149649&status=done&style=none&taskId=u1d9c41ee-c839-4ec7-a5e3-d67f8b6c729&title=&width=342)\n redo log prepare  commit\"\"\n redo log  binlog  redo log  binlog\n\n update  ID=2  c  0 update  crash\n\n** redo log  binlog** redo log binlog MySQL redo log  c  1 binlog  crash  binlog  binlog  binlog  binlog  c  0\n\n** binlog  redo log** binlog  crash redo log  c  0 binlog  c  0  1 binlog  c  1\n\n\n\n\n\n binlog redo log  binlog \n\nBinlogstatement sql row\n\n**MySQL **\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650437373196-5ae1790e-1e28-4526-992e-88a474a8fc80.png#averageHue=%23edeee2&clientId=u52eb2620-e685-4&from=paste&id=uc6cedb1d&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=634267&status=done&style=none&taskId=u44f064d3-65b6-4987-b3a8-796c757e343&title=)\n1 A  redo log  prepare  binlog crash binlog redo log binlog \n2 B binlog redo log  commit  crash MySQL \n\n-  redo log  commit \n-  redo log  prepare binlog \n   - a. \n   - b. \n\n### binlog\n#### statement\n binlog_format=statement binlog  SQL \n```sql\nmysql> delete from t /*comment*/  where a>=4 and t_modified<='2018-11-10' limit 1;\n\nshow binlog events in 'master.000001';\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876306414-ef659638-160f-4294-86c2-1bedf9932b53.png#averageHue=%23090109&clientId=u84cf85c6-a1db-4&from=paste&id=u0bed92d0&originHeight=213&originWidth=1882&originalType=url&ratio=1&rotation=0&showTitle=false&size=43916&status=done&style=none&taskId=u7696b2bc-d028-4672-b728-7d0c514bfb8&title=)\n BEGIN commit \n\n delete use test MySQL  test  t\n\n#### row\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876481808-6f610fff-712f-4e13-8dba-b32366c53c42.png#averageHue=%23050207&clientId=u84cf85c6-a1db-4&from=paste&id=u2fbfb767&originHeight=533&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=false&size=419977&status=done&style=none&taskId=u21be3baf-c2b0-4a03-99c2-b2487712508&title=)\n statement  binlog  BEGIN  COMMIT row  binlog  SQL  eventTable_map  Delete_rows\n\nTable_map event test  t;Delete_rows event\n binlog_format  row binlog  id binlog  id=4 \n\n#### mixed\n statement  binlog  row  row  delete  10  statement  SQL  binlog  row  binlog 10  binlog  binlog  IO MySQL  mixed  binlogmixed MySQL  SQL  row  statement \n\n### binlog \nbinlog  binlog cache binlog cache  binlog \n\n binlog  binlog cache \n\n binlog cache  binlog_cache_size  binlog cache \n\n binlog cache  binlog  binlog cache\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877216791-c4eec49b-0149-4260-8ae2-1faf6b27731e.png#averageHue=%23a1bd8c&clientId=u84cf85c6-a1db-4&from=paste&id=ucd5cd72c&originHeight=748&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=350828&status=done&style=none&taskId=u7be45086-e9e1-4fca-905f-58cd27461ae&title=)\n binlog cache binlog \n\n write page cache\n fsync fsync  IOPS\nwrite  fsync  **sync_binlog** \n\nsync_binlog=0  write fsyncsync_binlog=1  fsyncsync_binlog=N(N>1)  write N  fsync\n\n IO  sync_binlog  0 100~1000  sync_binlog  N N  binlog \n\n## redo log  binlog ?\n XID redo log prepare commit  redo log\n parepare commit  redo log XID  binlog \nbinlog\n\n\n## \n### LSN\nlog sequence numberLSN\nLSN  redo log  length  redo log LSN  length\n\nLSN  InnoDB  redo log\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877956349-248ca201-d6c2-43a0-ac70-ae7d4c7bce0a.png#averageHue=%23e3e3bf&clientId=u84cf85c6-a1db-4&from=paste&id=ud19e5689&originHeight=2171&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=398351&status=done&style=none&taskId=u4a4d4116-61f8-48a7-bbdb-764b0f1ad4c&title=)\ntrx1  leader trx1  LSN  160trx1  LSN=160 trx1  LSN  160  redo log trx2  trx3 \n\n redo log buffer  fsync  IOPS \n\n\n![](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650878105681-14abb035-6107-418a-b237-a148a90f3feb.png#averageHue=%23f1f2e9&clientId=u84cf85c6-a1db-4&from=paste&id=u3fd2b35f&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=210196&status=done&style=none&taskId=u794cd052-0d6a-467a-8b8e-ad30ca66b63&title=%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%E7%BB%86%E5%8C%96 \"\")\n binlog  **binlog_group_commit_sync_delay**  **binlog_group_commit_sync_no_delay_count** \n**binlog_group_commit_sync_delay**  fsync;\n**binlog_group_commit_sync_no_delay_count**  fsync\n\n**WAL  redo log  binlog?**\n\n- redo log  binlog \n-  IOPS \n\n\n\n## \n****\n\n\n1. innoDBredo log checkpoint redo log checkPoint flushredologredolog\n2. \n3. mysql\n4. mysql\n\nredolog\n\nInnoDB **buffer pool**\n### \ni**nnodb_io_capacity ** InnoDB ,IOPS\n`IOPS:Input/Output Operations Per Second,(I/O)`\n\nInnoDB  redo log \n\n** innodb_max_dirty_pages_pct**  75%InnoDB  M 0  100  F1(M)\n\nredolog,InnoDB  checkpoint  NInnoDB  N  0  100  F2N\n\n F1(M)  F2(N)  R innodb_io_capacity  R% \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650436507824-2065113f-bb0b-4c48-ae9b-c90c853b9f70.png#averageHue=%23edefe4&clientId=u52eb2620-e685-4&from=paste&id=ud0ac7cf8&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u467db1e5-c649-40bd-9c85-90a5b6a7636&title=)\n\n\n\n# \n MySQL MySQL  MySQL  MyISAM  MyISAM  InnoDB \n\n** ACIDAtomicityConsistencyIsolationDurability**\n**:**\n**:**\n**:**\n**:redoLog+binlog**\n\n## \ndirty readnon-repeatable readphantom read\n\n****SQL read uncommittedread committedrepeatable readserializable \n\n- \n- \n- \n- \n\n T  1\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648114969737-ca2280ec-d1d7-403f-ab13-926f1dfe3d99.png#averageHue=%23f2f1ed&clientId=ub35db475-a524-4&from=paste&id=u3d4fa0c4&originHeight=1420&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386590&status=done&style=none&taskId=u2cf5b523-30d0-40be-8854-8517eb9d974&title=)\n A  V1V2V3 \n\n  V1  2 B  A V2V3  2\n\n V1  1V2  2 B  A  V3  2\n\n V1V2  1V3  2 V2  1****\n\n B  1  2 A  B  A  V1V2  1V3  2\n\n**** SQL \n\nOracle  Oracle  MySQL  MySQL (mysql )\n\n** transaction-isolation** ** READ-COMMITTED** show variables \n\n****\n\n\n## \n\n\n MySQL  1  234\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648115713483-7e04eee4-1941-44e6-a4e7-f56490fefa37.png#averageHue=%23f2f1eb&clientId=ub35db475-a524-4&from=paste&id=ubed388d6&originHeight=737&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=248434&status=done&style=none&taskId=u190e6fc5-52a1-48d9-8607-953b27a477b&title=)\n 4 read-view ABC  124MVCC read-view A 1\n\n 4  5 read-view ABC \n\n read-view \n\n\n\n****\n\n`RRread-view,`\n\n MySQL 5.5  ibdata  20GB 200GB \n\n\n\n## \n\n\nMySQL  begin  start transaction commit rollbackset autocommit=0 select \n\n commit  rollback \n\n set autocommit=0  set autocommit=1, \n\n begin\n\n commit work and chain  autocommit  1  begin  commit  commit work and chain begin \n\n\n\n information_schema  innodb_trx  60s \n```sql\nselect * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))>60\n```\n\n\n## \n MySQL \n view create view  \n InnoDB  MVCC  **consistent read view** RCRead Committed RRRepeatable Read\n\n\n\nInnoDB  ID transaction id**** InnoDB \n\n**** transaction id  ID row trx_id (row) row trx_id\n\n![1:](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648431114419-7ad7fe30-7e51-44e9-83e8-381a4139a59c.png#averageHue=%23edefe4&clientId=ubdd7c6a3-1836-4&from=paste&id=u1f4cd4e2&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=349597&status=done&style=none&taskId=u6a2056db-3401-4df7-ae8f-e23a3b4608c&title=%E5%9B%BE1%3A%E8%AE%B0%E5%BD%95%E8%A2%AB%E5%A4%9A%E4%B8%AA%E4%BA%8B%E5%8A%A1%E8%BF%9E%E7%BB%AD%E6%9B%B4%E6%96%B0%E5%90%8E%E7%9A%84%E7%8A%B6%E6%80%81%E3%80%82 \"1:\")\n 4  V4k  22 transaction id  25  row trx_id  25\n\n **undo log** V1V2V3  undo log  V2  V4  U3U2 \n\n\n\n\n`Undo Logs`\n\n\n\n** InnoDB ** ID\n`trx_id`\n\n ID  ID  1 \n\nread-view row trx_id \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648433319988-54447ac9-f2d7-442a-9fdf-d94d9a2584ba.png#averageHue=%23f4efe8&clientId=ubdd7c6a3-1836-4&from=paste&id=u2ff698cc&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=146395&status=done&style=none&taskId=u159b7bfa-f7ad-40c3-a9c8-151a3a6cb32&title=)\n**** row trx_id\n\n1. \n2. \n3. \n   -  row trx_id \n   -  row trx_id \n\n`IDID[1,2,3,5]41-54`\n`id 99100102104105id 101103 99`\n`**ABAB ABBA**`\n\n **InnoDB **\n\n\n```sql\nmysql> CREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `k` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB;\ninsert into t(id, k) values(1,1),(2,2);\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436642991-cb96c42e-1d75-451f-8bfe-da1fe5ce2c8d.png#averageHue=%23fafafa&clientId=ubdd7c6a3-1836-4&from=paste&id=u88640d3b&originHeight=509&originWidth=910&originalType=url&ratio=1&rotation=0&showTitle=false&size=77588&status=done&style=none&taskId=ua2ee9126-6b57-46ec-8113-c6447e13318&title=)\nbegin/start transaction  InnoDB ** start transaction with consistent snapshot** \n\n start transaction with consistent snapshot \n\n\n A  ID  99\n ABC  100101102\n(1,1 row trx_id  90\n A [99,100],  B [99,100,101],  C [99,100,101,102]\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436831411-e1b8b943-71ac-4b16-90d6-cdc022316d02.png#averageHue=%23bbcaae&clientId=ubdd7c6a3-1836-4&from=paste&id=uf77228b9&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=389463&status=done&style=none&taskId=ucfa9e2d6-3e31-4da4-8fb4-27f1046d8bb&title=)\n`A102102AA2(cA)`\n\n C (1,1)  (1,2) row trx_id  102 90 \n\n B (1,2)  (1,3) row trx_id 101 102 \n``\n\n A [99,100] A \n\n-  (1,3)  row trx_id=101()\n-  row trx_id=102\n- 1,1) row trx_id=90\n\n A \n\n** B  update **\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648438902227-33dfff5b-7752-42f9-ae8f-4ba54824af5b.png#averageHue=%23c2d0b7&clientId=ubdd7c6a3-1836-4&from=paste&id=u29cc65f6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=181203&status=done&style=none&taskId=ubc0f1fa8-0770-462c-a1c2-f5bf051a302&title=)\n B  C  (1,2)  (1,3) \n B  k  1\n\n**current read**\n`CBCB  CBCB`\n\n (1,2) (1,3) row trx_id  101\n\n B  101 101 k  3\n\n update select \n\n A  select * from t where id=1  **lock in share mode**  **for update** 101  k  3 select S ****X ****\n``\n``\n```sql\nmysql> select k from t where id=1 lock in share mode;\nmysql> select k from t where id=1 for update;\n```\n\n C  C\t\t\t\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439136431-4b35da83-71d7-4f2e-aacc-34b0b870f86b.png#averageHue=%23f9f9f9&clientId=ubdd7c6a3-1836-4&from=paste&id=u555af770&originHeight=565&originWidth=906&originalType=url&ratio=1&rotation=0&showTitle=false&size=90942&status=done&style=none&taskId=u257c13bb-7de7-4653-ae0c-08c330e0e8d&title=)\n C B  C (1,2)  B \n\n C (1,2)  B ******** C\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439181432-b5b054ed-4f67-44a5-b6a0-63dfd27c5fe5.png#averageHue=%23c1cfb6&clientId=ubdd7c6a3-1836-4&from=paste&id=u28580c0d&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=337234&status=done&style=none&taskId=u654b2065-2bcb-4bfc-9b0f-587f4f74d55&title=)\n\n**consistent read**\n\n\n\n- \n- \n\n A  B  k\n`start transaction with consistent snapshot;  start transaction`\n\n read view  C  C\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439281611-5d682321-af61-48bc-87f1-c12fcaf0b6ae.png#averageHue=%23a0b792&clientId=ubdd7c6a3-1836-4&from=paste&id=u3133d187&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=534050&status=done&style=none&taskId=u99b6227f-1384-4887-a71b-d08f6a30f1b&title=)\n\n A  (1,2)(1,3) (1,3) (1,2)  \n A  k=2\n B  k=3\n\n row trx_id\n\nMySQL 8.0  InnoDB \n\n\n# \n 500 \n\n`   +  `\n\n## \n - key-value key Value key  value \n\n key \n\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172350141-1148f1ae-5357-4246-9e55-df37b38e9a0c.png#averageHue=%23ebede1&clientId=ub38593e9-da58-4&from=paste&id=u711c2508&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=394076&status=done&style=none&taskId=ue30f032e-37eb-4230-8d4b-9bab7ebb4ed&title=)\nUser2  User4  N ID_card_n2  ID_card_n2  N User2\n\n ID_card_n  User ****\n\n[ID_card_X, ID_card_Y]\n\n Memcached  NoSQL \n\n## \n\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172988285-612ee6fd-9e8e-40e7-9548-c8f73834f70f.png#averageHue=%23eff0e7&clientId=ub38593e9-da58-4&from=paste&id=u523f9001&originHeight=787&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=261326&status=done&style=none&taskId=u52aeb952-9eaa-40a9-9029-3f108f01bad&title=)\n ID_card_n2  O(log(N))\n\n[ID_card_X, ID_card_Y] User ID_card_X ID_card_X ID_card_X  User ID_card_Y \n\n\n\n 2017 \n\n## \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648173122656-422a42b5-a1f1-4d77-bc75-06766e296dff.png#averageHue=%23edeee5&clientId=ub38593e9-da58-4&from=paste&id=ue2441f8f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=445439&status=done&style=none&taskId=u5719c66d-7877-4064-a4df-e1c3f17715c&title=)\n ID_card_n2  UserA -> UserC -> UserF -> User2  O(log(N))\n\n O(log(N))  O(log(N))\n\n\n\n 100  20 20  10 ms  100  20  10 ms \n\nN N N\n\n InnoDB  N  1200 4  1200  3  17  10  3 \n\n MySQL  InnoDB  MySQL \n## InnoDB \n InnoDB InnoDB  B+  B+ \n\n InnoDB  B+  ID  k k \n\n R1~R5  (ID,k)  (100,1)(200,2)(300,3)(500,5)  (600,6)\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648177404439-962473ed-5691-4733-977e-7e121ac1f8e2.png#averageHue=%23f2f1eb&clientId=ub38593e9-da58-4&from=paste&id=ua47e1a1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=302521&status=done&style=none&taskId=u9f6a80ce-67fa-4e12-ab52-1cb35124172&title=)\n InnoDB ****clustered index InnoDB ****secondary index\n\n### \n\n-  select * from T where ID=500 ID  B+ \n-  select * from T where k=5 k  ID  500 ID \n\n\n\n### \nB+  ID  700 R5  ID  400\n\n R5  B+ \n\n 50%\n\n\n\n\n\n\n\n 20  4 bigint 8 \n\n****\n\n### \n select ID from T where k between 3 and 5 ID  ID  k  k \n\n\n\n### \n\n\n**B+ **\n\nnameage\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648178687735-90c51b38-d3f9-46aa-8227-852cde96647f.png#averageHue=%23f2f1ea&clientId=ub38593e9-da58-4&from=paste&id=u6826c5cc&originHeight=818&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=289776&status=done&style=none&taskId=uff5cb309-bf12-4c5c-8c3d-d7614291dbb&title=)\n\n``\n\n ID4\n\n SQL \"where name like  %\" ID3\n\n N ** M **\n\n****\n\n (a,b)  a ****\n\n ab  b  (a,b)  (a,b)(b) \n\nname  age  name,age)  (age) \n\n### \nname, age 10 SQL \n```sql\nmysql> select * from tuser where name like '%' and age=10 and ismale=1;\n```\n  ID3 \n\n`(a,b)aab21003150450` \n\n MySQL 5.6  ID3 \n\n MySQL 5.6  ID3 \n\n MySQL 5.6 ****index condition pushdown) \n:\n![](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179582601-8505ffa6-926a-4b92-8a9f-76f28a3f3dec.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ubb129163&originHeight=833&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=290640&status=done&style=none&taskId=u3696a908-4b07-4f0b-aaf8-eaeaa6a5005&title=%E6%97%A0%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B \"\")\n![](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179640502-b73960eb-e5ca-4c60-b294-026553498c3f.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ue7b7341e&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=289593&status=done&style=none&taskId=u7d11f6c5-1ec1-4daf-9d2c-91219c7d68a&title=%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B \"\")\n\n  (name,age)  age  InnoDB  age name  4 \n\n InnoDB  (name,age)  age  10 10  ID4ID5  2 \n\n### explain\nselectexplain\n```sql\nmysql> explain select * from servers;\n+----+-------------+---------+------+---------------+------+---------+------+------+-------+\n| id | select_type | table   | type | possible_keys | key  | key_len | ref  | rows | Extra |\n+----+-------------+---------+------+---------------+------+---------+------+------+-------+\n|  1 | SIMPLE      | servers | ALL  | NULL          | NULL | NULL    | NULL |    1 | NULL  |\n+----+-------------+---------+------+---------------+------+---------+------+------+-------+\n```\ntype:\n**NULL**\nMySQL\n**constsystem**\nMySQLwhereMySQL,systemconstsystem\n**eq_ref**\nrefprimary key unique key\n**ref**\n\n**range**\n\ni**ndex**\nFull Index ScanindexALLindex\n**ALL**\nFull Table Scan MySQL\n\n\n# \n## \nMySQL ** Flush tables with read lock** (FTWRL)\n\n select \n\n FTWRL \n\n binlog\n\n mysqldump mysqldump single-transaction  MVCC \n\n FTWRL  MyISAM  FTWRL \n\nsingle-transaction  FTWRL  DBA  InnoDB  MyISAM \n\n\n## \nMySQL meta data lockMDL)\n\n### \n** lock tables  read/write** FTWRL  unlock tables lock tables \n\n,  A  lock tables t1 read, t2 write;  t1 t2  A  unlock tables  t1 t2  t1 \n\n InnoDB  lock tables \n\n### MDL\n MDLmetadata lock)MDL MDL \n\n MySQL 5.5  MDL MDL  MDL \n\n- \n- \n\n``\n(DDL ) DML()\n\n t \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648189243388-65fe8441-51c7-4a86-bc57-4e15975df962.png#averageHue=%23f0eee7&clientId=ue989aaab-00e7-4&from=paste&id=ubbc20e7c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=286437&status=done&style=none&taskId=u0e1bcf88-be7f-4897-990e-fe397bfb3af&title=) session A  t  MDL  session B  MDL \n\n session C  blocked session A  MDL  session C  MDL \n\n session C  t  MDL  session C  MDL \n\n session \n` sessionc   sessionc    block `\n\n MDL \n``\n\n****\n MDL  MySQL  information_schema  innodb_trx  DDL  DDL kill \n\n\n\n kill  alter table  MDL  DBA \n\nMariaDB  AliSQL  DDL NOWAIT/WAIT n \n\n```java\nALTER TABLE tbl_name NOWAIT add column ...\nALTER TABLE tbl_name WAIT N add column ...\n```\n\n## \nMySQL  MyISAM InnoDB  MyISAM  InnoDB \n\n A  B  A \n\n** InnoDB **\n\n\n\n` `\n\n### \n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648219769688-d2a63c64-b371-44de-871f-06f8f19bf9ca.png#averageHue=%23eeeee3&clientId=u2e8a2ebc-6522-4&from=paste&id=u3244e8e4&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=299114&status=done&style=none&taskId=u44d2fac4-01da-4283-824c-45fb342615b&title=)\n A  B  id=2  B  A  id=1   A  B \n\n- ** innodb_lock_wait_timeout** \n-  **innodb_deadlock_detect ** on\n\n InnoDB innodb_lock_wait_timeout  50s 50s  1s\n\n innodb_deadlock_detect  on\n\n\n\n O(n)  1000  100  CPU  CPU \n\n?\n\n****\n\n**** 10  600  5  3000\n\n**** MySQL  MySQL **** InnoDB \n\n 10  10  1/10 CPU \n\n## \n**bug**\n 1 next-key lock`next-key lock `\n 2\n 1next-key lock \n 2next-key lock \n bug\n```sql\nCREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(0,0,0),(5,5,5),\n(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n```\n### ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196785720-81dc67d8-9362-460f-8c72-124925f32c83.png#averageHue=%23f9f9f9&clientId=u3a41a891-d6bd-4&from=paste&id=u3fc85d1e&originHeight=462&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=87911&status=done&style=none&taskId=uc6cee32e-a121-46ec-bd29-bc18a18beb1&title=)\n session A  c  c=5 \n\n-  1 next-key lock (0,5] next-key lock\n-  c  c=5  c=10  2 (5,10] next-key lock\n-  2 c=5  (5,10)\n-  2  session B  update \n\n session C  (7,7,7)  session A  (5,10) c\n\nlock in share mode  for update   for update \n\n lock in share mode  session A  select d from t where c=5 lock in share mode\n\n### \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196929106-7660a1a3-6640-4347-b798-5c4b471bc95b.png#averageHue=%23fafafa&clientId=u3a41a891-d6bd-4&from=paste&id=ua535fe5d&originHeight=313&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=55984&status=done&style=none&taskId=uf85c6652-35de-4ff4-98b8-dd0793c5afe&title=)\n 1 next-key locksession A  (5,10]\n 2 (id=7) id=10 next-key lock  (5,10)\nsession B  id=8  session C  id=10 \n\n### \n```sql\nmysql> select * from t where id=10 for update;\nmysql> select * from t where id>=10 and id<11 for update;\n```\n\n session A \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650197044039-7a303e5d-1b56-41bc-a529-eb7c6ffecd40.png#averageHue=%23fbfafa&clientId=u3a41a891-d6bd-4&from=paste&id=ub5ac83fc&originHeight=718&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=124356&status=done&style=none&taskId=u0ef12a21-8e64-4984-9f19-cc8fbc4fc53&title=)\n\n-  id=10  next-key lock(5,10]  1  id   id=10 \n-  id=15  next-key lock(10,15]\n\nsession A  id=10  next-key lock(10,15]session B  session C \n\n## \n**insert**** deleteupdate**\n\n****\n`select for updateselect in share mode`\n\n****\n`a ,  ,10, 10, b, a. , a, a, , 11... .`\n** **\n### \n```sql\nCREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(0,0,0),(5,5,5),\n(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n```\nInnoDB  (Gap Lock)\n5(id 0510152025) 7 \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1649992660264-65dd581d-b5b9-4976-8485-8772530f2194.png#averageHue=%23f4f2ed&clientId=u0e71056a-b30e-4&from=paste&id=Kt72W&originHeight=550&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=76936&status=done&style=none&taskId=u94793186-c86f-4978-bdda-8140978c040&title=)\n select * from t where id=5 for update 6  7 \n` id=1 `\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993034198-38b45746-5725-4dde-9da9-98a6171fd13a.png#averageHue=%23fafafa&clientId=u0e71056a-b30e-4&from=paste&id=EM16B&originHeight=154&originWidth=411&originalType=url&ratio=1&rotation=0&showTitle=false&size=12389&status=done&style=none&taskId=ue83bb8ed-a0fa-420d-ba7d-63351017074&title=)\n\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993266628-29fe8369-3579-4a77-89e8-cbd0cc4871c4.png#averageHue=%23f9f9f9&clientId=u0e71056a-b30e-4&from=paste&id=lvjx5&originHeight=210&originWidth=946&originalType=url&ratio=1&rotation=0&showTitle=false&size=35886&status=done&style=none&taskId=ufcfa8103-a650-4c06-b4b9-a2b2d3bd682&title=)\nc7  \n\n next-key lock next-key lock  t  select * from t for update  7  next-key lock (-,0](0,5](5,10](10,15](15,20](20, 25](25, +supremum]\n\n` supremum  +InnoDB  supremum`\n# Join\n##  NLJ\n```sql\n\nCREATE TABLE `t2` (\n  `id` int(11) NOT NULL,\n  `a` int(11) DEFAULT NULL,\n  `b` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `a` (`a`)\n) ENGINE=InnoDB;\ncreate table t1 like t2;\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650953541569-e9649522-4b4b-48c8-a1f7-4b2031bd1563.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u90881f8f&originHeight=163&originWidth=1394&originalType=url&ratio=1&rotation=0&showTitle=false&size=31471&status=done&style=none&taskId=ua6df17c9-4a06-4638-95b5-21c16652669&title=)\n\n\n1.  t1  R\n2.  R  a  t2 \n3.  t2  R \n4.  1  3 t1 \n\nIndex Nested-Loop Join NLJ\n** join **\n\n## BNL\n```sql\nselect * from t1 straight_join t2 on (t1.a=t2.b);\n```\n\n`Block Nested-Loop Join BNL`\n\n1.  t1  join_buffer  select * t1 \n2.  t2 t2  join_buffer  join \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954146426-5e868fc8-9ad5-4b5f-b757-c2f09ada4833.png#averageHue=%23edeee5&clientId=u9f841287-a109-4&from=paste&id=uf584d183&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=209296&status=done&style=none&taskId=ue49e250b-56bf-4280-b030-62a5d419e01&title=)\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954156660-9fdff866-3e36-4a30-8565-51856356f1fc.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u996c909a&originHeight=164&originWidth=1763&originalType=url&ratio=1&rotation=0&showTitle=false&size=35157&status=done&style=none&taskId=u0c33c4a8-b702-4f8c-9f31-70491336d60&title=)\n t1  t2  1100 join_buffer  t2  100 100*1000=10 \n?\n\n N M M+N M*N\nNM\n\njoin_buffert1mysql****\n join_buffer\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954434057-b82dcdd6-f89a-42cb-b067-9c45e777e1ac.png#averageHue=%23ebece1&clientId=u9f841287-a109-4&from=paste&id=u2a584d0a&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=291462&status=done&style=none&taskId=u8f432b2f-13dd-47a2-9beb-2f0043323ed&title=)\n 4  5 join_buffer \n\n N K  M K N  K  K *N (0,1)\n\n N+*N*M N*M  \njoin_buffer_sizejoin_buffer_size  join  join_buffer_size \n\n** join **\n\n## BKA\nBatched Key Access(BKA)NLJ\n\n`Multi-Range Read  (MRR)`\n\nNLJ  t1 a  t2  join t2 MRR  t2  t1  t2\n\n t1  join_buffer\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650955774308-bf38ea60-0d50-4b0b-a3da-cbd9b6a031eb.png#averageHue=%23dae2cf&clientId=u9f841287-a109-4&from=paste&id=u1b2c7b3b&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=143155&status=done&style=none&taskId=uec77b0b5-13d3-42fb-969d-134a255c2b9&title=)\n\n join_buffer  P1~P100 join buffer  P1~P100  100 \n\n```sql\n\nset optimizer_switch='mrr=on,mrr_cost_based=off,batched_key_access=on';\n```\n MRRBKA  MRR\n\n\n# InnoDB  Memory \nInnoDB  idIndex Organizied Table\n Memory Heap Organizied Table\n\n:\n\n1. InnoDB \n2. InnoDB \n3. InnoDB \n4. InnoDB \n5. InnoDB  Blob  Text  varchar(N) char(N)\n\n\n Memory  hash \n\n\n\n\n- \n- \n\n# \n## \n  \n\n\n\n\n\nInnoDB  InnoDB  16KB\n\n k=5 \n\n\n### change buffer\nInnoDB  change buffer  change buffer \n\n change bufferchange buffer \n`change buffer ibdata1change bufferredo logibdata1`\n\n change buffer  merge merge  mergeshutdown merge \n\n (4,400)  k=4  change buffer \n\nchange buffer  buffer pool change buffer  innodb_change_buffer_max_size  50  change buffer  buffer pool  50%\n`Buffer Pool  innodb_buffer_pool_size Buffer Pool `\n\n\nInnoDB \n\n- \n-  \n\nInnoDB \n\n- \n-  change buffer\n\n IO change buffer \n\n change buffer \n\n merge  change buffer  merge change buffer \n\n change buffer \n\n change buffer merge  IO  change buffer change buffer \n\n\n\n change bufferchange buffer \n\n### change buffer  redo log\n\n```sql\ninsert into t(id,k) values(id1,k1),(id2,k2);\n```\nk1  (InnoDB buffer pool) k2 \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448480028-98b82840-60c9-4dec-a9da-fa2e7f384d1e.png#averageHue=%23a7bc99&clientId=ubdd7c6a3-1836-4&from=paste&id=u386044d6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=523388&status=done&style=none&taskId=udf24454a-a8ef-49b0-b750-fc23cf86083&title=)\n\n\n1. Page 1 \n2. Page 2  change buffer  Page 2 \n3.  redo log  3  4\n\n\n\n\n\n select * from t where k in (k1, k2)\n`ibdata1 redo logib_log_fileX`\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448593841-dadf2d65-6d2f-4a8f-b8ed-6e5fa1737979.png#averageHue=%23bfcdb3&clientId=ubdd7c6a3-1836-4&from=paste&id=u55f462e7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=382614&status=done&style=none&taskId=u1afa9e5d-34f7-4de8-8b10-99e34853198&title=)\n Page 1 WAL  redo log \n\n Page 2  Page 2  change buffer merge\n\n Page 2 \n\n## MySQL\n SQL  MySQL \t\n`mysqlmysqlserver`\n\n CPU \n\n\n\nMySQL \n\ncardinality\n\n show index \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648454396086-286835f4-56a0-4855-bbdb-929959b8897c.png#averageHue=%23090109&clientId=ubdd7c6a3-1836-4&from=paste&id=u25bc3d64&originHeight=209&originWidth=1850&originalType=url&ratio=1&rotation=0&showTitle=false&size=42815&status=done&style=none&taskId=uac7e024d-d508-470a-9a49-13b6181534f&title=)\n\nMySQL  MySQL \n\nInnoDB  N \n\n 1/M \n\n MySQL  innodb_stats_persistent \n on  N  20M  10\n off  N  8M  16\n\n## MySQL\n SQL \n\nInnoDB  redo log redo log \n\n\n\n\n\n MySQL flush\n\n** flush **\n\n1. InnoDB  redo log  checkpoint redo log \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648456454734-b1c65cc5-a2d1-474b-95f6-935db1efad7a.png#averageHue=%23f3f0ea&clientId=u6601b37f-239d-4&from=paste&id=X7cS6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=255505&status=done&style=none&taskId=ued0fa08d-ba43-47ee-949d-335a83988ba&title=)\n`checkpoint  checkpoint  CP  CP flush  write pos  CP redo log `\n\n2. \n3. MySQL \n4. MySQL MySQL  flush  MySQL \n\nInnoDB \n\n\n\n\n\n- \n-  0\n\nInnoDB \n\n### InnoDB \n\ninnodb_io_capacity  InnoDB  IOPS IOPS  fio \n```shell\n\n fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest \n```\n**InnoDB  redo log **\n\nInnoDB \n\n innodb_max_dirty_pages_pct  75%InnoDB  M 0  100 (F1(M))\n```sql\nF1(M)\n{\n  if M>=innodb_max_dirty_pages_pct then\n      return 100;\n  return 100*M/innodb_max_dirty_pages_pct;\n}\n```\nInnoDB  checkpoint  NInnoDB  N  0  100  F2(N)F2(N)  N \n\n F1(M)  F2(N)  R innodb_io_capacity  R% \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648457335769-b4d029f5-e5db-49f4-afac-8d4da16e3500.png#averageHue=%23edefe4&clientId=u6601b37f-239d-4&from=paste&id=uf9222f00&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u86033bb8-9020-4268-a3f2-4bffcba8a75&title=)\n 75%\n\n Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_total \n```sql\nmysql> select VARIABLE_VALUE into @a from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_dirty';\nselect VARIABLE_VALUE into @b from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_total';\nselect @a/@b;\n```\n\n flush  MySQL \n\n InnoDB innodb_flush_neighbors  1  0 \n\n## \n###  innodb_file_per_table\n innodb_file_per_table \n\n-  OFF \n-  ON  InnoDB  .ibd \n\n MySQL 5.6.6  ON \n\n drop table \t\n\n innodb_file_per_table  ON\n\n### \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648458246901-2059df42-0c96-480b-ab06-32e2de24bf39.png#averageHue=%23f1f1eb&clientId=u6601b37f-239d-4&from=paste&id=u60cc30d7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=125104&status=done&style=none&taskId=uea35a2b3-8b62-4c81-996a-89295f00942&title=)\n R4 InnoDB  R4  ID  300  600  ()\n\nR4  ID  400  ID  800 \n\n B+   page A page A  ID=50 page A \n\n\n\n delete \n\ndelete  delete \n\n\n\n\n page A \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648459031612-11d73511-84fb-4435-a36c-041513621a6e.png#averageHue=%23ecece4&clientId=u6601b37f-239d-4&from=paste&id=ub5d91120&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386541&status=done&style=none&taskId=u936777ff-9e33-4869-a5d0-ec6cc0b8295&title=)\n page A  ID  550  page B page A  1 \n\n\n\n### \n A\n\n A  B ID  A  B \n\n B  A  B  B  B  A  B  B  A A \n\n **alter table A engine=InnoDB**  MySQL 5.5  B MySQL \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460656185-14aee1dd-885c-47b2-a030-28ea6ec8cb57.png#averageHue=%23eae9df&clientId=u6601b37f-239d-4&from=paste&id=u9c4de8a8&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=514037&status=done&style=none&taskId=uc61ce6a1-1af4-40f9-a3aa-94c8c8cbb13&title=)\n\n A  DDL  A  DDL  Online \n\n** MySQL 5.6  Online DDL**\n\n Online DDL \n\n1.  A \n2.  A  B+ \n3.  A row log state2 \n4.  A  state3 \n5.  A \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460673335-4500620b-e333-4439-8366-d2f4c69765aa.png#averageHue=%23e8e8dd&clientId=u6601b37f-239d-4&from=paste&id=u53977a6f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=397982&status=done&style=none&taskId=u68a17300-301c-4350-b4ff-8913ac7b306&title=)\n`Online DDL MDL, MDLMDLOnline MDL`\n\n## count(*)\n### count(*) \n\n- MyISAM  count(*) \n-  InnoDB  count(*) \n\n`MyISAM count whereInnoDB`\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648518819244-17e71729-17f5-41d0-af7f-c120ae34b61d.png#averageHue=%23f9f9f9&clientId=ue5c9d5d3-f062-4&from=paste&id=u1d9077ed&originHeight=362&originWidth=943&originalType=url&ratio=1&rotation=0&showTitle=false&size=68577&status=done&style=none&taskId=u52029278-5cd6-4933-bd23-f236702007c&title=)\n InnoDB  MVCC  count(*) InnoDB \n\nInnoDB  count(*) **MySQL **\n\n###  count \ncount()  count  NULL 1\n\ncount(*)count( id)  count(1)  count( NULL \n\n** count( id) **InnoDB  id  server server  id \n\n** count(1) **InnoDB ****server 1\n\ncount(1)  count( id)  id \n\n** count() ** not null  null\n null null null \n\n** count(*) **count(*)  null\n\n**count()<count( id)<count(1)count(*)**\n\n## order by\n\n### \n```sql\nselect city,name,age from t where city='' order by name limit 1000  ;(city)\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563803148-12d05c2e-862d-41a3-92cc-079081c02eec.png#averageHue=%2305040e&clientId=ub49b8c3b-28e5-4&from=paste&id=u51b876bf&originHeight=126&originWidth=1470&originalType=url&ratio=1&rotation=0&showTitle=false&size=275103&status=done&style=none&taskId=u04ab12bb-161a-4189-8085-6ff37e68c53&title=)\nExtra Using filesortMySQL  sort_buffer\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563889459-6771ce6b-40c0-43fe-b195-d8b4fd06dba4.png#averageHue=%23f1f0ea&clientId=ub49b8c3b-28e5-4&from=paste&id=u5ad65b3c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=244167&status=done&style=none&taskId=u4687b797-6402-426d-b26f-c616d1dcf1f&title=)\n city=' ID_X  ID_(X+N) \n \n\n1.  sort_buffer namecityage \n2.  city  city=' id ID_X\n3.  id  namecityage  sort_buffer \n4.  city  id\n5.  34  city  id  ID_Y\n6.  sort_buffer  name \n7.  1000 \n\n name  sort_buffer_size\n\nsort_buffer_size MySQL sort_buffer sort_buffer_size\n\n\n```sql\n/* optimizer_trace */\nSET optimizer_trace='enabled=on'; \n\n/* @aInnodb_rows_read */\nselect VARIABLE_VALUE into @a from  performance_schema.session_status where variable_name = 'Innodb_rows_read';\n\n/*  */\nselect city, name,age from t where city='' order by name limit 1000; \n\n/*  OPTIMIZER_TRACE  */\nSELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\\G\n\n/* @bInnodb_rows_read */\nselect VARIABLE_VALUE into @b from performance_schema.session_status where variable_name = 'Innodb_rows_read';\n\n/* Innodb_rows_read */\nselect @b-@a;\n```\n OPTIMIZER_TRACE  number_of_tmp_files \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648564689820-6f0d8fa4-6687-4e4f-ad20-5e6a1d4a1280.png#averageHue=%23090109&clientId=ub49b8c3b-28e5-4&from=paste&id=ud81073ab&originHeight=183&originWidth=713&originalType=url&ratio=1&rotation=0&showTitle=false&size=103799&status=done&style=none&taskId=ufc87cf83-e1f6-4102-90a8-7243ba19e13&title=)\nnumber_of_tmp_files  12 MySQL  12  12 \n\n sort_buffer_size number_of_tmp_files  0\n\n**sort_buffer_size **number_of_tmp_files sort_buffer_sizesort_buffer_size\n\n**examined_rows=4000 4000 **\n\n**sort_mode  packed_additional_fields  name  varchar(16)**\n\n** select @b-@a  4000 4000 **\n\n### rowid \n\n\n sort_buffer ** sort_buffer **\n\n\n\n MySQL ?\n\n MySQL \n```sql\nSET max_length_for_sort_data = 16;\n```\nMySQL MySQL \n\n sort_buffer  name  id\n\n city  age \n\n1.  sort_buffer name  id\n2.  city  city=' id ID_X\n3.  id  nameid  sort_buffer \n4.  city  id\n5.  34  city=' ID_Y\n6.  sort_buffer  name \n7.  1000  id  cityname  age \n\nrowid  t  7\n\n MySQL  sort_buffer  id cityname  age ``\n\n**rowid  OPTIMIZER_TRACE **\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566128890-cf3076d8-183b-4f66-95fb-6db07943954f.png#averageHue=%23080109&clientId=ub49b8c3b-28e5-4&from=paste&id=u025fd973&originHeight=183&originWidth=468&originalType=url&ratio=1&rotation=0&showTitle=false&size=93232&status=done&style=none&taskId=uaae4be2c-c501-4cc6-b296-5a9fed1e59a&title=)\n**select @b-@a  5000 ** id  limit 1000 1000 \n\n**sort_mode  <sort_key, rowid>** name  id \n\n**number_of_tmp_files  10 ** 4000 \n\n MySQL  rowid \n\n MySQL  sort_buffer \n\n MySQL ****\n\n order by MySQL ****\n\n city  name \n\n city  name \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566346093-471e3c9b-0b83-4c38-95cd-1c6b5d7f58ca.png#averageHue=%23f0efe8&clientId=ub49b8c3b-28e5-4&from=paste&id=u9d957077&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=250929&status=done&style=none&taskId=ub68238d3-09db-4d04-9d04-8aa7a1bb945&title=)\n city=' city name \n\n\n\n1.  (city,name)  city=' id\n2.  id  namecityage \n3.  (city,name)  id 23\n4.  1000  city='\n\n![ (city,name) ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566428823-b2716a19-cb2c-48a4-a0ad-94552cf1ae7d.png#averageHue=%2307020a&clientId=ub49b8c3b-28e5-4&from=paste&id=u30022e94&originHeight=127&originWidth=1382&originalType=url&ratio=1&rotation=0&showTitle=true&size=250223&status=done&style=none&taskId=u72da902c-04e1-462b-87e2-4c65adca397&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92 \" (city,name) \")\n`rows,Using index condition ICP` \n\nExtra  Using filesort  (city,name)  4000  1000 ** 1000 **\n\n cityname  age \n\n cit\ty  name \n\n1.  (city,name,age)  city=' cityname  age \n2.  (city,name,age) \n3.  2 1000  city='\n\n![ (city,name,age) ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566612447-97a4f6c2-8f67-4a0b-8614-eb63ab8093aa.png#averageHue=%2306030d&clientId=ub49b8c3b-28e5-4&from=paste&id=ufc70bd2c&originHeight=125&originWidth=1586&originalType=url&ratio=1&rotation=0&showTitle=true&size=266076&status=done&style=none&taskId=u3093dc9d-f32b-4b81-b102-2d08dd4fe1b&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%2Cage%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92 \" (city,name,age) \")Extra Using index\n\n## order by rand()\n```sql\nselect word from words order by rand() limit 3;\n```\n 3  SQL \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648802439889-2e2907be-5fc4-411a-b79f-f9a29153b597.png#averageHue=%2308020a&clientId=ud645e606-5915-4&from=paste&id=u14caa359&originHeight=142&originWidth=1553&originalType=url&ratio=1&rotation=0&showTitle=false&size=269434&status=done&style=none&taskId=uc50316d7-c136-4ce7-92d6-3c16c7a8496&title=)\nExtra  Using temporaryUsing filesort\n\n InnoDB \nMySQL  rowid \n\n:\n\n1.  memory  double  R varchar(64)  W\n2.  words  word  word  rand()  0  1  word  R  W  10000\n3.  10000  R \n4.  sort_buffersort_buffer  double \n5.  R  sort_buffer  10000 20000\n6.  sort_buffer  R \n7.  word  20003\n\n InnoDB  6  rowid rowid  InnoDB  rowid  ID InnoDB  rowid MEMORY  rowid \n\n**order by rand()  rowid **\n\n****\n\n**tmp_table_size ** 16M tmp_table_size\n\n InnoDB **internal_tmp_disk_storage_engine** \n InnoDB \n\n### \n SQL  R  3  rowid 3  10000  9997 \n\n``\n\n-  10000  (R,rowid)\n-  (R,rowid) R  R R (R,rowid)  (R,rowid)\n-  2  10000  (R,rowid) \n\n```sql\nselect city,name,age from t where city='' order by name limit 1000  ;\n```\n limit SQL  limit 1000 1000  (name,rowid) sort_buffer_size `limit 3 sort_buffer_size `\n\n## group by\n```sql\ncreate table t1(id int primary key, a int, b int, index(a));\ndelimiter ;;\ncreate procedure idata()\nbegin\n  declare i int;\n\n  set i=1;\n  while(i<=1000)do\n    insert into t1 values(i, i, i);\n    set i=i+1;\n  end while;\nend;;\ndelimiter ;\ncall idata();\n```\n```sql\nselect id%10 as m, count(*) as c from t1 group by m;\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112503277-b1df9ad1-1d95-417a-b8e9-48a390770a29.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=ua744d424&originHeight=143&originWidth=1702&originalType=url&ratio=1&rotation=0&showTitle=false&size=30065&status=done&style=none&taskId=u53a60222-d9e4-44f3-a5c7-c090d7a9176&title=)\n Extra \n\n- Using index a\n\n`selectidaa  mysqla`\n\n- Using temporary\n- Using filesort\n\n:\n\n-  m  c m\n-  t1  a id  id%10  x\n-  x  (x,1);\n-  x  x  c  1 m \n### ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112629688-9b998014-3798-4028-931b-9518eb10ce2a.png#averageHue=%23eceee3&clientId=ud1598026-e3a9-4&from=paste&id=u878ce08e&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=184375&status=done&style=none&taskId=ub60c1c98-b904-4010-937c-eea5dfc94e9&title=)group by  -- \ngroup by  group by \n\n** group by **\ngroup by  id%100 \n\n\ngroup by \n\n### group by  -- \n group by  group by \n\n group by  SQL_BIG_RESULT hint\n```sql\nselect SQL_BIG_RESULT id%100 as m, count(*) as c from t1 group by m;\n```\nMySQL  B+ \n\n\n-  sort_buffer m\n-  t1  a id ,  id%100  sort_buffer \n-  sort_buffer  m  sort_buffer \n- \n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113519486-bb3649d2-8c16-4e6a-8062-50510591e8a6.png#averageHue=%23ecede2&clientId=ud1598026-e3a9-4&from=paste&id=u6443cf73&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=210067&status=done&style=none&taskId=u0c92938c-024f-4ede-8a67-6aa3e16f37b&title=)\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113533494-091befc2-665e-42da-a822-2fa5fc25cb92.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=u68823f55&originHeight=131&originWidth=1393&originalType=url&ratio=1&rotation=0&showTitle=false&size=26738&status=done&style=none&taskId=u04fcce2b-a93b-4148-a3cf-bb5c45ac1b9&title=)\n Extra \n** group by  tmp_table_size **\n### MySQL \n\n1. \n2. join_buffer sort_buffer \n3. union  group by \n\n\n## \n```sql\nmysql> select count(*) from tradelog where month(t_modified)=7;\n\nt_modified\n\n```\nsql MySQL \n![t_modified ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822518074-948569d9-c7f4-49f5-9441-51b175a23451.png#averageHue=%23f0f1e8&clientId=ud5261830-7282-4&from=paste&id=ua20d9e1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=191123&status=done&style=none&taskId=u64ba332a-9084-4148-a92a-ecdce1abbba&title=t_modified%20%E7%B4%A2%E5%BC%95%E7%A4%BA%E6%84%8F%E5%9B%BE \"t_modified \")\n SQL  where t_modified='2018-7-1 t_modified='2018-7-1\n** month()  7 **\n\n****\n\n\n t_modified t_modified  t_modified\t\t\n\n![explain](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822684575-4deb9a96-f251-4f0c-a536-19871141453c.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=u523bd677&originHeight=143&originWidth=1637&originalType=url&ratio=1&rotation=0&showTitle=true&size=30107&status=done&style=none&taskId=u05bb406e-1cdf-4bce-933e-d07153bbc8c&title=explain%E7%BB%93%E6%9E%9C \"explain\")\n` select * from tradelog where id + 1 = 10000  SQL  1  MySQL  id  9999  SQL  where id = 10000 -1 `\n\n```sql\nselect * from tradelog where tradeid=110717;\ntradeid\ntradeid  varchar(32)\n\ntradelog \n```\nexplain \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648823298719-44df7f75-794e-4dc6-ac68-e1be2aee1bf7.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=uf55b0bbd&originHeight=142&originWidth=289&originalType=url&ratio=1&rotation=0&showTitle=false&size=6704&status=done&style=none&taskId=u73751b53-f437-460b-90a1-85cdf341157&title=)\nselect 10 > 9  1 MySQL  MySQL \n`ascii 101ascii90`\n\nsql\n```sql\nmysql> select * from tradelog where  CAST(tradid AS signed int) = 110717;\n```\n\n\n## select \n```sql\nmysql> select * from t where id=1;\n```\n\n\n t  show processlist \n### MDL\n![Waiting for table metadata lock](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878603446-1b67ed04-aa0f-4961-bdb2-c048db08684d.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=u6b91757f&originHeight=213&originWidth=1312&originalType=url&ratio=1&rotation=0&showTitle=true&size=295984&status=done&style=none&taskId=ua6b64a57-39e2-4f8b-a20b-acb19d0de19&title=Waiting%20for%20table%20metadata%20lock \"Waiting for table metadata lock\")\n t  MDL  select \n\n show processlist session A  Command Sleep performance_schema  sys MySQL  performance_schema=on off  10% )\n\n **sys.schema_table_lock_waits**  process id kill \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878943676-cb1e66f6-9274-4266-8aa5-3473ff341e1b.png#averageHue=%23f7f7f7&clientId=u9da0f65c-5a8c-4&from=paste&id=ud724efe0&originHeight=251&originWidth=940&originalType=url&ratio=1&rotation=0&showTitle=false&size=83355&status=done&style=none&taskId=u8346b506-65e9-42ee-b198-0ecd2158dde&title=)\n### flush\n![Waiting for table flush](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648879417166-43881340-f096-4563-b5e4-9bc5829cc62b.png#averageHue=%2308010a&clientId=u9da0f65c-5a8c-4&from=paste&id=u25a60694&originHeight=147&originWidth=1221&originalType=url&ratio=1&rotation=0&showTitle=true&size=221669&status=done&style=none&taskId=u5a5b1b06-1adc-4505-9c55-cfed57c8142&title=Waiting%20for%20table%20flush \"Waiting for table flush\")\n t  flush MySQL  flush \n```sql\nflush tables t with read lock;\nflush tables with read lock;\n```\n flush  t  t MySQL \n\n\n\n Waiting for table flush  flush tables  select \n flush\n\n### \n```sql\nselect * from t where id=1 lock in share mode;\n```\n id=1  select \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648881044186-e94acc20-7f4a-4b13-8ce4-9f73b9518af8.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=uc3a1df43&originHeight=223&originWidth=1285&originalType=url&ratio=1&rotation=0&showTitle=false&size=291379&status=done&style=none&taskId=u1c9e4b89-2356-43cb-aef5-c8285c293e0&title=)\n```sql\nmysql> select * from t sys.innodb_lock_waits where locked_table='`test`.`t`'\\G\n```\n![ sys.innodb_lock_waits ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883270487-dab3c3c5-e153-4d52-a60a-71f1fe51fcea.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=ued0ab6db&originHeight=669&originWidth=864&originalType=url&ratio=1&rotation=0&showTitle=true&size=580038&status=done&style=none&taskId=u3b80a197-9c94-402c-937a-19cb179068a&title=%E9%80%9A%E8%BF%87%20sys.innodb_lock_waits%20%E6%9F%A5%E8%A1%8C%E9%94%81 \" sys.innodb_lock_waits \")4  KILL QUERY 4  KILL 4KILL QUERY 4 4  update  KILL QUERY id=1 \n\nKILL 4  id=1 \n\n### \n```sql\nselect * from t where id=1   1\nselect * from t where id=1 lock in share mode  1000001\n\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883585247-7e59dcec-0278-410b-82ab-1025272a021c.png#averageHue=%23f9f9f9&clientId=u9da0f65c-5a8c-4&from=paste&id=udaac8027&originHeight=322&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=52745&status=done&style=none&taskId=udb5dcded-28c0-407c-becc-849e1a9f50d&title=)\nsessionBsessionAsessionBundo log\n![select100w](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883707434-705f7d40-60d4-4ffa-8029-406518fe2664.png#averageHue=%23edefe3&clientId=u9da0f65c-5a8c-4&from=paste&id=uccb7b493&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=215323&status=done&style=none&taskId=u3ead1e96-17fc-4831-b8f7-da92f1c225f&title=%E7%AC%AC%E4%B8%80%E4%B8%AAselect%E9%9C%80%E8%A6%81%E5%9B%9E%E6%BB%9A100w%E6%AC%A1%E6%89%8D%E8%83%BD%E5%B0%86%E8%BF%99%E4%B8%AA%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E \"select100w\")` lock in share mode  SQL  1000001 `\n`undo log  2  1 3  2`\n\n## \n\n\n\n## \n\n\n","source":"_posts/Mysql.md","raw":"---\ntitle: Mysql\n---\n# sql\n\n![Mysql](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648093341473-68f1e895-bb41-45cb-9b0e-cb0d7797a3e7.png#averageHue=%23ecefe2&clientId=ub35db475-a524-4&from=paste&id=ub86e15fd&originHeight=1440&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=true&size=609051&status=done&style=none&taskId=udd5444c6-42b3-4ee3-b7f0-c6b67a2ffc1&title=Mysql%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%9B%BE \"Mysql\")\nMySQL  Server \n\nServer  MySQL \n\n InnoDBMyISAMMemory  InnoDB MySQL 5.5.5 \n\n create table  InnoDB create table  engine=memory, \n\n Server \n## \n\n```sql\nmysql -h$ip -P$port -u$user -p\n```\n -p \n\n mysql  TCP \n\n- \"**Access denied for user**\"\n- \n- \n\n\n\n\n show processlist  show processlist  Command Sleep\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648100906726-b843b434-66a0-4c16-923d-149c872f5402.png#averageHue=%23060208&clientId=ub35db475-a524-4&from=paste&id=uec2e5d2a&originHeight=163&originWidth=875&originalType=url&ratio=1&rotation=0&showTitle=false&size=27260&status=done&style=none&taskId=u34b2b0d5-b675-4b6c-a3b8-99d595321e3&title=)\n **wait_timeout ** 8 ** Lost connection to MySQL server during query**\n\n\n\n\n\n MySQL  MySQL OOM MySQL \n\n\n\n- \n-  MySQL 5.7 mysql_reset_connection \n\n## \n select \n\nMySQL  key-value key value  key value \n\nMySQL \n\n****\n\n\n\n MySQL  **query_cache_type**  DEMAND SQL  SQL_CACHE \n```sql\nmysql> select SQL_CACHE * from T where ID=10\n```\nMySQL 8.0  8.0 \n\n## \nMySQL  SQL \n\nMySQL  SQL \n\n SQL MySQL \n\nMySQL \"select\"T TID ID\n\n SQL  MySQL **You have an error in your SQL syntax** select s\n\n## \nMySQL \n\njoin\n\n join\n```sql\nmysql> select * from t1 join t2 using(ID) where t1.c=10 and t2.d=20;\n```\n\n-  t1  c=10  ID  ID  t2 t2  d  20\n-  t2  d=20  ID  ID  t1 t1  c  10\n\n\n\n\n\n## \nMySQL \n\n T  ( precheck )\n\n\n\n T ID \n\n-  InnoDB  ID  10\n- \n- \n\n\n\n\n\n rows_examined \n\n rows_examined \n\n\nmysqlserviceinnodb\nservice \nmysqltcp(8)  mysql\n# \n`DMLinsert,update,delete,create redo log()  binlog() `\n## redo log\n### WAL\n**MySQL  WAL WAL  Write-Ahead Logging**\n MySQL  IO \n\nInnoDB InnoDB \n\n`redo logioredo log `\n`WAL IO   IO  redo log.`\n\nInnoDB  redo log  4  1GB 4GB \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648108055998-29f22c92-5ea3-442e-9fdc-a5bb73578294.png#averageHue=%23f3f0e9&clientId=ub35db475-a524-4&from=paste&id=ub0653dee&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=230615&status=done&style=none&taskId=u4fa0be29-3fc3-491d-8a98-4028c4e8501&title=)write pos  3  0 checkpoint \n\nwrite pos  checkpoint  write pos  checkpoint**** checkpoint \n\n redo logInnoDB  **crash-safe**\n`redo log  InnoDBInnoDB InnoDB redo log() crash-safe mysql`\n\n** redo log  redo log  **\n\n### redo log \n![MySQL redo log ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877429762-363312e7-1539-40de-9cab-ac46d3c8e06c.png#averageHue=%23ecebd6&clientId=u84cf85c6-a1db-4&from=paste&id=ue760740b&originHeight=639&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=59527&status=done&style=none&taskId=ubb09edc4-d7a5-47b0-80c5-4fa65d36482&title=MySQL%20redo%20log%20%E5%AD%98%E5%82%A8%E7%8A%B6%E6%80%81 \"MySQL redo log \")\n\n\n1.  redo log buffer  MySQL \n2.  (write)fsync) page cache \n3.  hard disk\n\n redo log buffer wirte  page cache \n redo log InnoDB  **innodb_flush_log_at_trx_commit** \n\n1.  0  redo log  redo log buffer  ;\n2.  1  redo log \n3.  2  redo log  page cache\n\nInnoDB  1  redo log buffer  write  page cache fsync \n`binlogbinlogbinlog cacheredo logredo log buffer`\n redo log  redo log buffer  redo log ** redo log**\n\n redo log \n\n1. redo log buffer  innodb_log_buffer_size  write fsync page cache`innodb_log_buffer_size  innodb , 8MB`\n2.  redo log buffer  A  redo log  buffer  B  innodb_flush_log_at_trx_commit  1 B  redo log buffer  A  redo log buffer \n\n` innodb_flush_log_at_trx_commit  1 redo log  prepare `\n\n MySQL  1 sync_binlog  innodb_flush_log_at_trx_commit  1 redo logprepare  binlog\n\n## binlog\nMySQL  Server  MySQL ,redo log  InnoDB  Server  binlog\n\n MySQL  InnoDB MySQL  MyISAM MyISAM  crash-safe binlog  InnoDB  MySQL  binlog  crash-safe  InnoDB  redo log  crash-safe \n`binlogcrashbinlog,binlogredologcheck pointwrite pos (write poscheck point)redolog`\n`redo log  binlog  redo log  redo log binlog   crash  redo log  binlog binlog  binlog  innoDB `\n\n\n\n- redo log  InnoDB binlog  MySQL  Server \n- redo log binlog  ID=2  c  1 \n- redo log binlog  binlog \n\n### \n InnoDB  update \n\n1.  ID=2 ID  ID=2 \n2.  1 N N+1\n3.  redo log  redo log  prepare \n4.  binlog binlog \n5.  redo log commit\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648113221297-708a4029-be16-4b31-9538-1ef82cece307.png#averageHue=%23ecede2&clientId=ub35db475-a524-4&from=paste&height=487&id=eROFt&originHeight=731&originWidth=513&originalType=binary&ratio=1&rotation=0&showTitle=false&size=149649&status=done&style=none&taskId=u1d9c41ee-c839-4ec7-a5e3-d67f8b6c729&title=&width=342)\n redo log prepare  commit\"\"\n redo log  binlog  redo log  binlog\n\n update  ID=2  c  0 update  crash\n\n** redo log  binlog** redo log binlog MySQL redo log  c  1 binlog  crash  binlog  binlog  binlog  binlog  c  0\n\n** binlog  redo log** binlog  crash redo log  c  0 binlog  c  0  1 binlog  c  1\n\n\n\n\n\n binlog redo log  binlog \n\nBinlogstatement sql row\n\n**MySQL **\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650437373196-5ae1790e-1e28-4526-992e-88a474a8fc80.png#averageHue=%23edeee2&clientId=u52eb2620-e685-4&from=paste&id=uc6cedb1d&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=634267&status=done&style=none&taskId=u44f064d3-65b6-4987-b3a8-796c757e343&title=)\n1 A  redo log  prepare  binlog crash binlog redo log binlog \n2 B binlog redo log  commit  crash MySQL \n\n-  redo log  commit \n-  redo log  prepare binlog \n   - a. \n   - b. \n\n### binlog\n#### statement\n binlog_format=statement binlog  SQL \n```sql\nmysql> delete from t /*comment*/  where a>=4 and t_modified<='2018-11-10' limit 1;\n\nshow binlog events in 'master.000001';\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876306414-ef659638-160f-4294-86c2-1bedf9932b53.png#averageHue=%23090109&clientId=u84cf85c6-a1db-4&from=paste&id=u0bed92d0&originHeight=213&originWidth=1882&originalType=url&ratio=1&rotation=0&showTitle=false&size=43916&status=done&style=none&taskId=u7696b2bc-d028-4672-b728-7d0c514bfb8&title=)\n BEGIN commit \n\n delete use test MySQL  test  t\n\n#### row\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876481808-6f610fff-712f-4e13-8dba-b32366c53c42.png#averageHue=%23050207&clientId=u84cf85c6-a1db-4&from=paste&id=u2fbfb767&originHeight=533&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=false&size=419977&status=done&style=none&taskId=u21be3baf-c2b0-4a03-99c2-b2487712508&title=)\n statement  binlog  BEGIN  COMMIT row  binlog  SQL  eventTable_map  Delete_rows\n\nTable_map event test  t;Delete_rows event\n binlog_format  row binlog  id binlog  id=4 \n\n#### mixed\n statement  binlog  row  row  delete  10  statement  SQL  binlog  row  binlog 10  binlog  binlog  IO MySQL  mixed  binlogmixed MySQL  SQL  row  statement \n\n### binlog \nbinlog  binlog cache binlog cache  binlog \n\n binlog  binlog cache \n\n binlog cache  binlog_cache_size  binlog cache \n\n binlog cache  binlog  binlog cache\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877216791-c4eec49b-0149-4260-8ae2-1faf6b27731e.png#averageHue=%23a1bd8c&clientId=u84cf85c6-a1db-4&from=paste&id=ucd5cd72c&originHeight=748&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=350828&status=done&style=none&taskId=u7be45086-e9e1-4fca-905f-58cd27461ae&title=)\n binlog cache binlog \n\n write page cache\n fsync fsync  IOPS\nwrite  fsync  **sync_binlog** \n\nsync_binlog=0  write fsyncsync_binlog=1  fsyncsync_binlog=N(N>1)  write N  fsync\n\n IO  sync_binlog  0 100~1000  sync_binlog  N N  binlog \n\n## redo log  binlog ?\n XID redo log prepare commit  redo log\n parepare commit  redo log XID  binlog \nbinlog\n\n\n## \n### LSN\nlog sequence numberLSN\nLSN  redo log  length  redo log LSN  length\n\nLSN  InnoDB  redo log\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877956349-248ca201-d6c2-43a0-ac70-ae7d4c7bce0a.png#averageHue=%23e3e3bf&clientId=u84cf85c6-a1db-4&from=paste&id=ud19e5689&originHeight=2171&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=398351&status=done&style=none&taskId=u4a4d4116-61f8-48a7-bbdb-764b0f1ad4c&title=)\ntrx1  leader trx1  LSN  160trx1  LSN=160 trx1  LSN  160  redo log trx2  trx3 \n\n redo log buffer  fsync  IOPS \n\n\n![](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650878105681-14abb035-6107-418a-b237-a148a90f3feb.png#averageHue=%23f1f2e9&clientId=u84cf85c6-a1db-4&from=paste&id=u3fd2b35f&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=210196&status=done&style=none&taskId=u794cd052-0d6a-467a-8b8e-ad30ca66b63&title=%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%E7%BB%86%E5%8C%96 \"\")\n binlog  **binlog_group_commit_sync_delay**  **binlog_group_commit_sync_no_delay_count** \n**binlog_group_commit_sync_delay**  fsync;\n**binlog_group_commit_sync_no_delay_count**  fsync\n\n**WAL  redo log  binlog?**\n\n- redo log  binlog \n-  IOPS \n\n\n\n## \n****\n\n\n1. innoDBredo log checkpoint redo log checkPoint flushredologredolog\n2. \n3. mysql\n4. mysql\n\nredolog\n\nInnoDB **buffer pool**\n### \ni**nnodb_io_capacity ** InnoDB ,IOPS\n`IOPS:Input/Output Operations Per Second,(I/O)`\n\nInnoDB  redo log \n\n** innodb_max_dirty_pages_pct**  75%InnoDB  M 0  100  F1(M)\n\nredolog,InnoDB  checkpoint  NInnoDB  N  0  100  F2N\n\n F1(M)  F2(N)  R innodb_io_capacity  R% \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650436507824-2065113f-bb0b-4c48-ae9b-c90c853b9f70.png#averageHue=%23edefe4&clientId=u52eb2620-e685-4&from=paste&id=ud0ac7cf8&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u467db1e5-c649-40bd-9c85-90a5b6a7636&title=)\n\n\n\n# \n MySQL MySQL  MySQL  MyISAM  MyISAM  InnoDB \n\n** ACIDAtomicityConsistencyIsolationDurability**\n**:**\n**:**\n**:**\n**:redoLog+binlog**\n\n## \ndirty readnon-repeatable readphantom read\n\n****SQL read uncommittedread committedrepeatable readserializable \n\n- \n- \n- \n- \n\n T  1\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648114969737-ca2280ec-d1d7-403f-ab13-926f1dfe3d99.png#averageHue=%23f2f1ed&clientId=ub35db475-a524-4&from=paste&id=u3d4fa0c4&originHeight=1420&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386590&status=done&style=none&taskId=u2cf5b523-30d0-40be-8854-8517eb9d974&title=)\n A  V1V2V3 \n\n  V1  2 B  A V2V3  2\n\n V1  1V2  2 B  A  V3  2\n\n V1V2  1V3  2 V2  1****\n\n B  1  2 A  B  A  V1V2  1V3  2\n\n**** SQL \n\nOracle  Oracle  MySQL  MySQL (mysql )\n\n** transaction-isolation** ** READ-COMMITTED** show variables \n\n****\n\n\n## \n\n\n MySQL  1  234\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648115713483-7e04eee4-1941-44e6-a4e7-f56490fefa37.png#averageHue=%23f2f1eb&clientId=ub35db475-a524-4&from=paste&id=ubed388d6&originHeight=737&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=248434&status=done&style=none&taskId=u190e6fc5-52a1-48d9-8607-953b27a477b&title=)\n 4 read-view ABC  124MVCC read-view A 1\n\n 4  5 read-view ABC \n\n read-view \n\n\n\n****\n\n`RRread-view,`\n\n MySQL 5.5  ibdata  20GB 200GB \n\n\n\n## \n\n\nMySQL  begin  start transaction commit rollbackset autocommit=0 select \n\n commit  rollback \n\n set autocommit=0  set autocommit=1, \n\n begin\n\n commit work and chain  autocommit  1  begin  commit  commit work and chain begin \n\n\n\n information_schema  innodb_trx  60s \n```sql\nselect * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))>60\n```\n\n\n## \n MySQL \n view create view  \n InnoDB  MVCC  **consistent read view** RCRead Committed RRRepeatable Read\n\n\n\nInnoDB  ID transaction id**** InnoDB \n\n**** transaction id  ID row trx_id (row) row trx_id\n\n![1:](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648431114419-7ad7fe30-7e51-44e9-83e8-381a4139a59c.png#averageHue=%23edefe4&clientId=ubdd7c6a3-1836-4&from=paste&id=u1f4cd4e2&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=349597&status=done&style=none&taskId=u6a2056db-3401-4df7-ae8f-e23a3b4608c&title=%E5%9B%BE1%3A%E8%AE%B0%E5%BD%95%E8%A2%AB%E5%A4%9A%E4%B8%AA%E4%BA%8B%E5%8A%A1%E8%BF%9E%E7%BB%AD%E6%9B%B4%E6%96%B0%E5%90%8E%E7%9A%84%E7%8A%B6%E6%80%81%E3%80%82 \"1:\")\n 4  V4k  22 transaction id  25  row trx_id  25\n\n **undo log** V1V2V3  undo log  V2  V4  U3U2 \n\n\n\n\n`Undo Logs`\n\n\n\n** InnoDB ** ID\n`trx_id`\n\n ID  ID  1 \n\nread-view row trx_id \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648433319988-54447ac9-f2d7-442a-9fdf-d94d9a2584ba.png#averageHue=%23f4efe8&clientId=ubdd7c6a3-1836-4&from=paste&id=u2ff698cc&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=146395&status=done&style=none&taskId=u159b7bfa-f7ad-40c3-a9c8-151a3a6cb32&title=)\n**** row trx_id\n\n1. \n2. \n3. \n   -  row trx_id \n   -  row trx_id \n\n`IDID[1,2,3,5]41-54`\n`id 99100102104105id 101103 99`\n`**ABAB ABBA**`\n\n **InnoDB **\n\n\n```sql\nmysql> CREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `k` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB;\ninsert into t(id, k) values(1,1),(2,2);\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436642991-cb96c42e-1d75-451f-8bfe-da1fe5ce2c8d.png#averageHue=%23fafafa&clientId=ubdd7c6a3-1836-4&from=paste&id=u88640d3b&originHeight=509&originWidth=910&originalType=url&ratio=1&rotation=0&showTitle=false&size=77588&status=done&style=none&taskId=ua2ee9126-6b57-46ec-8113-c6447e13318&title=)\nbegin/start transaction  InnoDB ** start transaction with consistent snapshot** \n\n start transaction with consistent snapshot \n\n\n A  ID  99\n ABC  100101102\n(1,1 row trx_id  90\n A [99,100],  B [99,100,101],  C [99,100,101,102]\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436831411-e1b8b943-71ac-4b16-90d6-cdc022316d02.png#averageHue=%23bbcaae&clientId=ubdd7c6a3-1836-4&from=paste&id=uf77228b9&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=389463&status=done&style=none&taskId=ucfa9e2d6-3e31-4da4-8fb4-27f1046d8bb&title=)\n`A102102AA2(cA)`\n\n C (1,1)  (1,2) row trx_id  102 90 \n\n B (1,2)  (1,3) row trx_id 101 102 \n``\n\n A [99,100] A \n\n-  (1,3)  row trx_id=101()\n-  row trx_id=102\n- 1,1) row trx_id=90\n\n A \n\n** B  update **\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648438902227-33dfff5b-7752-42f9-ae8f-4ba54824af5b.png#averageHue=%23c2d0b7&clientId=ubdd7c6a3-1836-4&from=paste&id=u29cc65f6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=181203&status=done&style=none&taskId=ubc0f1fa8-0770-462c-a1c2-f5bf051a302&title=)\n B  C  (1,2)  (1,3) \n B  k  1\n\n**current read**\n`CBCB  CBCB`\n\n (1,2) (1,3) row trx_id  101\n\n B  101 101 k  3\n\n update select \n\n A  select * from t where id=1  **lock in share mode**  **for update** 101  k  3 select S ****X ****\n``\n``\n```sql\nmysql> select k from t where id=1 lock in share mode;\nmysql> select k from t where id=1 for update;\n```\n\n C  C\t\t\t\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439136431-4b35da83-71d7-4f2e-aacc-34b0b870f86b.png#averageHue=%23f9f9f9&clientId=ubdd7c6a3-1836-4&from=paste&id=u555af770&originHeight=565&originWidth=906&originalType=url&ratio=1&rotation=0&showTitle=false&size=90942&status=done&style=none&taskId=u257c13bb-7de7-4653-ae0c-08c330e0e8d&title=)\n C B  C (1,2)  B \n\n C (1,2)  B ******** C\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439181432-b5b054ed-4f67-44a5-b6a0-63dfd27c5fe5.png#averageHue=%23c1cfb6&clientId=ubdd7c6a3-1836-4&from=paste&id=u28580c0d&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=337234&status=done&style=none&taskId=u654b2065-2bcb-4bfc-9b0f-587f4f74d55&title=)\n\n**consistent read**\n\n\n\n- \n- \n\n A  B  k\n`start transaction with consistent snapshot;  start transaction`\n\n read view  C  C\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439281611-5d682321-af61-48bc-87f1-c12fcaf0b6ae.png#averageHue=%23a0b792&clientId=ubdd7c6a3-1836-4&from=paste&id=u3133d187&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=534050&status=done&style=none&taskId=u99b6227f-1384-4887-a71b-d08f6a30f1b&title=)\n\n A  (1,2)(1,3) (1,3) (1,2)  \n A  k=2\n B  k=3\n\n row trx_id\n\nMySQL 8.0  InnoDB \n\n\n# \n 500 \n\n`   +  `\n\n## \n - key-value key Value key  value \n\n key \n\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172350141-1148f1ae-5357-4246-9e55-df37b38e9a0c.png#averageHue=%23ebede1&clientId=ub38593e9-da58-4&from=paste&id=u711c2508&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=394076&status=done&style=none&taskId=ue30f032e-37eb-4230-8d4b-9bab7ebb4ed&title=)\nUser2  User4  N ID_card_n2  ID_card_n2  N User2\n\n ID_card_n  User ****\n\n[ID_card_X, ID_card_Y]\n\n Memcached  NoSQL \n\n## \n\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172988285-612ee6fd-9e8e-40e7-9548-c8f73834f70f.png#averageHue=%23eff0e7&clientId=ub38593e9-da58-4&from=paste&id=u523f9001&originHeight=787&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=261326&status=done&style=none&taskId=u52aeb952-9eaa-40a9-9029-3f108f01bad&title=)\n ID_card_n2  O(log(N))\n\n[ID_card_X, ID_card_Y] User ID_card_X ID_card_X ID_card_X  User ID_card_Y \n\n\n\n 2017 \n\n## \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648173122656-422a42b5-a1f1-4d77-bc75-06766e296dff.png#averageHue=%23edeee5&clientId=ub38593e9-da58-4&from=paste&id=ue2441f8f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=445439&status=done&style=none&taskId=u5719c66d-7877-4064-a4df-e1c3f17715c&title=)\n ID_card_n2  UserA -> UserC -> UserF -> User2  O(log(N))\n\n O(log(N))  O(log(N))\n\n\n\n 100  20 20  10 ms  100  20  10 ms \n\nN N N\n\n InnoDB  N  1200 4  1200  3  17  10  3 \n\n MySQL  InnoDB  MySQL \n## InnoDB \n InnoDB InnoDB  B+  B+ \n\n InnoDB  B+  ID  k k \n\n R1~R5  (ID,k)  (100,1)(200,2)(300,3)(500,5)  (600,6)\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648177404439-962473ed-5691-4733-977e-7e121ac1f8e2.png#averageHue=%23f2f1eb&clientId=ub38593e9-da58-4&from=paste&id=ua47e1a1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=302521&status=done&style=none&taskId=u9f6a80ce-67fa-4e12-ab52-1cb35124172&title=)\n InnoDB ****clustered index InnoDB ****secondary index\n\n### \n\n-  select * from T where ID=500 ID  B+ \n-  select * from T where k=5 k  ID  500 ID \n\n\n\n### \nB+  ID  700 R5  ID  400\n\n R5  B+ \n\n 50%\n\n\n\n\n\n\n\n 20  4 bigint 8 \n\n****\n\n### \n select ID from T where k between 3 and 5 ID  ID  k  k \n\n\n\n### \n\n\n**B+ **\n\nnameage\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648178687735-90c51b38-d3f9-46aa-8227-852cde96647f.png#averageHue=%23f2f1ea&clientId=ub38593e9-da58-4&from=paste&id=u6826c5cc&originHeight=818&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=289776&status=done&style=none&taskId=uff5cb309-bf12-4c5c-8c3d-d7614291dbb&title=)\n\n``\n\n ID4\n\n SQL \"where name like  %\" ID3\n\n N ** M **\n\n****\n\n (a,b)  a ****\n\n ab  b  (a,b)  (a,b)(b) \n\nname  age  name,age)  (age) \n\n### \nname, age 10 SQL \n```sql\nmysql> select * from tuser where name like '%' and age=10 and ismale=1;\n```\n  ID3 \n\n`(a,b)aab21003150450` \n\n MySQL 5.6  ID3 \n\n MySQL 5.6  ID3 \n\n MySQL 5.6 ****index condition pushdown) \n:\n![](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179582601-8505ffa6-926a-4b92-8a9f-76f28a3f3dec.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ubb129163&originHeight=833&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=290640&status=done&style=none&taskId=u3696a908-4b07-4f0b-aaf8-eaeaa6a5005&title=%E6%97%A0%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B \"\")\n![](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179640502-b73960eb-e5ca-4c60-b294-026553498c3f.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ue7b7341e&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=289593&status=done&style=none&taskId=u7d11f6c5-1ec1-4daf-9d2c-91219c7d68a&title=%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B \"\")\n\n  (name,age)  age  InnoDB  age name  4 \n\n InnoDB  (name,age)  age  10 10  ID4ID5  2 \n\n### explain\nselectexplain\n```sql\nmysql> explain select * from servers;\n+----+-------------+---------+------+---------------+------+---------+------+------+-------+\n| id | select_type | table   | type | possible_keys | key  | key_len | ref  | rows | Extra |\n+----+-------------+---------+------+---------------+------+---------+------+------+-------+\n|  1 | SIMPLE      | servers | ALL  | NULL          | NULL | NULL    | NULL |    1 | NULL  |\n+----+-------------+---------+------+---------------+------+---------+------+------+-------+\n```\ntype:\n**NULL**\nMySQL\n**constsystem**\nMySQLwhereMySQL,systemconstsystem\n**eq_ref**\nrefprimary key unique key\n**ref**\n\n**range**\n\ni**ndex**\nFull Index ScanindexALLindex\n**ALL**\nFull Table Scan MySQL\n\n\n# \n## \nMySQL ** Flush tables with read lock** (FTWRL)\n\n select \n\n FTWRL \n\n binlog\n\n mysqldump mysqldump single-transaction  MVCC \n\n FTWRL  MyISAM  FTWRL \n\nsingle-transaction  FTWRL  DBA  InnoDB  MyISAM \n\n\n## \nMySQL meta data lockMDL)\n\n### \n** lock tables  read/write** FTWRL  unlock tables lock tables \n\n,  A  lock tables t1 read, t2 write;  t1 t2  A  unlock tables  t1 t2  t1 \n\n InnoDB  lock tables \n\n### MDL\n MDLmetadata lock)MDL MDL \n\n MySQL 5.5  MDL MDL  MDL \n\n- \n- \n\n``\n(DDL ) DML()\n\n t \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648189243388-65fe8441-51c7-4a86-bc57-4e15975df962.png#averageHue=%23f0eee7&clientId=ue989aaab-00e7-4&from=paste&id=ubbc20e7c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=286437&status=done&style=none&taskId=u0e1bcf88-be7f-4897-990e-fe397bfb3af&title=) session A  t  MDL  session B  MDL \n\n session C  blocked session A  MDL  session C  MDL \n\n session C  t  MDL  session C  MDL \n\n session \n` sessionc   sessionc    block `\n\n MDL \n``\n\n****\n MDL  MySQL  information_schema  innodb_trx  DDL  DDL kill \n\n\n\n kill  alter table  MDL  DBA \n\nMariaDB  AliSQL  DDL NOWAIT/WAIT n \n\n```java\nALTER TABLE tbl_name NOWAIT add column ...\nALTER TABLE tbl_name WAIT N add column ...\n```\n\n## \nMySQL  MyISAM InnoDB  MyISAM  InnoDB \n\n A  B  A \n\n** InnoDB **\n\n\n\n` `\n\n### \n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648219769688-d2a63c64-b371-44de-871f-06f8f19bf9ca.png#averageHue=%23eeeee3&clientId=u2e8a2ebc-6522-4&from=paste&id=u3244e8e4&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=299114&status=done&style=none&taskId=u44d2fac4-01da-4283-824c-45fb342615b&title=)\n A  B  id=2  B  A  id=1   A  B \n\n- ** innodb_lock_wait_timeout** \n-  **innodb_deadlock_detect ** on\n\n InnoDB innodb_lock_wait_timeout  50s 50s  1s\n\n innodb_deadlock_detect  on\n\n\n\n O(n)  1000  100  CPU  CPU \n\n?\n\n****\n\n**** 10  600  5  3000\n\n**** MySQL  MySQL **** InnoDB \n\n 10  10  1/10 CPU \n\n## \n**bug**\n 1 next-key lock`next-key lock `\n 2\n 1next-key lock \n 2next-key lock \n bug\n```sql\nCREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(0,0,0),(5,5,5),\n(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n```\n### ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196785720-81dc67d8-9362-460f-8c72-124925f32c83.png#averageHue=%23f9f9f9&clientId=u3a41a891-d6bd-4&from=paste&id=u3fc85d1e&originHeight=462&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=87911&status=done&style=none&taskId=uc6cee32e-a121-46ec-bd29-bc18a18beb1&title=)\n session A  c  c=5 \n\n-  1 next-key lock (0,5] next-key lock\n-  c  c=5  c=10  2 (5,10] next-key lock\n-  2 c=5  (5,10)\n-  2  session B  update \n\n session C  (7,7,7)  session A  (5,10) c\n\nlock in share mode  for update   for update \n\n lock in share mode  session A  select d from t where c=5 lock in share mode\n\n### \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196929106-7660a1a3-6640-4347-b798-5c4b471bc95b.png#averageHue=%23fafafa&clientId=u3a41a891-d6bd-4&from=paste&id=ua535fe5d&originHeight=313&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=55984&status=done&style=none&taskId=uf85c6652-35de-4ff4-98b8-dd0793c5afe&title=)\n 1 next-key locksession A  (5,10]\n 2 (id=7) id=10 next-key lock  (5,10)\nsession B  id=8  session C  id=10 \n\n### \n```sql\nmysql> select * from t where id=10 for update;\nmysql> select * from t where id>=10 and id<11 for update;\n```\n\n session A \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650197044039-7a303e5d-1b56-41bc-a529-eb7c6ffecd40.png#averageHue=%23fbfafa&clientId=u3a41a891-d6bd-4&from=paste&id=ub5ac83fc&originHeight=718&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=124356&status=done&style=none&taskId=u0ef12a21-8e64-4984-9f19-cc8fbc4fc53&title=)\n\n-  id=10  next-key lock(5,10]  1  id   id=10 \n-  id=15  next-key lock(10,15]\n\nsession A  id=10  next-key lock(10,15]session B  session C \n\n## \n**insert**** deleteupdate**\n\n****\n`select for updateselect in share mode`\n\n****\n`a ,  ,10, 10, b, a. , a, a, , 11... .`\n** **\n### \n```sql\nCREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(0,0,0),(5,5,5),\n(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n```\nInnoDB  (Gap Lock)\n5(id 0510152025) 7 \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1649992660264-65dd581d-b5b9-4976-8485-8772530f2194.png#averageHue=%23f4f2ed&clientId=u0e71056a-b30e-4&from=paste&id=Kt72W&originHeight=550&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=76936&status=done&style=none&taskId=u94793186-c86f-4978-bdda-8140978c040&title=)\n select * from t where id=5 for update 6  7 \n` id=1 `\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993034198-38b45746-5725-4dde-9da9-98a6171fd13a.png#averageHue=%23fafafa&clientId=u0e71056a-b30e-4&from=paste&id=EM16B&originHeight=154&originWidth=411&originalType=url&ratio=1&rotation=0&showTitle=false&size=12389&status=done&style=none&taskId=ue83bb8ed-a0fa-420d-ba7d-63351017074&title=)\n\n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993266628-29fe8369-3579-4a77-89e8-cbd0cc4871c4.png#averageHue=%23f9f9f9&clientId=u0e71056a-b30e-4&from=paste&id=lvjx5&originHeight=210&originWidth=946&originalType=url&ratio=1&rotation=0&showTitle=false&size=35886&status=done&style=none&taskId=ufcfa8103-a650-4c06-b4b9-a2b2d3bd682&title=)\nc7  \n\n next-key lock next-key lock  t  select * from t for update  7  next-key lock (-,0](0,5](5,10](10,15](15,20](20, 25](25, +supremum]\n\n` supremum  +InnoDB  supremum`\n# Join\n##  NLJ\n```sql\n\nCREATE TABLE `t2` (\n  `id` int(11) NOT NULL,\n  `a` int(11) DEFAULT NULL,\n  `b` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `a` (`a`)\n) ENGINE=InnoDB;\ncreate table t1 like t2;\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650953541569-e9649522-4b4b-48c8-a1f7-4b2031bd1563.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u90881f8f&originHeight=163&originWidth=1394&originalType=url&ratio=1&rotation=0&showTitle=false&size=31471&status=done&style=none&taskId=ua6df17c9-4a06-4638-95b5-21c16652669&title=)\n\n\n1.  t1  R\n2.  R  a  t2 \n3.  t2  R \n4.  1  3 t1 \n\nIndex Nested-Loop Join NLJ\n** join **\n\n## BNL\n```sql\nselect * from t1 straight_join t2 on (t1.a=t2.b);\n```\n\n`Block Nested-Loop Join BNL`\n\n1.  t1  join_buffer  select * t1 \n2.  t2 t2  join_buffer  join \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954146426-5e868fc8-9ad5-4b5f-b757-c2f09ada4833.png#averageHue=%23edeee5&clientId=u9f841287-a109-4&from=paste&id=uf584d183&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=209296&status=done&style=none&taskId=ue49e250b-56bf-4280-b030-62a5d419e01&title=)\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954156660-9fdff866-3e36-4a30-8565-51856356f1fc.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u996c909a&originHeight=164&originWidth=1763&originalType=url&ratio=1&rotation=0&showTitle=false&size=35157&status=done&style=none&taskId=u0c33c4a8-b702-4f8c-9f31-70491336d60&title=)\n t1  t2  1100 join_buffer  t2  100 100*1000=10 \n?\n\n N M M+N M*N\nNM\n\njoin_buffert1mysql****\n join_buffer\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954434057-b82dcdd6-f89a-42cb-b067-9c45e777e1ac.png#averageHue=%23ebece1&clientId=u9f841287-a109-4&from=paste&id=u2a584d0a&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=291462&status=done&style=none&taskId=u8f432b2f-13dd-47a2-9beb-2f0043323ed&title=)\n 4  5 join_buffer \n\n N K  M K N  K  K *N (0,1)\n\n N+*N*M N*M  \njoin_buffer_sizejoin_buffer_size  join  join_buffer_size \n\n** join **\n\n## BKA\nBatched Key Access(BKA)NLJ\n\n`Multi-Range Read  (MRR)`\n\nNLJ  t1 a  t2  join t2 MRR  t2  t1  t2\n\n t1  join_buffer\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1650955774308-bf38ea60-0d50-4b0b-a3da-cbd9b6a031eb.png#averageHue=%23dae2cf&clientId=u9f841287-a109-4&from=paste&id=u1b2c7b3b&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=143155&status=done&style=none&taskId=uec77b0b5-13d3-42fb-969d-134a255c2b9&title=)\n\n join_buffer  P1~P100 join buffer  P1~P100  100 \n\n```sql\n\nset optimizer_switch='mrr=on,mrr_cost_based=off,batched_key_access=on';\n```\n MRRBKA  MRR\n\n\n# InnoDB  Memory \nInnoDB  idIndex Organizied Table\n Memory Heap Organizied Table\n\n:\n\n1. InnoDB \n2. InnoDB \n3. InnoDB \n4. InnoDB \n5. InnoDB  Blob  Text  varchar(N) char(N)\n\n\n Memory  hash \n\n\n\n\n- \n- \n\n# \n## \n  \n\n\n\n\n\nInnoDB  InnoDB  16KB\n\n k=5 \n\n\n### change buffer\nInnoDB  change buffer  change buffer \n\n change bufferchange buffer \n`change buffer ibdata1change bufferredo logibdata1`\n\n change buffer  merge merge  mergeshutdown merge \n\n (4,400)  k=4  change buffer \n\nchange buffer  buffer pool change buffer  innodb_change_buffer_max_size  50  change buffer  buffer pool  50%\n`Buffer Pool  innodb_buffer_pool_size Buffer Pool `\n\n\nInnoDB \n\n- \n-  \n\nInnoDB \n\n- \n-  change buffer\n\n IO change buffer \n\n change buffer \n\n merge  change buffer  merge change buffer \n\n change buffer \n\n change buffer merge  IO  change buffer change buffer \n\n\n\n change bufferchange buffer \n\n### change buffer  redo log\n\n```sql\ninsert into t(id,k) values(id1,k1),(id2,k2);\n```\nk1  (InnoDB buffer pool) k2 \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448480028-98b82840-60c9-4dec-a9da-fa2e7f384d1e.png#averageHue=%23a7bc99&clientId=ubdd7c6a3-1836-4&from=paste&id=u386044d6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=523388&status=done&style=none&taskId=udf24454a-a8ef-49b0-b750-fc23cf86083&title=)\n\n\n1. Page 1 \n2. Page 2  change buffer  Page 2 \n3.  redo log  3  4\n\n\n\n\n\n select * from t where k in (k1, k2)\n`ibdata1 redo logib_log_fileX`\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448593841-dadf2d65-6d2f-4a8f-b8ed-6e5fa1737979.png#averageHue=%23bfcdb3&clientId=ubdd7c6a3-1836-4&from=paste&id=u55f462e7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=382614&status=done&style=none&taskId=u1afa9e5d-34f7-4de8-8b10-99e34853198&title=)\n Page 1 WAL  redo log \n\n Page 2  Page 2  change buffer merge\n\n Page 2 \n\n## MySQL\n SQL  MySQL \t\n`mysqlmysqlserver`\n\n CPU \n\n\n\nMySQL \n\ncardinality\n\n show index \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648454396086-286835f4-56a0-4855-bbdb-929959b8897c.png#averageHue=%23090109&clientId=ubdd7c6a3-1836-4&from=paste&id=u25bc3d64&originHeight=209&originWidth=1850&originalType=url&ratio=1&rotation=0&showTitle=false&size=42815&status=done&style=none&taskId=uac7e024d-d508-470a-9a49-13b6181534f&title=)\n\nMySQL  MySQL \n\nInnoDB  N \n\n 1/M \n\n MySQL  innodb_stats_persistent \n on  N  20M  10\n off  N  8M  16\n\n## MySQL\n SQL \n\nInnoDB  redo log redo log \n\n\n\n\n\n MySQL flush\n\n** flush **\n\n1. InnoDB  redo log  checkpoint redo log \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648456454734-b1c65cc5-a2d1-474b-95f6-935db1efad7a.png#averageHue=%23f3f0ea&clientId=u6601b37f-239d-4&from=paste&id=X7cS6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=255505&status=done&style=none&taskId=ued0fa08d-ba43-47ee-949d-335a83988ba&title=)\n`checkpoint  checkpoint  CP  CP flush  write pos  CP redo log `\n\n2. \n3. MySQL \n4. MySQL MySQL  flush  MySQL \n\nInnoDB \n\n\n\n\n\n- \n-  0\n\nInnoDB \n\n### InnoDB \n\ninnodb_io_capacity  InnoDB  IOPS IOPS  fio \n```shell\n\n fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest \n```\n**InnoDB  redo log **\n\nInnoDB \n\n innodb_max_dirty_pages_pct  75%InnoDB  M 0  100 (F1(M))\n```sql\nF1(M)\n{\n  if M>=innodb_max_dirty_pages_pct then\n      return 100;\n  return 100*M/innodb_max_dirty_pages_pct;\n}\n```\nInnoDB  checkpoint  NInnoDB  N  0  100  F2(N)F2(N)  N \n\n F1(M)  F2(N)  R innodb_io_capacity  R% \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648457335769-b4d029f5-e5db-49f4-afac-8d4da16e3500.png#averageHue=%23edefe4&clientId=u6601b37f-239d-4&from=paste&id=uf9222f00&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u86033bb8-9020-4268-a3f2-4bffcba8a75&title=)\n 75%\n\n Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_total \n```sql\nmysql> select VARIABLE_VALUE into @a from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_dirty';\nselect VARIABLE_VALUE into @b from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_total';\nselect @a/@b;\n```\n\n flush  MySQL \n\n InnoDB innodb_flush_neighbors  1  0 \n\n## \n###  innodb_file_per_table\n innodb_file_per_table \n\n-  OFF \n-  ON  InnoDB  .ibd \n\n MySQL 5.6.6  ON \n\n drop table \t\n\n innodb_file_per_table  ON\n\n### \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648458246901-2059df42-0c96-480b-ab06-32e2de24bf39.png#averageHue=%23f1f1eb&clientId=u6601b37f-239d-4&from=paste&id=u60cc30d7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=125104&status=done&style=none&taskId=uea35a2b3-8b62-4c81-996a-89295f00942&title=)\n R4 InnoDB  R4  ID  300  600  ()\n\nR4  ID  400  ID  800 \n\n B+   page A page A  ID=50 page A \n\n\n\n delete \n\ndelete  delete \n\n\n\n\n page A \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648459031612-11d73511-84fb-4435-a36c-041513621a6e.png#averageHue=%23ecece4&clientId=u6601b37f-239d-4&from=paste&id=ub5d91120&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386541&status=done&style=none&taskId=u936777ff-9e33-4869-a5d0-ec6cc0b8295&title=)\n page A  ID  550  page B page A  1 \n\n\n\n### \n A\n\n A  B ID  A  B \n\n B  A  B  B  B  A  B  B  A A \n\n **alter table A engine=InnoDB**  MySQL 5.5  B MySQL \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460656185-14aee1dd-885c-47b2-a030-28ea6ec8cb57.png#averageHue=%23eae9df&clientId=u6601b37f-239d-4&from=paste&id=u9c4de8a8&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=514037&status=done&style=none&taskId=uc61ce6a1-1af4-40f9-a3aa-94c8c8cbb13&title=)\n\n A  DDL  A  DDL  Online \n\n** MySQL 5.6  Online DDL**\n\n Online DDL \n\n1.  A \n2.  A  B+ \n3.  A row log state2 \n4.  A  state3 \n5.  A \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460673335-4500620b-e333-4439-8366-d2f4c69765aa.png#averageHue=%23e8e8dd&clientId=u6601b37f-239d-4&from=paste&id=u53977a6f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=397982&status=done&style=none&taskId=u68a17300-301c-4350-b4ff-8913ac7b306&title=)\n`Online DDL MDL, MDLMDLOnline MDL`\n\n## count(*)\n### count(*) \n\n- MyISAM  count(*) \n-  InnoDB  count(*) \n\n`MyISAM count whereInnoDB`\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648518819244-17e71729-17f5-41d0-af7f-c120ae34b61d.png#averageHue=%23f9f9f9&clientId=ue5c9d5d3-f062-4&from=paste&id=u1d9077ed&originHeight=362&originWidth=943&originalType=url&ratio=1&rotation=0&showTitle=false&size=68577&status=done&style=none&taskId=u52029278-5cd6-4933-bd23-f236702007c&title=)\n InnoDB  MVCC  count(*) InnoDB \n\nInnoDB  count(*) **MySQL **\n\n###  count \ncount()  count  NULL 1\n\ncount(*)count( id)  count(1)  count( NULL \n\n** count( id) **InnoDB  id  server server  id \n\n** count(1) **InnoDB ****server 1\n\ncount(1)  count( id)  id \n\n** count() ** not null  null\n null null null \n\n** count(*) **count(*)  null\n\n**count()<count( id)<count(1)count(*)**\n\n## order by\n\n### \n```sql\nselect city,name,age from t where city='' order by name limit 1000  ;(city)\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563803148-12d05c2e-862d-41a3-92cc-079081c02eec.png#averageHue=%2305040e&clientId=ub49b8c3b-28e5-4&from=paste&id=u51b876bf&originHeight=126&originWidth=1470&originalType=url&ratio=1&rotation=0&showTitle=false&size=275103&status=done&style=none&taskId=u04ab12bb-161a-4189-8085-6ff37e68c53&title=)\nExtra Using filesortMySQL  sort_buffer\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563889459-6771ce6b-40c0-43fe-b195-d8b4fd06dba4.png#averageHue=%23f1f0ea&clientId=ub49b8c3b-28e5-4&from=paste&id=u5ad65b3c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=244167&status=done&style=none&taskId=u4687b797-6402-426d-b26f-c616d1dcf1f&title=)\n city=' ID_X  ID_(X+N) \n \n\n1.  sort_buffer namecityage \n2.  city  city=' id ID_X\n3.  id  namecityage  sort_buffer \n4.  city  id\n5.  34  city  id  ID_Y\n6.  sort_buffer  name \n7.  1000 \n\n name  sort_buffer_size\n\nsort_buffer_size MySQL sort_buffer sort_buffer_size\n\n\n```sql\n/* optimizer_trace */\nSET optimizer_trace='enabled=on'; \n\n/* @aInnodb_rows_read */\nselect VARIABLE_VALUE into @a from  performance_schema.session_status where variable_name = 'Innodb_rows_read';\n\n/*  */\nselect city, name,age from t where city='' order by name limit 1000; \n\n/*  OPTIMIZER_TRACE  */\nSELECT * FROM `information_schema`.`OPTIMIZER_TRACE`\\G\n\n/* @bInnodb_rows_read */\nselect VARIABLE_VALUE into @b from performance_schema.session_status where variable_name = 'Innodb_rows_read';\n\n/* Innodb_rows_read */\nselect @b-@a;\n```\n OPTIMIZER_TRACE  number_of_tmp_files \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648564689820-6f0d8fa4-6687-4e4f-ad20-5e6a1d4a1280.png#averageHue=%23090109&clientId=ub49b8c3b-28e5-4&from=paste&id=ud81073ab&originHeight=183&originWidth=713&originalType=url&ratio=1&rotation=0&showTitle=false&size=103799&status=done&style=none&taskId=ufc87cf83-e1f6-4102-90a8-7243ba19e13&title=)\nnumber_of_tmp_files  12 MySQL  12  12 \n\n sort_buffer_size number_of_tmp_files  0\n\n**sort_buffer_size **number_of_tmp_files sort_buffer_sizesort_buffer_size\n\n**examined_rows=4000 4000 **\n\n**sort_mode  packed_additional_fields  name  varchar(16)**\n\n** select @b-@a  4000 4000 **\n\n### rowid \n\n\n sort_buffer ** sort_buffer **\n\n\n\n MySQL ?\n\n MySQL \n```sql\nSET max_length_for_sort_data = 16;\n```\nMySQL MySQL \n\n sort_buffer  name  id\n\n city  age \n\n1.  sort_buffer name  id\n2.  city  city=' id ID_X\n3.  id  nameid  sort_buffer \n4.  city  id\n5.  34  city=' ID_Y\n6.  sort_buffer  name \n7.  1000  id  cityname  age \n\nrowid  t  7\n\n MySQL  sort_buffer  id cityname  age ``\n\n**rowid  OPTIMIZER_TRACE **\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566128890-cf3076d8-183b-4f66-95fb-6db07943954f.png#averageHue=%23080109&clientId=ub49b8c3b-28e5-4&from=paste&id=u025fd973&originHeight=183&originWidth=468&originalType=url&ratio=1&rotation=0&showTitle=false&size=93232&status=done&style=none&taskId=uaae4be2c-c501-4cc6-b296-5a9fed1e59a&title=)\n**select @b-@a  5000 ** id  limit 1000 1000 \n\n**sort_mode  <sort_key, rowid>** name  id \n\n**number_of_tmp_files  10 ** 4000 \n\n MySQL  rowid \n\n MySQL  sort_buffer \n\n MySQL ****\n\n order by MySQL ****\n\n city  name \n\n city  name \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566346093-471e3c9b-0b83-4c38-95cd-1c6b5d7f58ca.png#averageHue=%23f0efe8&clientId=ub49b8c3b-28e5-4&from=paste&id=u9d957077&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=250929&status=done&style=none&taskId=ub68238d3-09db-4d04-9d04-8aa7a1bb945&title=)\n city=' city name \n\n\n\n1.  (city,name)  city=' id\n2.  id  namecityage \n3.  (city,name)  id 23\n4.  1000  city='\n\n![ (city,name) ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566428823-b2716a19-cb2c-48a4-a0ad-94552cf1ae7d.png#averageHue=%2307020a&clientId=ub49b8c3b-28e5-4&from=paste&id=u30022e94&originHeight=127&originWidth=1382&originalType=url&ratio=1&rotation=0&showTitle=true&size=250223&status=done&style=none&taskId=u72da902c-04e1-462b-87e2-4c65adca397&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92 \" (city,name) \")\n`rows,Using index condition ICP` \n\nExtra  Using filesort  (city,name)  4000  1000 ** 1000 **\n\n cityname  age \n\n cit\ty  name \n\n1.  (city,name,age)  city=' cityname  age \n2.  (city,name,age) \n3.  2 1000  city='\n\n![ (city,name,age) ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566612447-97a4f6c2-8f67-4a0b-8614-eb63ab8093aa.png#averageHue=%2306030d&clientId=ub49b8c3b-28e5-4&from=paste&id=ufc70bd2c&originHeight=125&originWidth=1586&originalType=url&ratio=1&rotation=0&showTitle=true&size=266076&status=done&style=none&taskId=u3093dc9d-f32b-4b81-b102-2d08dd4fe1b&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%2Cage%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92 \" (city,name,age) \")Extra Using index\n\n## order by rand()\n```sql\nselect word from words order by rand() limit 3;\n```\n 3  SQL \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648802439889-2e2907be-5fc4-411a-b79f-f9a29153b597.png#averageHue=%2308020a&clientId=ud645e606-5915-4&from=paste&id=u14caa359&originHeight=142&originWidth=1553&originalType=url&ratio=1&rotation=0&showTitle=false&size=269434&status=done&style=none&taskId=uc50316d7-c136-4ce7-92d6-3c16c7a8496&title=)\nExtra  Using temporaryUsing filesort\n\n InnoDB \nMySQL  rowid \n\n:\n\n1.  memory  double  R varchar(64)  W\n2.  words  word  word  rand()  0  1  word  R  W  10000\n3.  10000  R \n4.  sort_buffersort_buffer  double \n5.  R  sort_buffer  10000 20000\n6.  sort_buffer  R \n7.  word  20003\n\n InnoDB  6  rowid rowid  InnoDB  rowid  ID InnoDB  rowid MEMORY  rowid \n\n**order by rand()  rowid **\n\n****\n\n**tmp_table_size ** 16M tmp_table_size\n\n InnoDB **internal_tmp_disk_storage_engine** \n InnoDB \n\n### \n SQL  R  3  rowid 3  10000  9997 \n\n``\n\n-  10000  (R,rowid)\n-  (R,rowid) R  R R (R,rowid)  (R,rowid)\n-  2  10000  (R,rowid) \n\n```sql\nselect city,name,age from t where city='' order by name limit 1000  ;\n```\n limit SQL  limit 1000 1000  (name,rowid) sort_buffer_size `limit 3 sort_buffer_size `\n\n## group by\n```sql\ncreate table t1(id int primary key, a int, b int, index(a));\ndelimiter ;;\ncreate procedure idata()\nbegin\n  declare i int;\n\n  set i=1;\n  while(i<=1000)do\n    insert into t1 values(i, i, i);\n    set i=i+1;\n  end while;\nend;;\ndelimiter ;\ncall idata();\n```\n```sql\nselect id%10 as m, count(*) as c from t1 group by m;\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112503277-b1df9ad1-1d95-417a-b8e9-48a390770a29.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=ua744d424&originHeight=143&originWidth=1702&originalType=url&ratio=1&rotation=0&showTitle=false&size=30065&status=done&style=none&taskId=u53a60222-d9e4-44f3-a5c7-c090d7a9176&title=)\n Extra \n\n- Using index a\n\n`selectidaa  mysqla`\n\n- Using temporary\n- Using filesort\n\n:\n\n-  m  c m\n-  t1  a id  id%10  x\n-  x  (x,1);\n-  x  x  c  1 m \n### ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112629688-9b998014-3798-4028-931b-9518eb10ce2a.png#averageHue=%23eceee3&clientId=ud1598026-e3a9-4&from=paste&id=u878ce08e&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=184375&status=done&style=none&taskId=ub60c1c98-b904-4010-937c-eea5dfc94e9&title=)group by  -- \ngroup by  group by \n\n** group by **\ngroup by  id%100 \n\n\ngroup by \n\n### group by  -- \n group by  group by \n\n group by  SQL_BIG_RESULT hint\n```sql\nselect SQL_BIG_RESULT id%100 as m, count(*) as c from t1 group by m;\n```\nMySQL  B+ \n\n\n-  sort_buffer m\n-  t1  a id ,  id%100  sort_buffer \n-  sort_buffer  m  sort_buffer \n- \n\n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113519486-bb3649d2-8c16-4e6a-8062-50510591e8a6.png#averageHue=%23ecede2&clientId=ud1598026-e3a9-4&from=paste&id=u6443cf73&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=210067&status=done&style=none&taskId=u0c92938c-024f-4ede-8a67-6aa3e16f37b&title=)\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113533494-091befc2-665e-42da-a822-2fa5fc25cb92.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=u68823f55&originHeight=131&originWidth=1393&originalType=url&ratio=1&rotation=0&showTitle=false&size=26738&status=done&style=none&taskId=u04fcce2b-a93b-4148-a3cf-bb5c45ac1b9&title=)\n Extra \n** group by  tmp_table_size **\n### MySQL \n\n1. \n2. join_buffer sort_buffer \n3. union  group by \n\n\n## \n```sql\nmysql> select count(*) from tradelog where month(t_modified)=7;\n\nt_modified\n\n```\nsql MySQL \n![t_modified ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822518074-948569d9-c7f4-49f5-9441-51b175a23451.png#averageHue=%23f0f1e8&clientId=ud5261830-7282-4&from=paste&id=ua20d9e1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=191123&status=done&style=none&taskId=u64ba332a-9084-4148-a92a-ecdce1abbba&title=t_modified%20%E7%B4%A2%E5%BC%95%E7%A4%BA%E6%84%8F%E5%9B%BE \"t_modified \")\n SQL  where t_modified='2018-7-1 t_modified='2018-7-1\n** month()  7 **\n\n****\n\n\n t_modified t_modified  t_modified\t\t\n\n![explain](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822684575-4deb9a96-f251-4f0c-a536-19871141453c.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=u523bd677&originHeight=143&originWidth=1637&originalType=url&ratio=1&rotation=0&showTitle=true&size=30107&status=done&style=none&taskId=u05bb406e-1cdf-4bce-933e-d07153bbc8c&title=explain%E7%BB%93%E6%9E%9C \"explain\")\n` select * from tradelog where id + 1 = 10000  SQL  1  MySQL  id  9999  SQL  where id = 10000 -1 `\n\n```sql\nselect * from tradelog where tradeid=110717;\ntradeid\ntradeid  varchar(32)\n\ntradelog \n```\nexplain \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648823298719-44df7f75-794e-4dc6-ac68-e1be2aee1bf7.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=uf55b0bbd&originHeight=142&originWidth=289&originalType=url&ratio=1&rotation=0&showTitle=false&size=6704&status=done&style=none&taskId=u73751b53-f437-460b-90a1-85cdf341157&title=)\nselect 10 > 9  1 MySQL  MySQL \n`ascii 101ascii90`\n\nsql\n```sql\nmysql> select * from tradelog where  CAST(tradid AS signed int) = 110717;\n```\n\n\n## select \n```sql\nmysql> select * from t where id=1;\n```\n\n\n t  show processlist \n### MDL\n![Waiting for table metadata lock](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878603446-1b67ed04-aa0f-4961-bdb2-c048db08684d.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=u6b91757f&originHeight=213&originWidth=1312&originalType=url&ratio=1&rotation=0&showTitle=true&size=295984&status=done&style=none&taskId=ua6b64a57-39e2-4f8b-a20b-acb19d0de19&title=Waiting%20for%20table%20metadata%20lock \"Waiting for table metadata lock\")\n t  MDL  select \n\n show processlist session A  Command Sleep performance_schema  sys MySQL  performance_schema=on off  10% )\n\n **sys.schema_table_lock_waits**  process id kill \n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878943676-cb1e66f6-9274-4266-8aa5-3473ff341e1b.png#averageHue=%23f7f7f7&clientId=u9da0f65c-5a8c-4&from=paste&id=ud724efe0&originHeight=251&originWidth=940&originalType=url&ratio=1&rotation=0&showTitle=false&size=83355&status=done&style=none&taskId=u8346b506-65e9-42ee-b198-0ecd2158dde&title=)\n### flush\n![Waiting for table flush](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648879417166-43881340-f096-4563-b5e4-9bc5829cc62b.png#averageHue=%2308010a&clientId=u9da0f65c-5a8c-4&from=paste&id=u25a60694&originHeight=147&originWidth=1221&originalType=url&ratio=1&rotation=0&showTitle=true&size=221669&status=done&style=none&taskId=u5a5b1b06-1adc-4505-9c55-cfed57c8142&title=Waiting%20for%20table%20flush \"Waiting for table flush\")\n t  flush MySQL  flush \n```sql\nflush tables t with read lock;\nflush tables with read lock;\n```\n flush  t  t MySQL \n\n\n\n Waiting for table flush  flush tables  select \n flush\n\n### \n```sql\nselect * from t where id=1 lock in share mode;\n```\n id=1  select \n\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648881044186-e94acc20-7f4a-4b13-8ce4-9f73b9518af8.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=uc3a1df43&originHeight=223&originWidth=1285&originalType=url&ratio=1&rotation=0&showTitle=false&size=291379&status=done&style=none&taskId=u1c9e4b89-2356-43cb-aef5-c8285c293e0&title=)\n```sql\nmysql> select * from t sys.innodb_lock_waits where locked_table='`test`.`t`'\\G\n```\n![ sys.innodb_lock_waits ](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883270487-dab3c3c5-e153-4d52-a60a-71f1fe51fcea.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=ued0ab6db&originHeight=669&originWidth=864&originalType=url&ratio=1&rotation=0&showTitle=true&size=580038&status=done&style=none&taskId=u3b80a197-9c94-402c-937a-19cb179068a&title=%E9%80%9A%E8%BF%87%20sys.innodb_lock_waits%20%E6%9F%A5%E8%A1%8C%E9%94%81 \" sys.innodb_lock_waits \")4  KILL QUERY 4  KILL 4KILL QUERY 4 4  update  KILL QUERY id=1 \n\nKILL 4  id=1 \n\n### \n```sql\nselect * from t where id=1   1\nselect * from t where id=1 lock in share mode  1000001\n\n```\n![image.png](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883585247-7e59dcec-0278-410b-82ab-1025272a021c.png#averageHue=%23f9f9f9&clientId=u9da0f65c-5a8c-4&from=paste&id=udaac8027&originHeight=322&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=52745&status=done&style=none&taskId=udb5dcded-28c0-407c-becc-849e1a9f50d&title=)\nsessionBsessionAsessionBundo log\n![select100w](https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883707434-705f7d40-60d4-4ffa-8029-406518fe2664.png#averageHue=%23edefe3&clientId=u9da0f65c-5a8c-4&from=paste&id=uccb7b493&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=215323&status=done&style=none&taskId=u3ead1e96-17fc-4831-b8f7-da92f1c225f&title=%E7%AC%AC%E4%B8%80%E4%B8%AAselect%E9%9C%80%E8%A6%81%E5%9B%9E%E6%BB%9A100w%E6%AC%A1%E6%89%8D%E8%83%BD%E5%B0%86%E8%BF%99%E4%B8%AA%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E \"select100w\")` lock in share mode  SQL  1000001 `\n`undo log  2  1 3  2`\n\n## \n\n\n\n## \n\n\n","slug":"Mysql","published":1,"date":"2023-05-12T02:22:13.322Z","updated":"2023-05-12T02:23:06.764Z","_id":"clhjxnth400000kscdqsk9e37","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"sql\"><a href=\"#sql\" class=\"headerlink\" title=\"sql\"></a>sql</h1><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648093341473-68f1e895-bb41-45cb-9b0e-cb0d7797a3e7.png#averageHue=%23ecefe2&clientId=ub35db475-a524-4&from=paste&id=ub86e15fd&originHeight=1440&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=true&size=609051&status=done&style=none&taskId=udd5444c6-42b3-4ee3-b7f0-c6b67a2ffc1&title=Mysql%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%9B%BE\" alt=\"Mysql\" title=\"Mysql\"><br>MySQL  Server </p>\n<p>Server  MySQL </p>\n<p> InnoDBMyISAMMemory  InnoDB MySQL 5.5.5 </p>\n<p> create table  InnoDB create table  engine&#x3D;memory, </p>\n<p> Server </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>h$ip <span class=\"operator\">-</span>P$port <span class=\"operator\">-</span>u$<span class=\"keyword\">user</span> <span class=\"operator\">-</span>p</span><br></pre></td></tr></table></figure>\n<p> -p </p>\n<p> mysql  TCP </p>\n<ul>\n<li><strong>Access denied for user</strong></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p> show processlist  show processlist  Command Sleep<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648100906726-b843b434-66a0-4c16-923d-149c872f5402.png#averageHue=%23060208&clientId=ub35db475-a524-4&from=paste&id=uec2e5d2a&originHeight=163&originWidth=875&originalType=url&ratio=1&rotation=0&showTitle=false&size=27260&status=done&style=none&taskId=u34b2b0d5-b675-4b6c-a3b8-99d595321e3&title=\" alt=\"image.png\"><br> <strong>wait_timeout <strong> 8 </strong> Lost connection to MySQL server during query</strong></p>\n<p></p>\n<p></p>\n<p> MySQL  MySQL OOM MySQL </p>\n<p></p>\n<ul>\n<li></li>\n<li> MySQL 5.7 mysql_reset_connection </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> select </p>\n<p>MySQL  key-value key value  key value </p>\n<p>MySQL </p>\n<p><strong></strong></p>\n<p></p>\n<p> MySQL  <strong>query_cache_type</strong>  DEMAND SQL  SQL_CACHE </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> SQL_CACHE <span class=\"operator\">*</span> <span class=\"keyword\">from</span> T <span class=\"keyword\">where</span> ID<span class=\"operator\">=</span><span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n<p>MySQL 8.0  8.0 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL  SQL </p>\n<p>MySQL  SQL </p>\n<p> SQL MySQL </p>\n<p>MySQL selectT TID ID</p>\n<p> SQL  MySQL <strong>You have an error in your SQL syntax</strong> select s</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL </p>\n<p>join</p>\n<p> join</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t1 <span class=\"keyword\">join</span> t2 <span class=\"keyword\">using</span>(ID) <span class=\"keyword\">where</span> t1.c<span class=\"operator\">=</span><span class=\"number\">10</span> <span class=\"keyword\">and</span> t2.d<span class=\"operator\">=</span><span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li> t1  c&#x3D;10  ID  ID  t2 t2  d  20</li>\n<li> t2  d&#x3D;20  ID  ID  t1 t1  c  10</li>\n</ul>\n<p></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL </p>\n<p> T  ( precheck )</p>\n<p></p>\n<p> T ID </p>\n<ul>\n<li> InnoDB  ID  10</li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p></p>\n<p> rows_examined </p>\n<p> rows_examined </p>\n<p>mysqlserviceinnodb<br>service<br>mysqltcp(8)  mysql</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>DMLinsert,update,delete,create redo log()  binlog() </code></p>\n<h2 id=\"redo-log\"><a href=\"#redo-log\" class=\"headerlink\" title=\"redo log\"></a>redo log</h2><h3 id=\"WAL\"><a href=\"#WAL\" class=\"headerlink\" title=\"WAL\"></a>WAL</h3><p><strong>MySQL  WAL WAL  Write-Ahead Logging</strong><br> MySQL  IO </p>\n<p>InnoDB InnoDB </p>\n<p><code>redo logioredo log </code><br><code>WAL IO   IO  redo log.</code></p>\n<p>InnoDB  redo log  4  1GB 4GB <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648108055998-29f22c92-5ea3-442e-9fdc-a5bb73578294.png#averageHue=%23f3f0e9&clientId=ub35db475-a524-4&from=paste&id=ub0653dee&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=230615&status=done&style=none&taskId=u4fa0be29-3fc3-491d-8a98-4028c4e8501&title=\" alt=\"image.png\">write pos  3  0 checkpoint </p>\n<p>write pos  checkpoint  write pos  checkpoint<strong></strong> checkpoint </p>\n<p> redo logInnoDB  <strong>crash-safe</strong><br><code>redo log  InnoDBInnoDB InnoDB redo log() crash-safe mysql</code></p>\n<p>** redo log  redo log  **</p>\n<h3 id=\"redo-log-\"><a href=\"#redo-log-\" class=\"headerlink\" title=\"redo log \"></a>redo log </h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877429762-363312e7-1539-40de-9cab-ac46d3c8e06c.png#averageHue=%23ecebd6&clientId=u84cf85c6-a1db-4&from=paste&id=ue760740b&originHeight=639&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=59527&status=done&style=none&taskId=ubb09edc4-d7a5-47b0-80c5-4fa65d36482&title=MySQL%20redo%20log%20%E5%AD%98%E5%82%A8%E7%8A%B6%E6%80%81\" alt=\"MySQL redo log \" title=\"MySQL redo log \"><br></p>\n<ol>\n<li> redo log buffer  MySQL </li>\n<li> (write)fsync) page cache </li>\n<li> hard disk</li>\n</ol>\n<p> redo log buffer wirte  page cache <br> redo log InnoDB  <strong>innodb_flush_log_at_trx_commit</strong> </p>\n<ol>\n<li> 0  redo log  redo log buffer  ;</li>\n<li> 1  redo log </li>\n<li> 2  redo log  page cache</li>\n</ol>\n<p>InnoDB  1  redo log buffer  write  page cache fsync <br><code>binlogbinlogbinlog cacheredo logredo log buffer</code><br> redo log  redo log buffer  redo log <strong> redo log</strong></p>\n<p> redo log </p>\n<ol>\n<li>redo log buffer  innodb_log_buffer_size  write fsync page cache<code>innodb_log_buffer_size  innodb , 8MB</code></li>\n<li> redo log buffer  A  redo log  buffer  B  innodb_flush_log_at_trx_commit  1 B  redo log buffer  A  redo log buffer </li>\n</ol>\n<p><code> innodb_flush_log_at_trx_commit  1 redo log  prepare </code></p>\n<p> MySQL  1 sync_binlog  innodb_flush_log_at_trx_commit  1 redo logprepare  binlog</p>\n<h2 id=\"binlog\"><a href=\"#binlog\" class=\"headerlink\" title=\"binlog\"></a>binlog</h2><p>MySQL  Server  MySQL ,redo log  InnoDB  Server  binlog</p>\n<p> MySQL  InnoDB MySQL  MyISAM MyISAM  crash-safe binlog  InnoDB  MySQL  binlog  crash-safe  InnoDB  redo log  crash-safe <br><code>binlogcrashbinlog,binlogredologcheck pointwrite pos (write poscheck point)redolog</code><br><code>redo log  binlog  redo log  redo log binlog   crash  redo log  binlog binlog  binlog  innoDB </code></p>\n<p></p>\n<ul>\n<li>redo log  InnoDB binlog  MySQL  Server </li>\n<li>redo log binlog  ID&#x3D;2  c  1 </li>\n<li>redo log binlog  binlog </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> InnoDB  update </p>\n<ol>\n<li> ID&#x3D;2 ID  ID&#x3D;2 </li>\n<li> 1 N N+1</li>\n<li> redo log  redo log  prepare </li>\n<li> binlog binlog </li>\n<li> redo log commit</li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648113221297-708a4029-be16-4b31-9538-1ef82cece307.png#averageHue=%23ecede2&clientId=ub35db475-a524-4&from=paste&height=487&id=eROFt&originHeight=731&originWidth=513&originalType=binary&ratio=1&rotation=0&showTitle=false&size=149649&status=done&style=none&taskId=u1d9c41ee-c839-4ec7-a5e3-d67f8b6c729&title=&width=342\" alt=\"image.png\"><br> redo log prepare  commit<br> redo log  binlog  redo log  binlog</p>\n<p> update  ID&#x3D;2  c  0 update  crash</p>\n<p><strong> redo log  binlog</strong> redo log binlog MySQL redo log  c  1 binlog  crash  binlog  binlog  binlog  binlog  c  0</p>\n<p><strong> binlog  redo log</strong> binlog  crash redo log  c  0 binlog  c  0  1 binlog  c  1</p>\n<p></p>\n<p></p>\n<p> binlog redo log  binlog </p>\n<p>Binlogstatement sql row</p>\n<p><strong>MySQL </strong><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650437373196-5ae1790e-1e28-4526-992e-88a474a8fc80.png#averageHue=%23edeee2&clientId=u52eb2620-e685-4&from=paste&id=uc6cedb1d&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=634267&status=done&style=none&taskId=u44f064d3-65b6-4987-b3a8-796c757e343&title=\" alt=\"image.png\"><br>1 A  redo log  prepare  binlog crash binlog redo log binlog <br>2 B binlog redo log  commit  crash MySQL </p>\n<ul>\n<li> redo log  commit </li>\n<li> redo log  prepare binlog <ul>\n<li>a. </li>\n<li>b. </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"binlog\"><a href=\"#binlog\" class=\"headerlink\" title=\"binlog\"></a>binlog</h3><h4 id=\"statement\"><a href=\"#statement\" class=\"headerlink\" title=\"statement\"></a>statement</h4><p> binlog_format&#x3D;statement binlog  SQL </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> t <span class=\"comment\">/*comment*/</span>  <span class=\"keyword\">where</span> a<span class=\"operator\">&gt;=</span><span class=\"number\">4</span> <span class=\"keyword\">and</span> t_modified<span class=\"operator\">&lt;=</span><span class=\"string\">&#x27;2018-11-10&#x27;</span> limit <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">show</span> binlog events <span class=\"keyword\">in</span> <span class=\"string\">&#x27;master.000001&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876306414-ef659638-160f-4294-86c2-1bedf9932b53.png#averageHue=%23090109&clientId=u84cf85c6-a1db-4&from=paste&id=u0bed92d0&originHeight=213&originWidth=1882&originalType=url&ratio=1&rotation=0&showTitle=false&size=43916&status=done&style=none&taskId=u7696b2bc-d028-4672-b728-7d0c514bfb8&title=\" alt=\"image.png\"><br> BEGIN commit </p>\n<p> delete use test MySQL  test  t</p>\n<h4 id=\"row\"><a href=\"#row\" class=\"headerlink\" title=\"row\"></a>row</h4><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876481808-6f610fff-712f-4e13-8dba-b32366c53c42.png#averageHue=%23050207&clientId=u84cf85c6-a1db-4&from=paste&id=u2fbfb767&originHeight=533&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=false&size=419977&status=done&style=none&taskId=u21be3baf-c2b0-4a03-99c2-b2487712508&title=\" alt=\"image.png\"><br> statement  binlog  BEGIN  COMMIT row  binlog  SQL  eventTable_map  Delete_rows</p>\n<p>Table_map event test  t;Delete_rows event<br> binlog_format  row binlog  id binlog  id&#x3D;4 </p>\n<h4 id=\"mixed\"><a href=\"#mixed\" class=\"headerlink\" title=\"mixed\"></a>mixed</h4><p> statement  binlog  row  row  delete  10  statement  SQL  binlog  row  binlog 10  binlog  binlog  IO MySQL  mixed  binlogmixed MySQL  SQL  row  statement </p>\n<h3 id=\"binlog-\"><a href=\"#binlog-\" class=\"headerlink\" title=\"binlog \"></a>binlog </h3><p>binlog  binlog cache binlog cache  binlog </p>\n<p> binlog  binlog cache </p>\n<p> binlog cache  binlog_cache_size  binlog cache </p>\n<p> binlog cache  binlog  binlog cache</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877216791-c4eec49b-0149-4260-8ae2-1faf6b27731e.png#averageHue=%23a1bd8c&clientId=u84cf85c6-a1db-4&from=paste&id=ucd5cd72c&originHeight=748&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=350828&status=done&style=none&taskId=u7be45086-e9e1-4fca-905f-58cd27461ae&title=\" alt=\"image.png\"><br> binlog cache binlog </p>\n<p> write page cache<br> fsync fsync  IOPS<br>write  fsync  <strong>sync_binlog</strong> </p>\n<p>sync_binlog&#x3D;0  write fsyncsync_binlog&#x3D;1  fsyncsync_binlog&#x3D;N(N&gt;1)  write N  fsync</p>\n<p> IO  sync_binlog  0 100~1000  sync_binlog  N N  binlog </p>\n<h2 id=\"redo-log--binlog-\"><a href=\"#redo-log--binlog-\" class=\"headerlink\" title=\"redo log  binlog ?\"></a>redo log  binlog ?</h2><p> XID redo log prepare commit  redo log<br> parepare commit  redo log XID  binlog <br>binlog</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"LSN\"><a href=\"#LSN\" class=\"headerlink\" title=\"LSN\"></a>LSN</h3><p>log sequence numberLSN<br>LSN  redo log  length  redo log LSN  length</p>\n<p>LSN  InnoDB  redo log<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877956349-248ca201-d6c2-43a0-ac70-ae7d4c7bce0a.png#averageHue=%23e3e3bf&clientId=u84cf85c6-a1db-4&from=paste&id=ud19e5689&originHeight=2171&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=398351&status=done&style=none&taskId=u4a4d4116-61f8-48a7-bbdb-764b0f1ad4c&title=\" alt=\"image.png\"><br>trx1  leader trx1  LSN  160trx1  LSN&#x3D;160 trx1  LSN  160  redo log trx2  trx3 </p>\n<p> redo log buffer  fsync  IOPS </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650878105681-14abb035-6107-418a-b237-a148a90f3feb.png#averageHue=%23f1f2e9&clientId=u84cf85c6-a1db-4&from=paste&id=u3fd2b35f&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=210196&status=done&style=none&taskId=u794cd052-0d6a-467a-8b8e-ad30ca66b63&title=%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%E7%BB%86%E5%8C%96\" alt=\"\" title=\"\"><br> binlog  <strong>binlog_group_commit_sync_delay</strong>  <strong>binlog_group_commit_sync_no_delay_count</strong> <br><strong>binlog_group_commit_sync_delay</strong>  fsync;<br><strong>binlog_group_commit_sync_no_delay_count</strong>  fsync</p>\n<p><strong>WAL  redo log  binlog?</strong></p>\n<ul>\n<li>redo log  binlog </li>\n<li> IOPS </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong><br></p>\n<ol>\n<li>innoDBredo log checkpoint redo log checkPoint flushredologredolog</li>\n<li></li>\n<li>mysql</li>\n<li>mysql</li>\n</ol>\n<p>redolog</p>\n<p>InnoDB <strong>buffer pool</strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>i**nnodb_io_capacity ** InnoDB ,IOPS<br><code>IOPS:Input/Output Operations Per Second,(I/O)</code></p>\n<p>InnoDB  redo log </p>\n<p>** innodb_max_dirty_pages_pct**  75%InnoDB  M 0  100  F1(M)</p>\n<p>redolog,InnoDB  checkpoint  NInnoDB  N  0  100  F2N</p>\n<p> F1(M)  F2(N)  R innodb_io_capacity  R% <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650436507824-2065113f-bb0b-4c48-ae9b-c90c853b9f70.png#averageHue=%23edefe4&clientId=u52eb2620-e685-4&from=paste&id=ud0ac7cf8&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u467db1e5-c649-40bd-9c85-90a5b6a7636&title=\" alt=\"image.png\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> MySQL MySQL  MySQL  MyISAM  MyISAM  InnoDB </p>\n<p><strong> ACIDAtomicityConsistencyIsolationDurability</strong><br><strong>:</strong><br><strong>:</strong><br><strong>:</strong><br><strong>:redoLog+binlog</strong></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>dirty readnon-repeatable readphantom read</p>\n<p><strong></strong>SQL read uncommittedread committedrepeatable readserializable </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> T  1<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648114969737-ca2280ec-d1d7-403f-ab13-926f1dfe3d99.png#averageHue=%23f2f1ed&clientId=ub35db475-a524-4&from=paste&id=u3d4fa0c4&originHeight=1420&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386590&status=done&style=none&taskId=u2cf5b523-30d0-40be-8854-8517eb9d974&title=\" alt=\"image.png\"><br> A  V1V2V3 </p>\n<p>  V1  2 B  A V2V3  2</p>\n<p> V1  1V2  2 B  A  V3  2</p>\n<p> V1V2  1V3  2 V2  1<strong></strong></p>\n<p> B  1  2 A  B  A  V1V2  1V3  2</p>\n<p><strong></strong> SQL </p>\n<p>Oracle  Oracle  MySQL  MySQL (mysql )</p>\n<p>** transaction-isolation** ** READ-COMMITTED** show variables </p>\n<p><strong></strong><br></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> MySQL  1  234<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648115713483-7e04eee4-1941-44e6-a4e7-f56490fefa37.png#averageHue=%23f2f1eb&clientId=ub35db475-a524-4&from=paste&id=ubed388d6&originHeight=737&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=248434&status=done&style=none&taskId=u190e6fc5-52a1-48d9-8607-953b27a477b&title=\" alt=\"image.png\"><br> 4 read-view ABC  124MVCC read-view A 1</p>\n<p> 4  5 read-view ABC </p>\n<p> read-view </p>\n<p></p>\n<p><strong></strong></p>\n<p><code>RRread-view,</code></p>\n<p> MySQL 5.5  ibdata  20GB 200GB </p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>MySQL  begin  start transaction commit rollbackset autocommit&#x3D;0 select </p>\n<p> commit  rollback </p>\n<p> set autocommit&#x3D;0  set autocommit&#x3D;1, </p>\n<p> begin</p>\n<p> commit work and chain  autocommit  1  begin  commit  commit work and chain begin </p>\n<p></p>\n<p> information_schema  innodb_trx  60s </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> information_schema.innodb_trx <span class=\"keyword\">where</span> TIME_TO_SEC(timediff(now(),trx_started))<span class=\"operator\">&gt;</span><span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> MySQL <br> view create view  <br> InnoDB  MVCC  <strong>consistent read view</strong> RCRead Committed RRRepeatable Read</p>\n<p></p>\n<p>InnoDB  ID transaction id<strong></strong> InnoDB </p>\n<p><strong></strong> transaction id  ID row trx_id (row) row trx_id</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648431114419-7ad7fe30-7e51-44e9-83e8-381a4139a59c.png#averageHue=%23edefe4&clientId=ubdd7c6a3-1836-4&from=paste&id=u1f4cd4e2&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=349597&status=done&style=none&taskId=u6a2056db-3401-4df7-ae8f-e23a3b4608c&title=%E5%9B%BE1%3A%E8%AE%B0%E5%BD%95%E8%A2%AB%E5%A4%9A%E4%B8%AA%E4%BA%8B%E5%8A%A1%E8%BF%9E%E7%BB%AD%E6%9B%B4%E6%96%B0%E5%90%8E%E7%9A%84%E7%8A%B6%E6%80%81%E3%80%82\" alt=\"1:\" title=\"1:\"><br> 4  V4k  22 transaction id  25  row trx_id  25</p>\n<p> <strong>undo log</strong> V1V2V3  undo log  V2  V4  U3U2 </p>\n<p></p>\n<p><br><code>Undo Logs</code></p>\n<p></p>\n<p>** InnoDB ** ID<br><code>trx_id</code></p>\n<p> ID  ID  1 </p>\n<p>read-view row trx_id </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648433319988-54447ac9-f2d7-442a-9fdf-d94d9a2584ba.png#averageHue=%23f4efe8&clientId=ubdd7c6a3-1836-4&from=paste&id=u2ff698cc&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=146395&status=done&style=none&taskId=u159b7bfa-f7ad-40c3-a9c8-151a3a6cb32&title=\" alt=\"image.png\"><br><strong></strong> row trx_id</p>\n<ol>\n<li></li>\n<li></li>\n<li><ul>\n<li> row trx_id </li>\n<li> row trx_id </li>\n</ul>\n</li>\n</ol>\n<p><code>IDID[1,2,3,5]41-54</code><br><code>id 99100102104105id 101103 99</code><br><code>**ABAB ABBA**</code></p>\n<p> <strong>InnoDB </strong></p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `k` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t(id, k) <span class=\"keyword\">values</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>),(<span class=\"number\">2</span>,<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436642991-cb96c42e-1d75-451f-8bfe-da1fe5ce2c8d.png#averageHue=%23fafafa&clientId=ubdd7c6a3-1836-4&from=paste&id=u88640d3b&originHeight=509&originWidth=910&originalType=url&ratio=1&rotation=0&showTitle=false&size=77588&status=done&style=none&taskId=ua2ee9126-6b57-46ec-8113-c6447e13318&title=\" alt=\"image.png\"><br>begin&#x2F;start transaction  InnoDB ** start transaction with consistent snapshot** <br><br> start transaction with consistent snapshot </p>\n<p><br> A  ID  99<br> ABC  100101102<br>(1,1 row trx_id  90<br> A [99,100],  B [99,100,101],  C [99,100,101,102]<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436831411-e1b8b943-71ac-4b16-90d6-cdc022316d02.png#averageHue=%23bbcaae&clientId=ubdd7c6a3-1836-4&from=paste&id=uf77228b9&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=389463&status=done&style=none&taskId=ucfa9e2d6-3e31-4da4-8fb4-27f1046d8bb&title=\" alt=\"image.png\"><br><code>A102102AA2(cA)</code></p>\n<p> C (1,1)  (1,2) row trx_id  102 90 </p>\n<p> B (1,2)  (1,3) row trx_id 101 102 <br><code></code></p>\n<p> A [99,100] A </p>\n<ul>\n<li> (1,3)  row trx_id&#x3D;101()</li>\n<li> row trx_id&#x3D;102</li>\n<li>1,1) row trx_id&#x3D;90</li>\n</ul>\n<p> A </p>\n<p><strong> B  update </strong><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648438902227-33dfff5b-7752-42f9-ae8f-4ba54824af5b.png#averageHue=%23c2d0b7&clientId=ubdd7c6a3-1836-4&from=paste&id=u29cc65f6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=181203&status=done&style=none&taskId=ubc0f1fa8-0770-462c-a1c2-f5bf051a302&title=\" alt=\"image.png\"><br> B  C  (1,2)  (1,3) <br> B  k  1</p>\n<p><strong>current read</strong><br><code>CBCB  CBCB</code></p>\n<p> (1,2) (1,3) row trx_id  101</p>\n<p> B  101 101 k  3</p>\n<p> update select </p>\n<p> A  select * from t where id&#x3D;1  <strong>lock in share mode</strong>  <strong>for update</strong> 101  k  3 select S <strong></strong>X <strong></strong><br><code></code><br><code></code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> k <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> lock <span class=\"keyword\">in</span> share mode;</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> k <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br></pre></td></tr></table></figure>\n\n<p> C  C\t\t\t<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439136431-4b35da83-71d7-4f2e-aacc-34b0b870f86b.png#averageHue=%23f9f9f9&clientId=ubdd7c6a3-1836-4&from=paste&id=u555af770&originHeight=565&originWidth=906&originalType=url&ratio=1&rotation=0&showTitle=false&size=90942&status=done&style=none&taskId=u257c13bb-7de7-4653-ae0c-08c330e0e8d&title=\" alt=\"image.png\"><br> C B  C (1,2)  B </p>\n<p> C (1,2)  B <strong></strong><strong></strong> C<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439181432-b5b054ed-4f67-44a5-b6a0-63dfd27c5fe5.png#averageHue=%23c1cfb6&clientId=ubdd7c6a3-1836-4&from=paste&id=u28580c0d&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=337234&status=done&style=none&taskId=u654b2065-2bcb-4bfc-9b0f-587f4f74d55&title=\" alt=\"image.png\"></p>\n<p><strong>consistent read</strong></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> A  B  k<br><code>start transaction with consistent snapshot;  start transaction</code></p>\n<p> read view  C  C<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439281611-5d682321-af61-48bc-87f1-c12fcaf0b6ae.png#averageHue=%23a0b792&clientId=ubdd7c6a3-1836-4&from=paste&id=u3133d187&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=534050&status=done&style=none&taskId=u99b6227f-1384-4887-a71b-d08f6a30f1b&title=\" alt=\"image.png\"></p>\n<p> A  (1,2)(1,3) (1,3) (1,2)  <br> A  k&#x3D;2<br> B  k&#x3D;3</p>\n<p> row trx_id</p>\n<p>MySQL 8.0  InnoDB </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> 500 </p>\n<p><code>   +  </code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> - key-value key Value key  value </p>\n<p> key </p>\n<p></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172350141-1148f1ae-5357-4246-9e55-df37b38e9a0c.png#averageHue=%23ebede1&clientId=ub38593e9-da58-4&from=paste&id=u711c2508&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=394076&status=done&style=none&taskId=ue30f032e-37eb-4230-8d4b-9bab7ebb4ed&title=\" alt=\"image.png\"><br>User2  User4  N ID_card_n2  ID_card_n2  N User2</p>\n<p> ID_card_n  User <strong></strong></p>\n<p>[ID_card_X, ID_card_Y]</p>\n<p> Memcached  NoSQL </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172988285-612ee6fd-9e8e-40e7-9548-c8f73834f70f.png#averageHue=%23eff0e7&clientId=ub38593e9-da58-4&from=paste&id=u523f9001&originHeight=787&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=261326&status=done&style=none&taskId=u52aeb952-9eaa-40a9-9029-3f108f01bad&title=\" alt=\"image.png\"><br> ID_card_n2  O(log(N))</p>\n<p>[ID_card_X, ID_card_Y] User ID_card_X ID_card_X ID_card_X  User ID_card_Y </p>\n<p></p>\n<p> 2017 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648173122656-422a42b5-a1f1-4d77-bc75-06766e296dff.png#averageHue=%23edeee5&clientId=ub38593e9-da58-4&from=paste&id=ue2441f8f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=445439&status=done&style=none&taskId=u5719c66d-7877-4064-a4df-e1c3f17715c&title=\" alt=\"image.png\"><br> ID_card_n2  UserA -&gt; UserC -&gt; UserF -&gt; User2  O(log(N))</p>\n<p> O(log(N))  O(log(N))</p>\n<p></p>\n<p> 100  20 20  10 ms  100  20  10 ms </p>\n<p>N N N</p>\n<p> InnoDB  N  1200 4  1200  3  17  10  3 </p>\n<p> MySQL  InnoDB  MySQL </p>\n<h2 id=\"InnoDB-\"><a href=\"#InnoDB-\" class=\"headerlink\" title=\"InnoDB \"></a>InnoDB </h2><p> InnoDB InnoDB  B+  B+ </p>\n<p> InnoDB  B+  ID  k k </p>\n<p> R1~R5  (ID,k)  (100,1)(200,2)(300,3)(500,5)  (600,6)<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648177404439-962473ed-5691-4733-977e-7e121ac1f8e2.png#averageHue=%23f2f1eb&clientId=ub38593e9-da58-4&from=paste&id=ua47e1a1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=302521&status=done&style=none&taskId=u9f6a80ce-67fa-4e12-ab52-1cb35124172&title=\" alt=\"image.png\"><br> InnoDB <strong></strong>clustered index InnoDB <strong></strong>secondary index</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li> select * from T where ID&#x3D;500 ID  B+ </li>\n<li> select * from T where k&#x3D;5 k  ID  500 ID </li>\n</ul>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>B+  ID  700 R5  ID  400</p>\n<p> R5  B+ </p>\n<p> 50%</p>\n<p></p>\n<p></p>\n<p></p>\n<p> 20  4 bigint 8 </p>\n<p><strong></strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> select ID from T where k between 3 and 5 ID  ID  k  k </p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><strong>B+ </strong></p>\n<p>nameage<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648178687735-90c51b38-d3f9-46aa-8227-852cde96647f.png#averageHue=%23f2f1ea&clientId=ub38593e9-da58-4&from=paste&id=u6826c5cc&originHeight=818&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=289776&status=done&style=none&taskId=uff5cb309-bf12-4c5c-8c3d-d7614291dbb&title=\" alt=\"image.png\"></p>\n<p><code></code></p>\n<p> ID4</p>\n<p> SQL where name like  % ID3</p>\n<p> N <strong> M </strong></p>\n<p><strong></strong></p>\n<p> (a,b)  a <strong></strong></p>\n<p> ab  b  (a,b)  (a,b)(b) </p>\n<p>name  age  name,age)  (age) </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>name, age 10 SQL </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> tuser <span class=\"keyword\">where</span> name <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">and</span> age<span class=\"operator\">=</span><span class=\"number\">10</span> <span class=\"keyword\">and</span> ismale<span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p>  ID3 </p>\n<p><code>(a,b)aab21003150450</code> </p>\n<p> MySQL 5.6  ID3 </p>\n<p> MySQL 5.6  ID3 </p>\n<p> MySQL 5.6 <strong></strong>index condition pushdown) <br>:<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179582601-8505ffa6-926a-4b92-8a9f-76f28a3f3dec.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ubb129163&originHeight=833&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=290640&status=done&style=none&taskId=u3696a908-4b07-4f0b-aaf8-eaeaa6a5005&title=%E6%97%A0%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B\" alt=\"\" title=\"\"><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179640502-b73960eb-e5ca-4c60-b294-026553498c3f.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ue7b7341e&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=289593&status=done&style=none&taskId=u7d11f6c5-1ec1-4daf-9d2c-91219c7d68a&title=%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B\" alt=\"\" title=\"\"><br><br>  (name,age)  age  InnoDB  age name  4 </p>\n<p> InnoDB  (name,age)  age  10 10  ID4ID5  2 </p>\n<h3 id=\"explain\"><a href=\"#explain\" class=\"headerlink\" title=\"explain\"></a>explain</h3><p>selectexplain</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> servers;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> id <span class=\"operator\">|</span> select_type <span class=\"operator\">|</span> <span class=\"keyword\">table</span>   <span class=\"operator\">|</span> type <span class=\"operator\">|</span> possible_keys <span class=\"operator\">|</span> key  <span class=\"operator\">|</span> key_len <span class=\"operator\">|</span> <span class=\"keyword\">ref</span>  <span class=\"operator\">|</span> <span class=\"keyword\">rows</span> <span class=\"operator\">|</span> Extra <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>  <span class=\"number\">1</span> <span class=\"operator\">|</span> SIMPLE      <span class=\"operator\">|</span> servers <span class=\"operator\">|</span> <span class=\"keyword\">ALL</span>  <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>          <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span> <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span> <span class=\"operator\">|</span>    <span class=\"number\">1</span> <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br></pre></td></tr></table></figure>\n<p>type:<br><strong>NULL</strong><br>MySQL<br><strong>constsystem</strong><br>MySQLwhereMySQL,systemconstsystem<br><strong>eq_ref</strong><br>refprimary key unique key<br><strong>ref</strong><br><br><strong>range</strong><br><br>i<strong>ndex</strong><br>Full Index ScanindexALLindex<br><strong>ALL</strong><br>Full Table Scan MySQL</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL ** Flush tables with read lock** (FTWRL)</p>\n<p> select </p>\n<p> FTWRL </p>\n<p> binlog</p>\n<p> mysqldump mysqldump single-transaction  MVCC </p>\n<p> FTWRL  MyISAM  FTWRL </p>\n<p>single-transaction  FTWRL  DBA  InnoDB  MyISAM </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL meta data lockMDL)</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong> lock tables  read&#x2F;write</strong> FTWRL  unlock tables lock tables </p>\n<p>,  A  lock tables t1 read, t2 write;  t1 t2  A  unlock tables  t1 t2  t1 </p>\n<p> InnoDB  lock tables </p>\n<h3 id=\"MDL\"><a href=\"#MDL\" class=\"headerlink\" title=\"MDL\"></a>MDL</h3><p> MDLmetadata lock)MDL MDL </p>\n<p> MySQL 5.5  MDL MDL  MDL </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><code></code><br>(DDL ) DML()</p>\n<p> t <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648189243388-65fe8441-51c7-4a86-bc57-4e15975df962.png#averageHue=%23f0eee7&clientId=ue989aaab-00e7-4&from=paste&id=ubbc20e7c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=286437&status=done&style=none&taskId=u0e1bcf88-be7f-4897-990e-fe397bfb3af&title=\" alt=\"image.png\"> session A  t  MDL  session B  MDL </p>\n<p> session C  blocked session A  MDL  session C  MDL </p>\n<p> session C  t  MDL  session C  MDL </p>\n<p> session <br><code> sessionc   sessionc    block </code></p>\n<p> MDL <br><code></code></p>\n<p><strong></strong><br> MDL  MySQL  information_schema  innodb_trx  DDL  DDL kill </p>\n<p></p>\n<p> kill  alter table  MDL  DBA </p>\n<p>MariaDB  AliSQL  DDL NOWAIT&#x2F;WAIT n<br></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl_name NOWAIT add column ...</span><br><span class=\"line\">ALTER TABLE tbl_name WAIT N add column ...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL  MyISAM InnoDB  MyISAM  InnoDB </p>\n<p> A  B  A </p>\n<p><strong> InnoDB </strong></p>\n<p></p>\n<p><code> </code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648219769688-d2a63c64-b371-44de-871f-06f8f19bf9ca.png#averageHue=%23eeeee3&clientId=u2e8a2ebc-6522-4&from=paste&id=u3244e8e4&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=299114&status=done&style=none&taskId=u44d2fac4-01da-4283-824c-45fb342615b&title=\" alt=\"image.png\"><br> A  B  id&#x3D;2  B  A  id&#x3D;1   A  B </p>\n<ul>\n<li>** innodb_lock_wait_timeout** </li>\n<li> **innodb_deadlock_detect ** on</li>\n</ul>\n<p> InnoDB innodb_lock_wait_timeout  50s 50s  1s</p>\n<p> innodb_deadlock_detect  on</p>\n<p></p>\n<p> O(n)  1000  100  CPU  CPU </p>\n<p>?</p>\n<p><strong></strong></p>\n<p><strong></strong> 10  600  5  3000</p>\n<p><strong></strong> MySQL  MySQL <strong></strong> InnoDB </p>\n<p> 10  10  1&#x2F;10 CPU </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>bug</strong><br> 1 next-key lock<code>next-key lock </code><br> 2<br> 1next-key lock <br> 2next-key lock <br> bug</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `c` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `d` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `c` (`c`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t <span class=\"keyword\">values</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),(<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">10</span>),(<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>),(<span class=\"number\">20</span>,<span class=\"number\">20</span>,<span class=\"number\">20</span>),(<span class=\"number\">25</span>,<span class=\"number\">25</span>,<span class=\"number\">25</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196785720-81dc67d8-9362-460f-8c72-124925f32c83.png#averageHue=%23f9f9f9&clientId=u3a41a891-d6bd-4&from=paste&id=u3fc85d1e&originHeight=462&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=87911&status=done&style=none&taskId=uc6cee32e-a121-46ec-bd29-bc18a18beb1&title=\" alt=\"image.png\"></h3><p> session A  c  c&#x3D;5 </p>\n<ul>\n<li> 1 next-key lock (0,5] next-key lock</li>\n<li> c  c&#x3D;5  c&#x3D;10  2 (5,10] next-key lock</li>\n<li> 2 c&#x3D;5  (5,10)</li>\n<li> 2  session B  update </li>\n</ul>\n<p> session C  (7,7,7)  session A  (5,10) c</p>\n<p>lock in share mode  for update   for update </p>\n<p> lock in share mode  session A  select d from t where c&#x3D;5 lock in share mode</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196929106-7660a1a3-6640-4347-b798-5c4b471bc95b.png#averageHue=%23fafafa&clientId=u3a41a891-d6bd-4&from=paste&id=ua535fe5d&originHeight=313&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=55984&status=done&style=none&taskId=uf85c6652-35de-4ff4-98b8-dd0793c5afe&title=\" alt=\"image.png\"><br> 1 next-key locksession A  (5,10]<br> 2 (id&#x3D;7) id&#x3D;10 next-key lock  (5,10)<br>session B  id&#x3D;8  session C  id&#x3D;10 </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">10</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">&gt;=</span><span class=\"number\">10</span> <span class=\"keyword\">and</span> id<span class=\"operator\">&lt;</span><span class=\"number\">11</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br></pre></td></tr></table></figure>\n<p><br> session A <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650197044039-7a303e5d-1b56-41bc-a529-eb7c6ffecd40.png#averageHue=%23fbfafa&clientId=u3a41a891-d6bd-4&from=paste&id=ub5ac83fc&originHeight=718&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=124356&status=done&style=none&taskId=u0ef12a21-8e64-4984-9f19-cc8fbc4fc53&title=\" alt=\"image.png\"></p>\n<ul>\n<li> id&#x3D;10  next-key lock(5,10]  1  id   id&#x3D;10 </li>\n<li> id&#x3D;15  next-key lock(10,15]</li>\n</ul>\n<p>session A  id&#x3D;10  next-key lock(10,15]session B  session C </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>insert</strong><strong> deleteupdate</strong></p>\n<p><strong></strong><br><code>select for updateselect in share mode</code></p>\n<p><strong></strong><br><code>a ,  ,10, 10, b, a. , a, a, , 11... .</code></p>\n<hr>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `c` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `d` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `c` (`c`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t <span class=\"keyword\">values</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),(<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">10</span>),(<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>),(<span class=\"number\">20</span>,<span class=\"number\">20</span>,<span class=\"number\">20</span>),(<span class=\"number\">25</span>,<span class=\"number\">25</span>,<span class=\"number\">25</span>);</span><br></pre></td></tr></table></figure>\n<p>InnoDB  (Gap Lock)<br>5(id 0510152025) 7 <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1649992660264-65dd581d-b5b9-4976-8485-8772530f2194.png#averageHue=%23f4f2ed&clientId=u0e71056a-b30e-4&from=paste&id=Kt72W&originHeight=550&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=76936&status=done&style=none&taskId=u94793186-c86f-4978-bdda-8140978c040&title=\" alt=\"image.png\"><br> select * from t where id&#x3D;5 for update 6  7 <br><code> id=1 </code><br><br><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993034198-38b45746-5725-4dde-9da9-98a6171fd13a.png#averageHue=%23fafafa&clientId=u0e71056a-b30e-4&from=paste&id=EM16B&originHeight=154&originWidth=411&originalType=url&ratio=1&rotation=0&showTitle=false&size=12389&status=done&style=none&taskId=ue83bb8ed-a0fa-420d-ba7d-63351017074&title=\" alt=\"image.png\"><br></p>\n<p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993266628-29fe8369-3579-4a77-89e8-cbd0cc4871c4.png#averageHue=%23f9f9f9&clientId=u0e71056a-b30e-4&from=paste&id=lvjx5&originHeight=210&originWidth=946&originalType=url&ratio=1&rotation=0&showTitle=false&size=35886&status=done&style=none&taskId=ufcfa8103-a650-4c06-b4b9-a2b2d3bd682&title=\" alt=\"image.png\"><br>c7  </p>\n<p> next-key lock next-key lock  t  select * from t for update  7  next-key lock (-,0](0,5](5,10](10,15](15,20](20, 25](25, +supremum]</p>\n<p><code> supremum  +InnoDB  supremum</code></p>\n<h1 id=\"Join\"><a href=\"#Join\" class=\"headerlink\" title=\"Join\"></a>Join</h1><h2 id=\"NLJ\"><a href=\"#NLJ\" class=\"headerlink\" title=\"NLJ\"></a>NLJ</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t2` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `a` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `b` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `a` (`a`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> t1 <span class=\"keyword\">like</span> t2;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650953541569-e9649522-4b4b-48c8-a1f7-4b2031bd1563.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u90881f8f&originHeight=163&originWidth=1394&originalType=url&ratio=1&rotation=0&showTitle=false&size=31471&status=done&style=none&taskId=ua6df17c9-4a06-4638-95b5-21c16652669&title=\" alt=\"image.png\"><br></p>\n<ol>\n<li> t1  R</li>\n<li> R  a  t2 </li>\n<li> t2  R </li>\n<li> 1  3 t1 </li>\n</ol>\n<p>Index Nested-Loop Join NLJ<br><strong> join </strong></p>\n<h2 id=\"BNL\"><a href=\"#BNL\" class=\"headerlink\" title=\"BNL\"></a>BNL</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t1 straight_join t2 <span class=\"keyword\">on</span> (t1.a<span class=\"operator\">=</span>t2.b);</span><br></pre></td></tr></table></figure>\n<p><br><code>Block Nested-Loop Join BNL</code></p>\n<ol>\n<li> t1  join_buffer  select * t1 </li>\n<li> t2 t2  join_buffer  join </li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954146426-5e868fc8-9ad5-4b5f-b757-c2f09ada4833.png#averageHue=%23edeee5&clientId=u9f841287-a109-4&from=paste&id=uf584d183&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=209296&status=done&style=none&taskId=ue49e250b-56bf-4280-b030-62a5d419e01&title=\" alt=\"image.png\"><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954156660-9fdff866-3e36-4a30-8565-51856356f1fc.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u996c909a&originHeight=164&originWidth=1763&originalType=url&ratio=1&rotation=0&showTitle=false&size=35157&status=done&style=none&taskId=u0c33c4a8-b702-4f8c-9f31-70491336d60&title=\" alt=\"image.png\"><br> t1  t2  1100 join_buffer  t2  100 100*1000&#x3D;10 <br>?</p>\n<p> N M M+N M*N<br>NM</p>\n<p>join_buffert1mysql<strong></strong><br> join_buffer<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954434057-b82dcdd6-f89a-42cb-b067-9c45e777e1ac.png#averageHue=%23ebece1&clientId=u9f841287-a109-4&from=paste&id=u2a584d0a&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=291462&status=done&style=none&taskId=u8f432b2f-13dd-47a2-9beb-2f0043323ed&title=\" alt=\"image.png\"><br> 4  5 join_buffer </p>\n<p> N K  M K N  K  K *N (0,1)</p>\n<p> N+<em>N</em>M N*M  <br>join_buffer_sizejoin_buffer_size  join  join_buffer_size </p>\n<p><strong> join </strong></p>\n<h2 id=\"BKA\"><a href=\"#BKA\" class=\"headerlink\" title=\"BKA\"></a>BKA</h2><p>Batched Key Access(BKA)NLJ</p>\n<p><code>Multi-Range Read  (MRR)</code></p>\n<p>NLJ  t1 a  t2  join t2 MRR  t2  t1  t2</p>\n<p> t1  join_buffer</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650955774308-bf38ea60-0d50-4b0b-a3da-cbd9b6a031eb.png#averageHue=%23dae2cf&clientId=u9f841287-a109-4&from=paste&id=u1b2c7b3b&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=143155&status=done&style=none&taskId=uec77b0b5-13d3-42fb-969d-134a255c2b9&title=\" alt=\"image.png\"></p>\n<p> join_buffer  P1<del>P100 join buffer  P1</del>P100  100 </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> optimizer_switch<span class=\"operator\">=</span><span class=\"string\">&#x27;mrr=on,mrr_cost_based=off,batched_key_access=on&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p> MRRBKA  MRR</p>\n<h1 id=\"InnoDB--Memory-\"><a href=\"#InnoDB--Memory-\" class=\"headerlink\" title=\"InnoDB  Memory \"></a>InnoDB  Memory </h1><p>InnoDB  idIndex Organizied Table<br> Memory Heap Organizied Table</p>\n<p>:</p>\n<ol>\n<li>InnoDB </li>\n<li>InnoDB </li>\n<li>InnoDB </li>\n<li>InnoDB </li>\n<li>InnoDB  Blob  Text  varchar(N) char(N)</li>\n</ol>\n<p><br> Memory  hash </p>\n<p><br></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>  </p>\n<p></p>\n<p></p>\n<p>InnoDB  InnoDB  16KB</p>\n<p> k&#x3D;5 </p>\n<p></p>\n<h3 id=\"change-buffer\"><a href=\"#change-buffer\" class=\"headerlink\" title=\"change buffer\"></a>change buffer</h3><p>InnoDB  change buffer  change buffer </p>\n<p> change bufferchange buffer <br><code>change buffer ibdata1change bufferredo logibdata1</code></p>\n<p> change buffer  merge merge  mergeshutdown merge </p>\n<p> (4,400)  k&#x3D;4  change buffer </p>\n<p>change buffer  buffer pool change buffer  innodb_change_buffer_max_size  50  change buffer  buffer pool  50%<br><code>Buffer Pool  innodb_buffer_pool_size Buffer Pool </code></p>\n<p><br>InnoDB </p>\n<ul>\n<li></li>\n<li> </li>\n</ul>\n<p>InnoDB </p>\n<ul>\n<li></li>\n<li> change buffer</li>\n</ul>\n<p> IO change buffer </p>\n<p> change buffer </p>\n<p> merge  change buffer  merge change buffer </p>\n<p> change buffer </p>\n<p> change buffer merge  IO  change buffer change buffer </p>\n<p></p>\n<p> change bufferchange buffer </p>\n<h3 id=\"change-buffer--redo-log\"><a href=\"#change-buffer--redo-log\" class=\"headerlink\" title=\"change buffer  redo log\"></a>change buffer  redo log</h3><p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t(id,k) <span class=\"keyword\">values</span>(id1,k1),(id2,k2);</span><br></pre></td></tr></table></figure>\n<p>k1  (InnoDB buffer pool) k2 <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448480028-98b82840-60c9-4dec-a9da-fa2e7f384d1e.png#averageHue=%23a7bc99&clientId=ubdd7c6a3-1836-4&from=paste&id=u386044d6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=523388&status=done&style=none&taskId=udf24454a-a8ef-49b0-b750-fc23cf86083&title=\" alt=\"image.png\"><br></p>\n<ol>\n<li>Page 1 </li>\n<li>Page 2  change buffer  Page 2 </li>\n<li> redo log  3  4</li>\n</ol>\n<p></p>\n<p></p>\n<p> select * from t where k in (k1, k2)<br><code>ibdata1 redo logib_log_fileX</code><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448593841-dadf2d65-6d2f-4a8f-b8ed-6e5fa1737979.png#averageHue=%23bfcdb3&clientId=ubdd7c6a3-1836-4&from=paste&id=u55f462e7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=382614&status=done&style=none&taskId=u1afa9e5d-34f7-4de8-8b10-99e34853198&title=\" alt=\"image.png\"><br> Page 1 WAL  redo log </p>\n<p> Page 2  Page 2  change buffer merge</p>\n<p> Page 2 </p>\n<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><p> SQL  MySQL \t<br><code>mysqlmysqlserver</code></p>\n<p> CPU </p>\n<p></p>\n<p>MySQL </p>\n<p>cardinality</p>\n<p> show index <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648454396086-286835f4-56a0-4855-bbdb-929959b8897c.png#averageHue=%23090109&clientId=ubdd7c6a3-1836-4&from=paste&id=u25bc3d64&originHeight=209&originWidth=1850&originalType=url&ratio=1&rotation=0&showTitle=false&size=42815&status=done&style=none&taskId=uac7e024d-d508-470a-9a49-13b6181534f&title=\" alt=\"image.png\"></p>\n<p>MySQL  MySQL </p>\n<p>InnoDB  N </p>\n<p> 1&#x2F;M </p>\n<p> MySQL  innodb_stats_persistent <br> on  N  20M  10<br> off  N  8M  16</p>\n<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><p> SQL </p>\n<p>InnoDB  redo log redo log </p>\n<p></p>\n<p></p>\n<p> MySQL flush</p>\n<p><strong> flush </strong></p>\n<ol>\n<li>InnoDB  redo log  checkpoint redo log </li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648456454734-b1c65cc5-a2d1-474b-95f6-935db1efad7a.png#averageHue=%23f3f0ea&clientId=u6601b37f-239d-4&from=paste&id=X7cS6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=255505&status=done&style=none&taskId=ued0fa08d-ba43-47ee-949d-335a83988ba&title=\" alt=\"image.png\"><br><code>checkpoint  checkpoint  CP  CP flush  write pos  CP redo log </code></p>\n<ol start=\"2\">\n<li></li>\n<li>MySQL </li>\n<li>MySQL MySQL  flush  MySQL </li>\n</ol>\n<p>InnoDB </p>\n<p></p>\n<p></p>\n<ul>\n<li></li>\n<li> 0</li>\n</ul>\n<p>InnoDB </p>\n<h3 id=\"InnoDB-\"><a href=\"#InnoDB-\" class=\"headerlink\" title=\"InnoDB \"></a>InnoDB </h3><p>innodb_io_capacity  InnoDB  IOPS IOPS  fio </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest </span><br></pre></td></tr></table></figure>\n<p><strong>InnoDB  redo log </strong></p>\n<p>InnoDB </p>\n<p> innodb_max_dirty_pages_pct  75%InnoDB  M 0  100 (F1(M))</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F1(M)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  if M<span class=\"operator\">&gt;=</span>innodb_max_dirty_pages_pct <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">100</span><span class=\"operator\">*</span>M<span class=\"operator\">/</span>innodb_max_dirty_pages_pct;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>InnoDB  checkpoint  NInnoDB  N  0  100  F2(N)F2(N)  N </p>\n<p> F1(M)  F2(N)  R innodb_io_capacity  R% </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648457335769-b4d029f5-e5db-49f4-afac-8d4da16e3500.png#averageHue=%23edefe4&clientId=u6601b37f-239d-4&from=paste&id=uf9222f00&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u86033bb8-9020-4268-a3f2-4bffcba8a75&title=\" alt=\"image.png\"><br> 75%</p>\n<p> Innodb_buffer_pool_pages_dirty&#x2F;Innodb_buffer_pool_pages_total </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@a</span> <span class=\"keyword\">from</span> global_status <span class=\"keyword\">where</span> VARIABLE_NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_buffer_pool_pages_dirty&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@b</span> <span class=\"keyword\">from</span> global_status <span class=\"keyword\">where</span> VARIABLE_NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_buffer_pool_pages_total&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@a</span><span class=\"operator\">/</span><span class=\"variable\">@b</span>;</span><br></pre></td></tr></table></figure>\n\n<p> flush  MySQL </p>\n<p> InnoDB innodb_flush_neighbors  1  0 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-innodb-file-per-table\"><a href=\"#-innodb-file-per-table\" class=\"headerlink\" title=\" innodb_file_per_table\"></a> innodb_file_per_table</h3><p> innodb_file_per_table </p>\n<ul>\n<li> OFF </li>\n<li> ON  InnoDB  .ibd </li>\n</ul>\n<p> MySQL 5.6.6  ON </p>\n<p> drop table \t</p>\n<p> innodb_file_per_table  ON</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648458246901-2059df42-0c96-480b-ab06-32e2de24bf39.png#averageHue=%23f1f1eb&clientId=u6601b37f-239d-4&from=paste&id=u60cc30d7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=125104&status=done&style=none&taskId=uea35a2b3-8b62-4c81-996a-89295f00942&title=\" alt=\"image.png\"><br> R4 InnoDB  R4  ID  300  600  ()</p>\n<p>R4  ID  400  ID  800 </p>\n<p> B+   page A page A  ID&#x3D;50 page A </p>\n<p></p>\n<p> delete </p>\n<p>delete  delete </p>\n<p></p>\n<p><br> page A <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648459031612-11d73511-84fb-4435-a36c-041513621a6e.png#averageHue=%23ecece4&clientId=u6601b37f-239d-4&from=paste&id=ub5d91120&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386541&status=done&style=none&taskId=u936777ff-9e33-4869-a5d0-ec6cc0b8295&title=\" alt=\"image.png\"><br> page A  ID  550  page B page A  1 </p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> A</p>\n<p> A  B ID  A  B </p>\n<p> B  A  B  B  B  A  B  B  A A </p>\n<p> <strong>alter table A engine&#x3D;InnoDB</strong>  MySQL 5.5  B MySQL </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460656185-14aee1dd-885c-47b2-a030-28ea6ec8cb57.png#averageHue=%23eae9df&clientId=u6601b37f-239d-4&from=paste&id=u9c4de8a8&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=514037&status=done&style=none&taskId=uc61ce6a1-1af4-40f9-a3aa-94c8c8cbb13&title=\" alt=\"image.png\"></p>\n<p> A  DDL  A  DDL  Online </p>\n<p><strong> MySQL 5.6  Online DDL</strong></p>\n<p> Online DDL </p>\n<ol>\n<li> A </li>\n<li> A  B+ </li>\n<li> A row log state2 </li>\n<li> A  state3 </li>\n<li> A </li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460673335-4500620b-e333-4439-8366-d2f4c69765aa.png#averageHue=%23e8e8dd&clientId=u6601b37f-239d-4&from=paste&id=u53977a6f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=397982&status=done&style=none&taskId=u68a17300-301c-4350-b4ff-8913ac7b306&title=\" alt=\"image.png\"><br><code>Online DDL MDL, MDLMDLOnline MDL</code></p>\n<h2 id=\"count-\"><a href=\"#count-\" class=\"headerlink\" title=\"count(*)\"></a>count(*)</h2><h3 id=\"count-\"><a href=\"#count-\" class=\"headerlink\" title=\"count(*) \"></a>count(*) </h3><ul>\n<li>MyISAM  count(*) </li>\n<li> InnoDB  count(*) </li>\n</ul>\n<p><code>MyISAM count whereInnoDB</code></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648518819244-17e71729-17f5-41d0-af7f-c120ae34b61d.png#averageHue=%23f9f9f9&clientId=ue5c9d5d3-f062-4&from=paste&id=u1d9077ed&originHeight=362&originWidth=943&originalType=url&ratio=1&rotation=0&showTitle=false&size=68577&status=done&style=none&taskId=u52029278-5cd6-4933-bd23-f236702007c&title=\" alt=\"image.png\"><br> InnoDB  MVCC  count(*) InnoDB </p>\n<p>InnoDB  count(*) <strong>MySQL </strong></p>\n<h3 id=\"-count-\"><a href=\"#-count-\" class=\"headerlink\" title=\" count \"></a> count </h3><p>count()  count  NULL 1</p>\n<p>count(*)count( id)  count(1)  count( NULL </p>\n<p><strong> count( id) </strong>InnoDB  id  server server  id </p>\n<p><strong> count(1) </strong>InnoDB <strong></strong>server 1</p>\n<p>count(1)  count( id)  id </p>\n<p><strong> count() </strong> not null  null<br> null null null </p>\n<p><strong> count(*) </strong>count(*)  null</p>\n<p><strong>count()&lt;count( id)&lt;count(1)count(*)</strong></p>\n<h2 id=\"order-by\"><a href=\"#order-by\" class=\"headerlink\" title=\"order by\"></a>order by</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> city,name,age <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> city<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> name limit <span class=\"number\">1000</span>  ;(city)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563803148-12d05c2e-862d-41a3-92cc-079081c02eec.png#averageHue=%2305040e&clientId=ub49b8c3b-28e5-4&from=paste&id=u51b876bf&originHeight=126&originWidth=1470&originalType=url&ratio=1&rotation=0&showTitle=false&size=275103&status=done&style=none&taskId=u04ab12bb-161a-4189-8085-6ff37e68c53&title=\" alt=\"image.png\"><br>Extra Using filesortMySQL  sort_buffer<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563889459-6771ce6b-40c0-43fe-b195-d8b4fd06dba4.png#averageHue=%23f1f0ea&clientId=ub49b8c3b-28e5-4&from=paste&id=u5ad65b3c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=244167&status=done&style=none&taskId=u4687b797-6402-426d-b26f-c616d1dcf1f&title=\" alt=\"image.png\"><br> city&#x3D; ID_X  ID_(X+N) <br> </p>\n<ol>\n<li> sort_buffer namecityage </li>\n<li> city  city&#x3D; id ID_X</li>\n<li> id  namecityage  sort_buffer </li>\n<li> city  id</li>\n<li> 34  city  id  ID_Y</li>\n<li> sort_buffer  name </li>\n<li> 1000 </li>\n</ol>\n<p> name  sort_buffer_size</p>\n<p>sort_buffer_size MySQL sort_buffer sort_buffer_size</p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* optimizer_trace */</span></span><br><span class=\"line\"><span class=\"keyword\">SET</span> optimizer_trace<span class=\"operator\">=</span><span class=\"string\">&#x27;enabled=on&#x27;</span>; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* @aInnodb_rows_read */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@a</span> <span class=\"keyword\">from</span>  performance_schema.session_status <span class=\"keyword\">where</span> variable_name <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_rows_read&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*  */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> city, name,age <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> city<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> name limit <span class=\"number\">1000</span>; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*  OPTIMIZER_TRACE  */</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `information_schema`.`OPTIMIZER_TRACE`\\G</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* @bInnodb_rows_read */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@b</span> <span class=\"keyword\">from</span> performance_schema.session_status <span class=\"keyword\">where</span> variable_name <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_rows_read&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* Innodb_rows_read */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@b</span><span class=\"operator\">-</span><span class=\"variable\">@a</span>;</span><br></pre></td></tr></table></figure>\n<p> OPTIMIZER_TRACE  number_of_tmp_files <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648564689820-6f0d8fa4-6687-4e4f-ad20-5e6a1d4a1280.png#averageHue=%23090109&clientId=ub49b8c3b-28e5-4&from=paste&id=ud81073ab&originHeight=183&originWidth=713&originalType=url&ratio=1&rotation=0&showTitle=false&size=103799&status=done&style=none&taskId=ufc87cf83-e1f6-4102-90a8-7243ba19e13&title=\" alt=\"image.png\"><br>number_of_tmp_files  12 MySQL  12  12 </p>\n<p> sort_buffer_size number_of_tmp_files  0</p>\n<p><strong>sort_buffer_size </strong>number_of_tmp_files sort_buffer_sizesort_buffer_size</p>\n<p><strong>examined_rows&#x3D;4000 4000 </strong></p>\n<p><strong>sort_mode  packed_additional_fields  name  varchar(16)</strong></p>\n<p><strong> select @b-@a  4000 4000 </strong></p>\n<h3 id=\"rowid-\"><a href=\"#rowid-\" class=\"headerlink\" title=\"rowid \"></a>rowid </h3><p> sort_buffer <strong> sort_buffer </strong></p>\n<p></p>\n<p> MySQL ?</p>\n<p> MySQL </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> max_length_for_sort_data <span class=\"operator\">=</span> <span class=\"number\">16</span>;</span><br></pre></td></tr></table></figure>\n<p>MySQL MySQL </p>\n<p> sort_buffer  name  id</p>\n<p> city  age </p>\n<ol>\n<li> sort_buffer name  id</li>\n<li> city  city&#x3D; id ID_X</li>\n<li> id  nameid  sort_buffer </li>\n<li> city  id</li>\n<li> 34  city&#x3D; ID_Y</li>\n<li> sort_buffer  name </li>\n<li> 1000  id  cityname  age </li>\n</ol>\n<p>rowid  t  7</p>\n<p> MySQL  sort_buffer  id cityname  age <code></code></p>\n<p><strong>rowid  OPTIMIZER_TRACE </strong><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566128890-cf3076d8-183b-4f66-95fb-6db07943954f.png#averageHue=%23080109&clientId=ub49b8c3b-28e5-4&from=paste&id=u025fd973&originHeight=183&originWidth=468&originalType=url&ratio=1&rotation=0&showTitle=false&size=93232&status=done&style=none&taskId=uaae4be2c-c501-4cc6-b296-5a9fed1e59a&title=\" alt=\"image.png\"><br><strong>select @b-@a  5000 </strong> id  limit 1000 1000 </p>\n<p><strong>sort_mode  &lt;sort_key, rowid&gt;</strong> name  id </p>\n<p><strong>number_of_tmp_files  10 </strong> 4000 </p>\n<p> MySQL  rowid </p>\n<p> MySQL  sort_buffer </p>\n<p> MySQL <strong></strong></p>\n<p> order by MySQL <strong></strong></p>\n<p> city  name </p>\n<p> city  name <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566346093-471e3c9b-0b83-4c38-95cd-1c6b5d7f58ca.png#averageHue=%23f0efe8&clientId=ub49b8c3b-28e5-4&from=paste&id=u9d957077&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=250929&status=done&style=none&taskId=ub68238d3-09db-4d04-9d04-8aa7a1bb945&title=\" alt=\"image.png\"><br> city&#x3D; city name </p>\n<p></p>\n<ol>\n<li> (city,name)  city&#x3D; id</li>\n<li> id  namecityage </li>\n<li> (city,name)  id 23</li>\n<li> 1000  city&#x3D;</li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566428823-b2716a19-cb2c-48a4-a0ad-94552cf1ae7d.png#averageHue=%2307020a&clientId=ub49b8c3b-28e5-4&from=paste&id=u30022e94&originHeight=127&originWidth=1382&originalType=url&ratio=1&rotation=0&showTitle=true&size=250223&status=done&style=none&taskId=u72da902c-04e1-462b-87e2-4c65adca397&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\" alt=\" (city,name) \" title=\" (city,name) \"><br><code>rows,Using index condition ICP</code> </p>\n<p>Extra  Using filesort  (city,name)  4000  1000 <strong> 1000 </strong></p>\n<p> cityname  age </p>\n<p> cit\ty  name </p>\n<ol>\n<li> (city,name,age)  city&#x3D; cityname  age </li>\n<li> (city,name,age) </li>\n<li> 2 1000  city&#x3D;</li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566612447-97a4f6c2-8f67-4a0b-8614-eb63ab8093aa.png#averageHue=%2306030d&clientId=ub49b8c3b-28e5-4&from=paste&id=ufc70bd2c&originHeight=125&originWidth=1586&originalType=url&ratio=1&rotation=0&showTitle=true&size=266076&status=done&style=none&taskId=u3093dc9d-f32b-4b81-b102-2d08dd4fe1b&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%2Cage%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\" alt=\" (city,name,age) \" title=\" (city,name,age) \">Extra Using index</p>\n<h2 id=\"order-by-rand\"><a href=\"#order-by-rand\" class=\"headerlink\" title=\"order by rand()\"></a>order by rand()</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> word <span class=\"keyword\">from</span> words <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> rand() limit <span class=\"number\">3</span>;</span><br></pre></td></tr></table></figure>\n<p> 3  SQL </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648802439889-2e2907be-5fc4-411a-b79f-f9a29153b597.png#averageHue=%2308020a&clientId=ud645e606-5915-4&from=paste&id=u14caa359&originHeight=142&originWidth=1553&originalType=url&ratio=1&rotation=0&showTitle=false&size=269434&status=done&style=none&taskId=uc50316d7-c136-4ce7-92d6-3c16c7a8496&title=\" alt=\"image.png\"><br>Extra  Using temporaryUsing filesort</p>\n<p> InnoDB <br>MySQL  rowid </p>\n<p>:</p>\n<ol>\n<li> memory  double  R varchar(64)  W</li>\n<li> words  word  word  rand()  0  1  word  R  W  10000</li>\n<li> 10000  R </li>\n<li> sort_buffersort_buffer  double </li>\n<li> R  sort_buffer  10000 20000</li>\n<li> sort_buffer  R </li>\n<li> word  20003</li>\n</ol>\n<p> InnoDB  6  rowid rowid  InnoDB  rowid  ID InnoDB  rowid MEMORY  rowid </p>\n<p><strong>order by rand()  rowid </strong></p>\n<p><strong></strong></p>\n<p>**tmp_table_size ** 16M tmp_table_size</p>\n<p> InnoDB <strong>internal_tmp_disk_storage_engine</strong> <br> InnoDB </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> SQL  R  3  rowid 3  10000  9997 </p>\n<p><code></code></p>\n<ul>\n<li> 10000  (R,rowid)</li>\n<li> (R,rowid) R  R R (R,rowid)  (R,rowid)</li>\n<li> 2  10000  (R,rowid) </li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> city,name,age <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> city<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> name limit <span class=\"number\">1000</span>  ;</span><br></pre></td></tr></table></figure>\n<p> limit SQL  limit 1000 1000  (name,rowid) sort_buffer_size <code>limit 3 sort_buffer_size </code></p>\n<h2 id=\"group-by\"><a href=\"#group-by\" class=\"headerlink\" title=\"group by\"></a>group by</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> t1(id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key, a <span class=\"type\">int</span>, b <span class=\"type\">int</span>, index(a));</span><br><span class=\"line\">delimiter ;;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> idata()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  <span class=\"keyword\">declare</span> i <span class=\"type\">int</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">set</span> i<span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br><span class=\"line\">  while(i<span class=\"operator\">&lt;=</span><span class=\"number\">1000</span>)do</span><br><span class=\"line\">    <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t1 <span class=\"keyword\">values</span>(i, i, i);</span><br><span class=\"line\">    <span class=\"keyword\">set</span> i<span class=\"operator\">=</span>i<span class=\"operator\">+</span><span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">end</span> while;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;;</span><br><span class=\"line\">delimiter ;</span><br><span class=\"line\"><span class=\"keyword\">call</span> idata();</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id<span class=\"operator\">%</span><span class=\"number\">10</span> <span class=\"keyword\">as</span> m, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> c <span class=\"keyword\">from</span> t1 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> m;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112503277-b1df9ad1-1d95-417a-b8e9-48a390770a29.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=ua744d424&originHeight=143&originWidth=1702&originalType=url&ratio=1&rotation=0&showTitle=false&size=30065&status=done&style=none&taskId=u53a60222-d9e4-44f3-a5c7-c090d7a9176&title=\" alt=\"image.png\"><br> Extra </p>\n<ul>\n<li>Using index a</li>\n</ul>\n<p><code>selectidaa  mysqla</code></p>\n<ul>\n<li>Using temporary</li>\n<li>Using filesort</li>\n</ul>\n<p>:</p>\n<ul>\n<li> m  c m</li>\n<li> t1  a id  id%10  x</li>\n<li> x  (x,1);</li>\n<li> x  x  c  1 m </li>\n</ul>\n<h3 id=\"group-by---\"><a href=\"#group-by---\" class=\"headerlink\" title=\"group by   \"></a><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112629688-9b998014-3798-4028-931b-9518eb10ce2a.png#averageHue=%23eceee3&clientId=ud1598026-e3a9-4&from=paste&id=u878ce08e&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=184375&status=done&style=none&taskId=ub60c1c98-b904-4010-937c-eea5dfc94e9&title=\" alt=\"image.png\">group by   </h3><p>group by  group by </p>\n<p><strong> group by </strong><br>group by  id%100 </p>\n<p><br>group by </p>\n<h3 id=\"group-by---\"><a href=\"#group-by---\" class=\"headerlink\" title=\"group by   \"></a>group by   </h3><p> group by  group by </p>\n<p> group by  SQL_BIG_RESULT hint</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> SQL_BIG_RESULT id<span class=\"operator\">%</span><span class=\"number\">100</span> <span class=\"keyword\">as</span> m, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> c <span class=\"keyword\">from</span> t1 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> m;</span><br></pre></td></tr></table></figure>\n<p>MySQL  B+ <br></p>\n<ul>\n<li> sort_buffer m</li>\n<li> t1  a id ,  id%100  sort_buffer </li>\n<li> sort_buffer  m  sort_buffer </li>\n<li></li>\n</ul>\n<p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113519486-bb3649d2-8c16-4e6a-8062-50510591e8a6.png#averageHue=%23ecede2&clientId=ud1598026-e3a9-4&from=paste&id=u6443cf73&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=210067&status=done&style=none&taskId=u0c92938c-024f-4ede-8a67-6aa3e16f37b&title=\" alt=\"image.png\"><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113533494-091befc2-665e-42da-a822-2fa5fc25cb92.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=u68823f55&originHeight=131&originWidth=1393&originalType=url&ratio=1&rotation=0&showTitle=false&size=26738&status=done&style=none&taskId=u04fcce2b-a93b-4148-a3cf-bb5c45ac1b9&title=\" alt=\"image.png\"><br> Extra <br><strong> group by  tmp_table_size </strong></p>\n<h3 id=\"MySQL-\"><a href=\"#MySQL-\" class=\"headerlink\" title=\"MySQL \"></a>MySQL </h3><ol>\n<li></li>\n<li>join_buffer sort_buffer </li>\n<li>union  group by </li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> tradelog <span class=\"keyword\">where</span> <span class=\"keyword\">month</span>(t_modified)<span class=\"operator\">=</span><span class=\"number\">7</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">t_modified</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>sql MySQL <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822518074-948569d9-c7f4-49f5-9441-51b175a23451.png#averageHue=%23f0f1e8&clientId=ud5261830-7282-4&from=paste&id=ua20d9e1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=191123&status=done&style=none&taskId=u64ba332a-9084-4148-a92a-ecdce1abbba&title=t_modified%20%E7%B4%A2%E5%BC%95%E7%A4%BA%E6%84%8F%E5%9B%BE\" alt=\"t_modified \" title=\"t_modified \"><br> SQL  where t_modified&#x3D;2018-7-1 t_modified&#x3D;2018-7-1<br><strong> month()  7 </strong></p>\n<p><strong></strong><br></p>\n<p> t_modified t_modified  t_modified\t\t</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822684575-4deb9a96-f251-4f0c-a536-19871141453c.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=u523bd677&originHeight=143&originWidth=1637&originalType=url&ratio=1&rotation=0&showTitle=true&size=30107&status=done&style=none&taskId=u05bb406e-1cdf-4bce-933e-d07153bbc8c&title=explain%E7%BB%93%E6%9E%9C\" alt=\"explain\" title=\"explain\"><br><code> select * from tradelog where id + 1 = 10000  SQL  1  MySQL  id  9999  SQL  where id = 10000 -1 </code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> tradelog <span class=\"keyword\">where</span> tradeid<span class=\"operator\">=</span><span class=\"number\">110717</span>;</span><br><span class=\"line\">tradeid</span><br><span class=\"line\">tradeid  <span class=\"type\">varchar</span>(<span class=\"number\">32</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">tradelog </span><br></pre></td></tr></table></figure>\n<p>explain <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648823298719-44df7f75-794e-4dc6-ac68-e1be2aee1bf7.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=uf55b0bbd&originHeight=142&originWidth=289&originalType=url&ratio=1&rotation=0&showTitle=false&size=6704&status=done&style=none&taskId=u73751b53-f437-460b-90a1-85cdf341157&title=\" alt=\"image.png\"><br>select 10 &gt; 9  1 MySQL  MySQL <br><code>ascii 101ascii90</code></p>\n<p>sql</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> tradelog <span class=\"keyword\">where</span>  <span class=\"built_in\">CAST</span>(tradid <span class=\"keyword\">AS</span> signed <span class=\"type\">int</span>) <span class=\"operator\">=</span> <span class=\"number\">110717</span>;</span><br></pre></td></tr></table></figure>\n<p></p>\n<h2 id=\"select-\"><a href=\"#select-\" class=\"headerlink\" title=\"select \"></a>select </h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p> t  show processlist </p>\n<h3 id=\"MDL\"><a href=\"#MDL\" class=\"headerlink\" title=\"MDL\"></a>MDL</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878603446-1b67ed04-aa0f-4961-bdb2-c048db08684d.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=u6b91757f&originHeight=213&originWidth=1312&originalType=url&ratio=1&rotation=0&showTitle=true&size=295984&status=done&style=none&taskId=ua6b64a57-39e2-4f8b-a20b-acb19d0de19&title=Waiting%20for%20table%20metadata%20lock\" alt=\"Waiting for table metadata lock\" title=\"Waiting for table metadata lock\"><br> t  MDL  select </p>\n<p> show processlist session A  Command Sleep performance_schema  sys MySQL  performance_schema&#x3D;on off  10% )</p>\n<p> <strong>sys.schema_table_lock_waits</strong>  process id kill <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878943676-cb1e66f6-9274-4266-8aa5-3473ff341e1b.png#averageHue=%23f7f7f7&clientId=u9da0f65c-5a8c-4&from=paste&id=ud724efe0&originHeight=251&originWidth=940&originalType=url&ratio=1&rotation=0&showTitle=false&size=83355&status=done&style=none&taskId=u8346b506-65e9-42ee-b198-0ecd2158dde&title=\" alt=\"image.png\"></p>\n<h3 id=\"flush\"><a href=\"#flush\" class=\"headerlink\" title=\"flush\"></a>flush</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648879417166-43881340-f096-4563-b5e4-9bc5829cc62b.png#averageHue=%2308010a&clientId=u9da0f65c-5a8c-4&from=paste&id=u25a60694&originHeight=147&originWidth=1221&originalType=url&ratio=1&rotation=0&showTitle=true&size=221669&status=done&style=none&taskId=u5a5b1b06-1adc-4505-9c55-cfed57c8142&title=Waiting%20for%20table%20flush\" alt=\"Waiting for table flush\" title=\"Waiting for table flush\"><br> t  flush MySQL  flush </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flush tables t <span class=\"keyword\">with</span> read lock;</span><br><span class=\"line\">flush tables <span class=\"keyword\">with</span> read lock;</span><br></pre></td></tr></table></figure>\n<p> flush  t  t MySQL </p>\n<p></p>\n<p> Waiting for table flush  flush tables  select <br> flush</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> lock <span class=\"keyword\">in</span> share mode;</span><br></pre></td></tr></table></figure>\n<p> id&#x3D;1  select </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648881044186-e94acc20-7f4a-4b13-8ce4-9f73b9518af8.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=uc3a1df43&originHeight=223&originWidth=1285&originalType=url&ratio=1&rotation=0&showTitle=false&size=291379&status=done&style=none&taskId=u1c9e4b89-2356-43cb-aef5-c8285c293e0&title=\" alt=\"image.png\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t sys.innodb_lock_waits <span class=\"keyword\">where</span> locked_table<span class=\"operator\">=</span><span class=\"string\">&#x27;`test`.`t`&#x27;</span>\\G</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883270487-dab3c3c5-e153-4d52-a60a-71f1fe51fcea.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=ued0ab6db&originHeight=669&originWidth=864&originalType=url&ratio=1&rotation=0&showTitle=true&size=580038&status=done&style=none&taskId=u3b80a197-9c94-402c-937a-19cb179068a&title=%E9%80%9A%E8%BF%87%20sys.innodb_lock_waits%20%E6%9F%A5%E8%A1%8C%E9%94%81\" alt=\" sys.innodb_lock_waits \" title=\" sys.innodb_lock_waits \">4  KILL QUERY 4  KILL 4KILL QUERY 4 4  update  KILL QUERY id&#x3D;1 </p>\n<p>KILL 4  id&#x3D;1 </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span>   <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> lock <span class=\"keyword\">in</span> share mode  <span class=\"number\">1000001</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883585247-7e59dcec-0278-410b-82ab-1025272a021c.png#averageHue=%23f9f9f9&clientId=u9da0f65c-5a8c-4&from=paste&id=udaac8027&originHeight=322&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=52745&status=done&style=none&taskId=udb5dcded-28c0-407c-becc-849e1a9f50d&title=\" alt=\"image.png\"><br>sessionBsessionAsessionBundo log<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883707434-705f7d40-60d4-4ffa-8029-406518fe2664.png#averageHue=%23edefe3&clientId=u9da0f65c-5a8c-4&from=paste&id=uccb7b493&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=215323&status=done&style=none&taskId=u3ead1e96-17fc-4831-b8f7-da92f1c225f&title=%E7%AC%AC%E4%B8%80%E4%B8%AAselect%E9%9C%80%E8%A6%81%E5%9B%9E%E6%BB%9A100w%E6%AC%A1%E6%89%8D%E8%83%BD%E5%B0%86%E8%BF%99%E4%B8%AA%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E\" alt=\"select100w\" title=\"select100w\"><code> lock in share mode  SQL  1000001 </code><br><code>undo log  2  1 3  2</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h2>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"sql\"><a href=\"#sql\" class=\"headerlink\" title=\"sql\"></a>sql</h1><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648093341473-68f1e895-bb41-45cb-9b0e-cb0d7797a3e7.png#averageHue=%23ecefe2&clientId=ub35db475-a524-4&from=paste&id=ub86e15fd&originHeight=1440&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=true&size=609051&status=done&style=none&taskId=udd5444c6-42b3-4ee3-b7f0-c6b67a2ffc1&title=Mysql%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84%E5%9B%BE\" alt=\"Mysql\" title=\"Mysql\"><br>MySQL  Server </p>\n<p>Server  MySQL </p>\n<p> InnoDBMyISAMMemory  InnoDB MySQL 5.5.5 </p>\n<p> create table  InnoDB create table  engine&#x3D;memory, </p>\n<p> Server </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">-</span>h$ip <span class=\"operator\">-</span>P$port <span class=\"operator\">-</span>u$<span class=\"keyword\">user</span> <span class=\"operator\">-</span>p</span><br></pre></td></tr></table></figure>\n<p> -p </p>\n<p> mysql  TCP </p>\n<ul>\n<li><strong>Access denied for user</strong></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p> show processlist  show processlist  Command Sleep<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648100906726-b843b434-66a0-4c16-923d-149c872f5402.png#averageHue=%23060208&clientId=ub35db475-a524-4&from=paste&id=uec2e5d2a&originHeight=163&originWidth=875&originalType=url&ratio=1&rotation=0&showTitle=false&size=27260&status=done&style=none&taskId=u34b2b0d5-b675-4b6c-a3b8-99d595321e3&title=\" alt=\"image.png\"><br> <strong>wait_timeout <strong> 8 </strong> Lost connection to MySQL server during query</strong></p>\n<p></p>\n<p></p>\n<p> MySQL  MySQL OOM MySQL </p>\n<p></p>\n<ul>\n<li></li>\n<li> MySQL 5.7 mysql_reset_connection </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> select </p>\n<p>MySQL  key-value key value  key value </p>\n<p>MySQL </p>\n<p><strong></strong></p>\n<p></p>\n<p> MySQL  <strong>query_cache_type</strong>  DEMAND SQL  SQL_CACHE </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> SQL_CACHE <span class=\"operator\">*</span> <span class=\"keyword\">from</span> T <span class=\"keyword\">where</span> ID<span class=\"operator\">=</span><span class=\"number\">10</span></span><br></pre></td></tr></table></figure>\n<p>MySQL 8.0  8.0 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL  SQL </p>\n<p>MySQL  SQL </p>\n<p> SQL MySQL </p>\n<p>MySQL selectT TID ID</p>\n<p> SQL  MySQL <strong>You have an error in your SQL syntax</strong> select s</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL </p>\n<p>join</p>\n<p> join</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t1 <span class=\"keyword\">join</span> t2 <span class=\"keyword\">using</span>(ID) <span class=\"keyword\">where</span> t1.c<span class=\"operator\">=</span><span class=\"number\">10</span> <span class=\"keyword\">and</span> t2.d<span class=\"operator\">=</span><span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li> t1  c&#x3D;10  ID  ID  t2 t2  d  20</li>\n<li> t2  d&#x3D;20  ID  ID  t1 t1  c  10</li>\n</ul>\n<p></p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL </p>\n<p> T  ( precheck )</p>\n<p></p>\n<p> T ID </p>\n<ul>\n<li> InnoDB  ID  10</li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<p></p>\n<p> rows_examined </p>\n<p> rows_examined </p>\n<p>mysqlserviceinnodb<br>service<br>mysqltcp(8)  mysql</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>DMLinsert,update,delete,create redo log()  binlog() </code></p>\n<h2 id=\"redo-log\"><a href=\"#redo-log\" class=\"headerlink\" title=\"redo log\"></a>redo log</h2><h3 id=\"WAL\"><a href=\"#WAL\" class=\"headerlink\" title=\"WAL\"></a>WAL</h3><p><strong>MySQL  WAL WAL  Write-Ahead Logging</strong><br> MySQL  IO </p>\n<p>InnoDB InnoDB </p>\n<p><code>redo logioredo log </code><br><code>WAL IO   IO  redo log.</code></p>\n<p>InnoDB  redo log  4  1GB 4GB <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648108055998-29f22c92-5ea3-442e-9fdc-a5bb73578294.png#averageHue=%23f3f0e9&clientId=ub35db475-a524-4&from=paste&id=ub0653dee&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=230615&status=done&style=none&taskId=u4fa0be29-3fc3-491d-8a98-4028c4e8501&title=\" alt=\"image.png\">write pos  3  0 checkpoint </p>\n<p>write pos  checkpoint  write pos  checkpoint<strong></strong> checkpoint </p>\n<p> redo logInnoDB  <strong>crash-safe</strong><br><code>redo log  InnoDBInnoDB InnoDB redo log() crash-safe mysql</code></p>\n<p>** redo log  redo log  **</p>\n<h3 id=\"redo-log-\"><a href=\"#redo-log-\" class=\"headerlink\" title=\"redo log \"></a>redo log </h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877429762-363312e7-1539-40de-9cab-ac46d3c8e06c.png#averageHue=%23ecebd6&clientId=u84cf85c6-a1db-4&from=paste&id=ue760740b&originHeight=639&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=59527&status=done&style=none&taskId=ubb09edc4-d7a5-47b0-80c5-4fa65d36482&title=MySQL%20redo%20log%20%E5%AD%98%E5%82%A8%E7%8A%B6%E6%80%81\" alt=\"MySQL redo log \" title=\"MySQL redo log \"><br></p>\n<ol>\n<li> redo log buffer  MySQL </li>\n<li> (write)fsync) page cache </li>\n<li> hard disk</li>\n</ol>\n<p> redo log buffer wirte  page cache <br> redo log InnoDB  <strong>innodb_flush_log_at_trx_commit</strong> </p>\n<ol>\n<li> 0  redo log  redo log buffer  ;</li>\n<li> 1  redo log </li>\n<li> 2  redo log  page cache</li>\n</ol>\n<p>InnoDB  1  redo log buffer  write  page cache fsync <br><code>binlogbinlogbinlog cacheredo logredo log buffer</code><br> redo log  redo log buffer  redo log <strong> redo log</strong></p>\n<p> redo log </p>\n<ol>\n<li>redo log buffer  innodb_log_buffer_size  write fsync page cache<code>innodb_log_buffer_size  innodb , 8MB</code></li>\n<li> redo log buffer  A  redo log  buffer  B  innodb_flush_log_at_trx_commit  1 B  redo log buffer  A  redo log buffer </li>\n</ol>\n<p><code> innodb_flush_log_at_trx_commit  1 redo log  prepare </code></p>\n<p> MySQL  1 sync_binlog  innodb_flush_log_at_trx_commit  1 redo logprepare  binlog</p>\n<h2 id=\"binlog\"><a href=\"#binlog\" class=\"headerlink\" title=\"binlog\"></a>binlog</h2><p>MySQL  Server  MySQL ,redo log  InnoDB  Server  binlog</p>\n<p> MySQL  InnoDB MySQL  MyISAM MyISAM  crash-safe binlog  InnoDB  MySQL  binlog  crash-safe  InnoDB  redo log  crash-safe <br><code>binlogcrashbinlog,binlogredologcheck pointwrite pos (write poscheck point)redolog</code><br><code>redo log  binlog  redo log  redo log binlog   crash  redo log  binlog binlog  binlog  innoDB </code></p>\n<p></p>\n<ul>\n<li>redo log  InnoDB binlog  MySQL  Server </li>\n<li>redo log binlog  ID&#x3D;2  c  1 </li>\n<li>redo log binlog  binlog </li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> InnoDB  update </p>\n<ol>\n<li> ID&#x3D;2 ID  ID&#x3D;2 </li>\n<li> 1 N N+1</li>\n<li> redo log  redo log  prepare </li>\n<li> binlog binlog </li>\n<li> redo log commit</li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648113221297-708a4029-be16-4b31-9538-1ef82cece307.png#averageHue=%23ecede2&clientId=ub35db475-a524-4&from=paste&height=487&id=eROFt&originHeight=731&originWidth=513&originalType=binary&ratio=1&rotation=0&showTitle=false&size=149649&status=done&style=none&taskId=u1d9c41ee-c839-4ec7-a5e3-d67f8b6c729&title=&width=342\" alt=\"image.png\"><br> redo log prepare  commit<br> redo log  binlog  redo log  binlog</p>\n<p> update  ID&#x3D;2  c  0 update  crash</p>\n<p><strong> redo log  binlog</strong> redo log binlog MySQL redo log  c  1 binlog  crash  binlog  binlog  binlog  binlog  c  0</p>\n<p><strong> binlog  redo log</strong> binlog  crash redo log  c  0 binlog  c  0  1 binlog  c  1</p>\n<p></p>\n<p></p>\n<p> binlog redo log  binlog </p>\n<p>Binlogstatement sql row</p>\n<p><strong>MySQL </strong><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650437373196-5ae1790e-1e28-4526-992e-88a474a8fc80.png#averageHue=%23edeee2&clientId=u52eb2620-e685-4&from=paste&id=uc6cedb1d&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=634267&status=done&style=none&taskId=u44f064d3-65b6-4987-b3a8-796c757e343&title=\" alt=\"image.png\"><br>1 A  redo log  prepare  binlog crash binlog redo log binlog <br>2 B binlog redo log  commit  crash MySQL </p>\n<ul>\n<li> redo log  commit </li>\n<li> redo log  prepare binlog <ul>\n<li>a. </li>\n<li>b. </li>\n</ul>\n</li>\n</ul>\n<h3 id=\"binlog\"><a href=\"#binlog\" class=\"headerlink\" title=\"binlog\"></a>binlog</h3><h4 id=\"statement\"><a href=\"#statement\" class=\"headerlink\" title=\"statement\"></a>statement</h4><p> binlog_format&#x3D;statement binlog  SQL </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">delete</span> <span class=\"keyword\">from</span> t <span class=\"comment\">/*comment*/</span>  <span class=\"keyword\">where</span> a<span class=\"operator\">&gt;=</span><span class=\"number\">4</span> <span class=\"keyword\">and</span> t_modified<span class=\"operator\">&lt;=</span><span class=\"string\">&#x27;2018-11-10&#x27;</span> limit <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">show</span> binlog events <span class=\"keyword\">in</span> <span class=\"string\">&#x27;master.000001&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876306414-ef659638-160f-4294-86c2-1bedf9932b53.png#averageHue=%23090109&clientId=u84cf85c6-a1db-4&from=paste&id=u0bed92d0&originHeight=213&originWidth=1882&originalType=url&ratio=1&rotation=0&showTitle=false&size=43916&status=done&style=none&taskId=u7696b2bc-d028-4672-b728-7d0c514bfb8&title=\" alt=\"image.png\"><br> BEGIN commit </p>\n<p> delete use test MySQL  test  t</p>\n<h4 id=\"row\"><a href=\"#row\" class=\"headerlink\" title=\"row\"></a>row</h4><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650876481808-6f610fff-712f-4e13-8dba-b32366c53c42.png#averageHue=%23050207&clientId=u84cf85c6-a1db-4&from=paste&id=u2fbfb767&originHeight=533&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=false&size=419977&status=done&style=none&taskId=u21be3baf-c2b0-4a03-99c2-b2487712508&title=\" alt=\"image.png\"><br> statement  binlog  BEGIN  COMMIT row  binlog  SQL  eventTable_map  Delete_rows</p>\n<p>Table_map event test  t;Delete_rows event<br> binlog_format  row binlog  id binlog  id&#x3D;4 </p>\n<h4 id=\"mixed\"><a href=\"#mixed\" class=\"headerlink\" title=\"mixed\"></a>mixed</h4><p> statement  binlog  row  row  delete  10  statement  SQL  binlog  row  binlog 10  binlog  binlog  IO MySQL  mixed  binlogmixed MySQL  SQL  row  statement </p>\n<h3 id=\"binlog-\"><a href=\"#binlog-\" class=\"headerlink\" title=\"binlog \"></a>binlog </h3><p>binlog  binlog cache binlog cache  binlog </p>\n<p> binlog  binlog cache </p>\n<p> binlog cache  binlog_cache_size  binlog cache </p>\n<p> binlog cache  binlog  binlog cache</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877216791-c4eec49b-0149-4260-8ae2-1faf6b27731e.png#averageHue=%23a1bd8c&clientId=u84cf85c6-a1db-4&from=paste&id=ucd5cd72c&originHeight=748&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=350828&status=done&style=none&taskId=u7be45086-e9e1-4fca-905f-58cd27461ae&title=\" alt=\"image.png\"><br> binlog cache binlog </p>\n<p> write page cache<br> fsync fsync  IOPS<br>write  fsync  <strong>sync_binlog</strong> </p>\n<p>sync_binlog&#x3D;0  write fsyncsync_binlog&#x3D;1  fsyncsync_binlog&#x3D;N(N&gt;1)  write N  fsync</p>\n<p> IO  sync_binlog  0 100~1000  sync_binlog  N N  binlog </p>\n<h2 id=\"redo-log--binlog-\"><a href=\"#redo-log--binlog-\" class=\"headerlink\" title=\"redo log  binlog ?\"></a>redo log  binlog ?</h2><p> XID redo log prepare commit  redo log<br> parepare commit  redo log XID  binlog <br>binlog</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"LSN\"><a href=\"#LSN\" class=\"headerlink\" title=\"LSN\"></a>LSN</h3><p>log sequence numberLSN<br>LSN  redo log  length  redo log LSN  length</p>\n<p>LSN  InnoDB  redo log<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650877956349-248ca201-d6c2-43a0-ac70-ae7d4c7bce0a.png#averageHue=%23e3e3bf&clientId=u84cf85c6-a1db-4&from=paste&id=ud19e5689&originHeight=2171&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=398351&status=done&style=none&taskId=u4a4d4116-61f8-48a7-bbdb-764b0f1ad4c&title=\" alt=\"image.png\"><br>trx1  leader trx1  LSN  160trx1  LSN&#x3D;160 trx1  LSN  160  redo log trx2  trx3 </p>\n<p> redo log buffer  fsync  IOPS </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650878105681-14abb035-6107-418a-b237-a148a90f3feb.png#averageHue=%23f1f2e9&clientId=u84cf85c6-a1db-4&from=paste&id=u3fd2b35f&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=210196&status=done&style=none&taskId=u794cd052-0d6a-467a-8b8e-ad30ca66b63&title=%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4%E7%BB%86%E5%8C%96\" alt=\"\" title=\"\"><br> binlog  <strong>binlog_group_commit_sync_delay</strong>  <strong>binlog_group_commit_sync_no_delay_count</strong> <br><strong>binlog_group_commit_sync_delay</strong>  fsync;<br><strong>binlog_group_commit_sync_no_delay_count</strong>  fsync</p>\n<p><strong>WAL  redo log  binlog?</strong></p>\n<ul>\n<li>redo log  binlog </li>\n<li> IOPS </li>\n</ul>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong></strong><br></p>\n<ol>\n<li>innoDBredo log checkpoint redo log checkPoint flushredologredolog</li>\n<li></li>\n<li>mysql</li>\n<li>mysql</li>\n</ol>\n<p>redolog</p>\n<p>InnoDB <strong>buffer pool</strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>i**nnodb_io_capacity ** InnoDB ,IOPS<br><code>IOPS:Input/Output Operations Per Second,(I/O)</code></p>\n<p>InnoDB  redo log </p>\n<p>** innodb_max_dirty_pages_pct**  75%InnoDB  M 0  100  F1(M)</p>\n<p>redolog,InnoDB  checkpoint  NInnoDB  N  0  100  F2N</p>\n<p> F1(M)  F2(N)  R innodb_io_capacity  R% <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650436507824-2065113f-bb0b-4c48-ae9b-c90c853b9f70.png#averageHue=%23edefe4&clientId=u52eb2620-e685-4&from=paste&id=ud0ac7cf8&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u467db1e5-c649-40bd-9c85-90a5b6a7636&title=\" alt=\"image.png\"></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> MySQL MySQL  MySQL  MyISAM  MyISAM  InnoDB </p>\n<p><strong> ACIDAtomicityConsistencyIsolationDurability</strong><br><strong>:</strong><br><strong>:</strong><br><strong>:</strong><br><strong>:redoLog+binlog</strong></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>dirty readnon-repeatable readphantom read</p>\n<p><strong></strong>SQL read uncommittedread committedrepeatable readserializable </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p> T  1<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648114969737-ca2280ec-d1d7-403f-ab13-926f1dfe3d99.png#averageHue=%23f2f1ed&clientId=ub35db475-a524-4&from=paste&id=u3d4fa0c4&originHeight=1420&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386590&status=done&style=none&taskId=u2cf5b523-30d0-40be-8854-8517eb9d974&title=\" alt=\"image.png\"><br> A  V1V2V3 </p>\n<p>  V1  2 B  A V2V3  2</p>\n<p> V1  1V2  2 B  A  V3  2</p>\n<p> V1V2  1V3  2 V2  1<strong></strong></p>\n<p> B  1  2 A  B  A  V1V2  1V3  2</p>\n<p><strong></strong> SQL </p>\n<p>Oracle  Oracle  MySQL  MySQL (mysql )</p>\n<p>** transaction-isolation** ** READ-COMMITTED** show variables </p>\n<p><strong></strong><br></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p> MySQL  1  234<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648115713483-7e04eee4-1941-44e6-a4e7-f56490fefa37.png#averageHue=%23f2f1eb&clientId=ub35db475-a524-4&from=paste&id=ubed388d6&originHeight=737&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=248434&status=done&style=none&taskId=u190e6fc5-52a1-48d9-8607-953b27a477b&title=\" alt=\"image.png\"><br> 4 read-view ABC  124MVCC read-view A 1</p>\n<p> 4  5 read-view ABC </p>\n<p> read-view </p>\n<p></p>\n<p><strong></strong></p>\n<p><code>RRread-view,</code></p>\n<p> MySQL 5.5  ibdata  20GB 200GB </p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p>MySQL  begin  start transaction commit rollbackset autocommit&#x3D;0 select </p>\n<p> commit  rollback </p>\n<p> set autocommit&#x3D;0  set autocommit&#x3D;1, </p>\n<p> begin</p>\n<p> commit work and chain  autocommit  1  begin  commit  commit work and chain begin </p>\n<p></p>\n<p> information_schema  innodb_trx  60s </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> information_schema.innodb_trx <span class=\"keyword\">where</span> TIME_TO_SEC(timediff(now(),trx_started))<span class=\"operator\">&gt;</span><span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> MySQL <br> view create view  <br> InnoDB  MVCC  <strong>consistent read view</strong> RCRead Committed RRRepeatable Read</p>\n<p></p>\n<p>InnoDB  ID transaction id<strong></strong> InnoDB </p>\n<p><strong></strong> transaction id  ID row trx_id (row) row trx_id</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648431114419-7ad7fe30-7e51-44e9-83e8-381a4139a59c.png#averageHue=%23edefe4&clientId=ubdd7c6a3-1836-4&from=paste&id=u1f4cd4e2&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=349597&status=done&style=none&taskId=u6a2056db-3401-4df7-ae8f-e23a3b4608c&title=%E5%9B%BE1%3A%E8%AE%B0%E5%BD%95%E8%A2%AB%E5%A4%9A%E4%B8%AA%E4%BA%8B%E5%8A%A1%E8%BF%9E%E7%BB%AD%E6%9B%B4%E6%96%B0%E5%90%8E%E7%9A%84%E7%8A%B6%E6%80%81%E3%80%82\" alt=\"1:\" title=\"1:\"><br> 4  V4k  22 transaction id  25  row trx_id  25</p>\n<p> <strong>undo log</strong> V1V2V3  undo log  V2  V4  U3U2 </p>\n<p></p>\n<p><br><code>Undo Logs</code></p>\n<p></p>\n<p>** InnoDB ** ID<br><code>trx_id</code></p>\n<p> ID  ID  1 </p>\n<p>read-view row trx_id </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648433319988-54447ac9-f2d7-442a-9fdf-d94d9a2584ba.png#averageHue=%23f4efe8&clientId=ubdd7c6a3-1836-4&from=paste&id=u2ff698cc&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=146395&status=done&style=none&taskId=u159b7bfa-f7ad-40c3-a9c8-151a3a6cb32&title=\" alt=\"image.png\"><br><strong></strong> row trx_id</p>\n<ol>\n<li></li>\n<li></li>\n<li><ul>\n<li> row trx_id </li>\n<li> row trx_id </li>\n</ul>\n</li>\n</ol>\n<p><code>IDID[1,2,3,5]41-54</code><br><code>id 99100102104105id 101103 99</code><br><code>**ABAB ABBA**</code></p>\n<p> <strong>InnoDB </strong></p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `k` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t(id, k) <span class=\"keyword\">values</span>(<span class=\"number\">1</span>,<span class=\"number\">1</span>),(<span class=\"number\">2</span>,<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436642991-cb96c42e-1d75-451f-8bfe-da1fe5ce2c8d.png#averageHue=%23fafafa&clientId=ubdd7c6a3-1836-4&from=paste&id=u88640d3b&originHeight=509&originWidth=910&originalType=url&ratio=1&rotation=0&showTitle=false&size=77588&status=done&style=none&taskId=ua2ee9126-6b57-46ec-8113-c6447e13318&title=\" alt=\"image.png\"><br>begin&#x2F;start transaction  InnoDB ** start transaction with consistent snapshot** <br><br> start transaction with consistent snapshot </p>\n<p><br> A  ID  99<br> ABC  100101102<br>(1,1 row trx_id  90<br> A [99,100],  B [99,100,101],  C [99,100,101,102]<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648436831411-e1b8b943-71ac-4b16-90d6-cdc022316d02.png#averageHue=%23bbcaae&clientId=ubdd7c6a3-1836-4&from=paste&id=uf77228b9&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=389463&status=done&style=none&taskId=ucfa9e2d6-3e31-4da4-8fb4-27f1046d8bb&title=\" alt=\"image.png\"><br><code>A102102AA2(cA)</code></p>\n<p> C (1,1)  (1,2) row trx_id  102 90 </p>\n<p> B (1,2)  (1,3) row trx_id 101 102 <br><code></code></p>\n<p> A [99,100] A </p>\n<ul>\n<li> (1,3)  row trx_id&#x3D;101()</li>\n<li> row trx_id&#x3D;102</li>\n<li>1,1) row trx_id&#x3D;90</li>\n</ul>\n<p> A </p>\n<p><strong> B  update </strong><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648438902227-33dfff5b-7752-42f9-ae8f-4ba54824af5b.png#averageHue=%23c2d0b7&clientId=ubdd7c6a3-1836-4&from=paste&id=u29cc65f6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=181203&status=done&style=none&taskId=ubc0f1fa8-0770-462c-a1c2-f5bf051a302&title=\" alt=\"image.png\"><br> B  C  (1,2)  (1,3) <br> B  k  1</p>\n<p><strong>current read</strong><br><code>CBCB  CBCB</code></p>\n<p> (1,2) (1,3) row trx_id  101</p>\n<p> B  101 101 k  3</p>\n<p> update select </p>\n<p> A  select * from t where id&#x3D;1  <strong>lock in share mode</strong>  <strong>for update</strong> 101  k  3 select S <strong></strong>X <strong></strong><br><code></code><br><code></code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> k <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> lock <span class=\"keyword\">in</span> share mode;</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> k <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br></pre></td></tr></table></figure>\n\n<p> C  C\t\t\t<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439136431-4b35da83-71d7-4f2e-aacc-34b0b870f86b.png#averageHue=%23f9f9f9&clientId=ubdd7c6a3-1836-4&from=paste&id=u555af770&originHeight=565&originWidth=906&originalType=url&ratio=1&rotation=0&showTitle=false&size=90942&status=done&style=none&taskId=u257c13bb-7de7-4653-ae0c-08c330e0e8d&title=\" alt=\"image.png\"><br> C B  C (1,2)  B </p>\n<p> C (1,2)  B <strong></strong><strong></strong> C<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439181432-b5b054ed-4f67-44a5-b6a0-63dfd27c5fe5.png#averageHue=%23c1cfb6&clientId=ubdd7c6a3-1836-4&from=paste&id=u28580c0d&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=337234&status=done&style=none&taskId=u654b2065-2bcb-4bfc-9b0f-587f4f74d55&title=\" alt=\"image.png\"></p>\n<p><strong>consistent read</strong></p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p> A  B  k<br><code>start transaction with consistent snapshot;  start transaction</code></p>\n<p> read view  C  C<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648439281611-5d682321-af61-48bc-87f1-c12fcaf0b6ae.png#averageHue=%23a0b792&clientId=ubdd7c6a3-1836-4&from=paste&id=u3133d187&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=534050&status=done&style=none&taskId=u99b6227f-1384-4887-a71b-d08f6a30f1b&title=\" alt=\"image.png\"></p>\n<p> A  (1,2)(1,3) (1,3) (1,2)  <br> A  k&#x3D;2<br> B  k&#x3D;3</p>\n<p> row trx_id</p>\n<p>MySQL 8.0  InnoDB </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> 500 </p>\n<p><code>   +  </code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> - key-value key Value key  value </p>\n<p> key </p>\n<p></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172350141-1148f1ae-5357-4246-9e55-df37b38e9a0c.png#averageHue=%23ebede1&clientId=ub38593e9-da58-4&from=paste&id=u711c2508&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=394076&status=done&style=none&taskId=ue30f032e-37eb-4230-8d4b-9bab7ebb4ed&title=\" alt=\"image.png\"><br>User2  User4  N ID_card_n2  ID_card_n2  N User2</p>\n<p> ID_card_n  User <strong></strong></p>\n<p>[ID_card_X, ID_card_Y]</p>\n<p> Memcached  NoSQL </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648172988285-612ee6fd-9e8e-40e7-9548-c8f73834f70f.png#averageHue=%23eff0e7&clientId=ub38593e9-da58-4&from=paste&id=u523f9001&originHeight=787&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=261326&status=done&style=none&taskId=u52aeb952-9eaa-40a9-9029-3f108f01bad&title=\" alt=\"image.png\"><br> ID_card_n2  O(log(N))</p>\n<p>[ID_card_X, ID_card_Y] User ID_card_X ID_card_X ID_card_X  User ID_card_Y </p>\n<p></p>\n<p> 2017 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648173122656-422a42b5-a1f1-4d77-bc75-06766e296dff.png#averageHue=%23edeee5&clientId=ub38593e9-da58-4&from=paste&id=ue2441f8f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=445439&status=done&style=none&taskId=u5719c66d-7877-4064-a4df-e1c3f17715c&title=\" alt=\"image.png\"><br> ID_card_n2  UserA -&gt; UserC -&gt; UserF -&gt; User2  O(log(N))</p>\n<p> O(log(N))  O(log(N))</p>\n<p></p>\n<p> 100  20 20  10 ms  100  20  10 ms </p>\n<p>N N N</p>\n<p> InnoDB  N  1200 4  1200  3  17  10  3 </p>\n<p> MySQL  InnoDB  MySQL </p>\n<h2 id=\"InnoDB-\"><a href=\"#InnoDB-\" class=\"headerlink\" title=\"InnoDB \"></a>InnoDB </h2><p> InnoDB InnoDB  B+  B+ </p>\n<p> InnoDB  B+  ID  k k </p>\n<p> R1~R5  (ID,k)  (100,1)(200,2)(300,3)(500,5)  (600,6)<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648177404439-962473ed-5691-4733-977e-7e121ac1f8e2.png#averageHue=%23f2f1eb&clientId=ub38593e9-da58-4&from=paste&id=ua47e1a1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=302521&status=done&style=none&taskId=u9f6a80ce-67fa-4e12-ab52-1cb35124172&title=\" alt=\"image.png\"><br> InnoDB <strong></strong>clustered index InnoDB <strong></strong>secondary index</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li> select * from T where ID&#x3D;500 ID  B+ </li>\n<li> select * from T where k&#x3D;5 k  ID  500 ID </li>\n</ul>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>B+  ID  700 R5  ID  400</p>\n<p> R5  B+ </p>\n<p> 50%</p>\n<p></p>\n<p></p>\n<p></p>\n<p> 20  4 bigint 8 </p>\n<p><strong></strong></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> select ID from T where k between 3 and 5 ID  ID  k  k </p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><strong>B+ </strong></p>\n<p>nameage<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648178687735-90c51b38-d3f9-46aa-8227-852cde96647f.png#averageHue=%23f2f1ea&clientId=ub38593e9-da58-4&from=paste&id=u6826c5cc&originHeight=818&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=289776&status=done&style=none&taskId=uff5cb309-bf12-4c5c-8c3d-d7614291dbb&title=\" alt=\"image.png\"></p>\n<p><code></code></p>\n<p> ID4</p>\n<p> SQL where name like  % ID3</p>\n<p> N <strong> M </strong></p>\n<p><strong></strong></p>\n<p> (a,b)  a <strong></strong></p>\n<p> ab  b  (a,b)  (a,b)(b) </p>\n<p>name  age  name,age)  (age) </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>name, age 10 SQL </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> tuser <span class=\"keyword\">where</span> name <span class=\"keyword\">like</span> <span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">and</span> age<span class=\"operator\">=</span><span class=\"number\">10</span> <span class=\"keyword\">and</span> ismale<span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p>  ID3 </p>\n<p><code>(a,b)aab21003150450</code> </p>\n<p> MySQL 5.6  ID3 </p>\n<p> MySQL 5.6  ID3 </p>\n<p> MySQL 5.6 <strong></strong>index condition pushdown) <br>:<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179582601-8505ffa6-926a-4b92-8a9f-76f28a3f3dec.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ubb129163&originHeight=833&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=290640&status=done&style=none&taskId=u3696a908-4b07-4f0b-aaf8-eaeaa6a5005&title=%E6%97%A0%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B\" alt=\"\" title=\"\"><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648179640502-b73960eb-e5ca-4c60-b294-026553498c3f.png#averageHue=%23f3f1ed&clientId=ue989aaab-00e7-4&from=paste&id=ue7b7341e&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=289593&status=done&style=none&taskId=u7d11f6c5-1ec1-4daf-9d2c-91219c7d68a&title=%E7%B4%A2%E5%BC%95%E4%B8%8B%E6%8E%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B\" alt=\"\" title=\"\"><br><br>  (name,age)  age  InnoDB  age name  4 </p>\n<p> InnoDB  (name,age)  age  10 10  ID4ID5  2 </p>\n<h3 id=\"explain\"><a href=\"#explain\" class=\"headerlink\" title=\"explain\"></a>explain</h3><p>selectexplain</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> explain <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> servers;</span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span> id <span class=\"operator\">|</span> select_type <span class=\"operator\">|</span> <span class=\"keyword\">table</span>   <span class=\"operator\">|</span> type <span class=\"operator\">|</span> possible_keys <span class=\"operator\">|</span> key  <span class=\"operator\">|</span> key_len <span class=\"operator\">|</span> <span class=\"keyword\">ref</span>  <span class=\"operator\">|</span> <span class=\"keyword\">rows</span> <span class=\"operator\">|</span> Extra <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br><span class=\"line\"><span class=\"operator\">|</span>  <span class=\"number\">1</span> <span class=\"operator\">|</span> SIMPLE      <span class=\"operator\">|</span> servers <span class=\"operator\">|</span> <span class=\"keyword\">ALL</span>  <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>          <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span> <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>    <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span> <span class=\"operator\">|</span>    <span class=\"number\">1</span> <span class=\"operator\">|</span> <span class=\"keyword\">NULL</span>  <span class=\"operator\">|</span></span><br><span class=\"line\"><span class=\"operator\">+</span><span class=\"comment\">----+-------------+---------+------+---------------+------+---------+------+------+-------+</span></span><br></pre></td></tr></table></figure>\n<p>type:<br><strong>NULL</strong><br>MySQL<br><strong>constsystem</strong><br>MySQLwhereMySQL,systemconstsystem<br><strong>eq_ref</strong><br>refprimary key unique key<br><strong>ref</strong><br><br><strong>range</strong><br><br>i<strong>ndex</strong><br>Full Index ScanindexALLindex<br><strong>ALL</strong><br>Full Table Scan MySQL</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL ** Flush tables with read lock** (FTWRL)</p>\n<p> select </p>\n<p> FTWRL </p>\n<p> binlog</p>\n<p> mysqldump mysqldump single-transaction  MVCC </p>\n<p> FTWRL  MyISAM  FTWRL </p>\n<p>single-transaction  FTWRL  DBA  InnoDB  MyISAM </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL meta data lockMDL)</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><strong> lock tables  read&#x2F;write</strong> FTWRL  unlock tables lock tables </p>\n<p>,  A  lock tables t1 read, t2 write;  t1 t2  A  unlock tables  t1 t2  t1 </p>\n<p> InnoDB  lock tables </p>\n<h3 id=\"MDL\"><a href=\"#MDL\" class=\"headerlink\" title=\"MDL\"></a>MDL</h3><p> MDLmetadata lock)MDL MDL </p>\n<p> MySQL 5.5  MDL MDL  MDL </p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p><code></code><br>(DDL ) DML()</p>\n<p> t <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648189243388-65fe8441-51c7-4a86-bc57-4e15975df962.png#averageHue=%23f0eee7&clientId=ue989aaab-00e7-4&from=paste&id=ubbc20e7c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=286437&status=done&style=none&taskId=u0e1bcf88-be7f-4897-990e-fe397bfb3af&title=\" alt=\"image.png\"> session A  t  MDL  session B  MDL </p>\n<p> session C  blocked session A  MDL  session C  MDL </p>\n<p> session C  t  MDL  session C  MDL </p>\n<p> session <br><code> sessionc   sessionc    block </code></p>\n<p> MDL <br><code></code></p>\n<p><strong></strong><br> MDL  MySQL  information_schema  innodb_trx  DDL  DDL kill </p>\n<p></p>\n<p> kill  alter table  MDL  DBA </p>\n<p>MariaDB  AliSQL  DDL NOWAIT&#x2F;WAIT n<br></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE tbl_name NOWAIT add column ...</span><br><span class=\"line\">ALTER TABLE tbl_name WAIT N add column ...</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MySQL  MyISAM InnoDB  MyISAM  InnoDB </p>\n<p> A  B  A </p>\n<p><strong> InnoDB </strong></p>\n<p></p>\n<p><code> </code></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648219769688-d2a63c64-b371-44de-871f-06f8f19bf9ca.png#averageHue=%23eeeee3&clientId=u2e8a2ebc-6522-4&from=paste&id=u3244e8e4&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=299114&status=done&style=none&taskId=u44d2fac4-01da-4283-824c-45fb342615b&title=\" alt=\"image.png\"><br> A  B  id&#x3D;2  B  A  id&#x3D;1   A  B </p>\n<ul>\n<li>** innodb_lock_wait_timeout** </li>\n<li> **innodb_deadlock_detect ** on</li>\n</ul>\n<p> InnoDB innodb_lock_wait_timeout  50s 50s  1s</p>\n<p> innodb_deadlock_detect  on</p>\n<p></p>\n<p> O(n)  1000  100  CPU  CPU </p>\n<p>?</p>\n<p><strong></strong></p>\n<p><strong></strong> 10  600  5  3000</p>\n<p><strong></strong> MySQL  MySQL <strong></strong> InnoDB </p>\n<p> 10  10  1&#x2F;10 CPU </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>bug</strong><br> 1 next-key lock<code>next-key lock </code><br> 2<br> 1next-key lock <br> 2next-key lock <br> bug</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `c` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `d` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `c` (`c`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t <span class=\"keyword\">values</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),(<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">10</span>),(<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>),(<span class=\"number\">20</span>,<span class=\"number\">20</span>,<span class=\"number\">20</span>),(<span class=\"number\">25</span>,<span class=\"number\">25</span>,<span class=\"number\">25</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196785720-81dc67d8-9362-460f-8c72-124925f32c83.png#averageHue=%23f9f9f9&clientId=u3a41a891-d6bd-4&from=paste&id=u3fc85d1e&originHeight=462&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=87911&status=done&style=none&taskId=uc6cee32e-a121-46ec-bd29-bc18a18beb1&title=\" alt=\"image.png\"></h3><p> session A  c  c&#x3D;5 </p>\n<ul>\n<li> 1 next-key lock (0,5] next-key lock</li>\n<li> c  c&#x3D;5  c&#x3D;10  2 (5,10] next-key lock</li>\n<li> 2 c&#x3D;5  (5,10)</li>\n<li> 2  session B  update </li>\n</ul>\n<p> session C  (7,7,7)  session A  (5,10) c</p>\n<p>lock in share mode  for update   for update </p>\n<p> lock in share mode  session A  select d from t where c&#x3D;5 lock in share mode</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650196929106-7660a1a3-6640-4347-b798-5c4b471bc95b.png#averageHue=%23fafafa&clientId=u3a41a891-d6bd-4&from=paste&id=ua535fe5d&originHeight=313&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=55984&status=done&style=none&taskId=uf85c6652-35de-4ff4-98b8-dd0793c5afe&title=\" alt=\"image.png\"><br> 1 next-key locksession A  (5,10]<br> 2 (id&#x3D;7) id&#x3D;10 next-key lock  (5,10)<br>session B  id&#x3D;8  session C  id&#x3D;10 </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">10</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">&gt;=</span><span class=\"number\">10</span> <span class=\"keyword\">and</span> id<span class=\"operator\">&lt;</span><span class=\"number\">11</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br></pre></td></tr></table></figure>\n<p><br> session A <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650197044039-7a303e5d-1b56-41bc-a529-eb7c6ffecd40.png#averageHue=%23fbfafa&clientId=u3a41a891-d6bd-4&from=paste&id=ub5ac83fc&originHeight=718&originWidth=1244&originalType=url&ratio=1&rotation=0&showTitle=false&size=124356&status=done&style=none&taskId=u0ef12a21-8e64-4984-9f19-cc8fbc4fc53&title=\" alt=\"image.png\"></p>\n<ul>\n<li> id&#x3D;10  next-key lock(5,10]  1  id   id&#x3D;10 </li>\n<li> id&#x3D;15  next-key lock(10,15]</li>\n</ul>\n<p>session A  id&#x3D;10  next-key lock(10,15]session B  session C </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><strong>insert</strong><strong> deleteupdate</strong></p>\n<p><strong></strong><br><code>select for updateselect in share mode</code></p>\n<p><strong></strong><br><code>a ,  ,10, 10, b, a. , a, a, , 11... .</code></p>\n<hr>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `c` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `d` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `c` (`c`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t <span class=\"keyword\">values</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>),(<span class=\"number\">5</span>,<span class=\"number\">5</span>,<span class=\"number\">5</span>),</span><br><span class=\"line\">(<span class=\"number\">10</span>,<span class=\"number\">10</span>,<span class=\"number\">10</span>),(<span class=\"number\">15</span>,<span class=\"number\">15</span>,<span class=\"number\">15</span>),(<span class=\"number\">20</span>,<span class=\"number\">20</span>,<span class=\"number\">20</span>),(<span class=\"number\">25</span>,<span class=\"number\">25</span>,<span class=\"number\">25</span>);</span><br></pre></td></tr></table></figure>\n<p>InnoDB  (Gap Lock)<br>5(id 0510152025) 7 <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1649992660264-65dd581d-b5b9-4976-8485-8772530f2194.png#averageHue=%23f4f2ed&clientId=u0e71056a-b30e-4&from=paste&id=Kt72W&originHeight=550&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=76936&status=done&style=none&taskId=u94793186-c86f-4978-bdda-8140978c040&title=\" alt=\"image.png\"><br> select * from t where id&#x3D;5 for update 6  7 <br><code> id=1 </code><br><br><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993034198-38b45746-5725-4dde-9da9-98a6171fd13a.png#averageHue=%23fafafa&clientId=u0e71056a-b30e-4&from=paste&id=EM16B&originHeight=154&originWidth=411&originalType=url&ratio=1&rotation=0&showTitle=false&size=12389&status=done&style=none&taskId=ue83bb8ed-a0fa-420d-ba7d-63351017074&title=\" alt=\"image.png\"><br></p>\n<p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1649993266628-29fe8369-3579-4a77-89e8-cbd0cc4871c4.png#averageHue=%23f9f9f9&clientId=u0e71056a-b30e-4&from=paste&id=lvjx5&originHeight=210&originWidth=946&originalType=url&ratio=1&rotation=0&showTitle=false&size=35886&status=done&style=none&taskId=ufcfa8103-a650-4c06-b4b9-a2b2d3bd682&title=\" alt=\"image.png\"><br>c7  </p>\n<p> next-key lock next-key lock  t  select * from t for update  7  next-key lock (-,0](0,5](5,10](10,15](15,20](20, 25](25, +supremum]</p>\n<p><code> supremum  +InnoDB  supremum</code></p>\n<h1 id=\"Join\"><a href=\"#Join\" class=\"headerlink\" title=\"Join\"></a>Join</h1><h2 id=\"NLJ\"><a href=\"#NLJ\" class=\"headerlink\" title=\"NLJ\"></a>NLJ</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `t2` (</span><br><span class=\"line\">  `id` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `a` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  `b` <span class=\"type\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,</span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`),</span><br><span class=\"line\">  KEY `a` (`a`)</span><br><span class=\"line\">) ENGINE<span class=\"operator\">=</span>InnoDB;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> t1 <span class=\"keyword\">like</span> t2;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650953541569-e9649522-4b4b-48c8-a1f7-4b2031bd1563.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u90881f8f&originHeight=163&originWidth=1394&originalType=url&ratio=1&rotation=0&showTitle=false&size=31471&status=done&style=none&taskId=ua6df17c9-4a06-4638-95b5-21c16652669&title=\" alt=\"image.png\"><br></p>\n<ol>\n<li> t1  R</li>\n<li> R  a  t2 </li>\n<li> t2  R </li>\n<li> 1  3 t1 </li>\n</ol>\n<p>Index Nested-Loop Join NLJ<br><strong> join </strong></p>\n<h2 id=\"BNL\"><a href=\"#BNL\" class=\"headerlink\" title=\"BNL\"></a>BNL</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t1 straight_join t2 <span class=\"keyword\">on</span> (t1.a<span class=\"operator\">=</span>t2.b);</span><br></pre></td></tr></table></figure>\n<p><br><code>Block Nested-Loop Join BNL</code></p>\n<ol>\n<li> t1  join_buffer  select * t1 </li>\n<li> t2 t2  join_buffer  join </li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954146426-5e868fc8-9ad5-4b5f-b757-c2f09ada4833.png#averageHue=%23edeee5&clientId=u9f841287-a109-4&from=paste&id=uf584d183&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=209296&status=done&style=none&taskId=ue49e250b-56bf-4280-b030-62a5d419e01&title=\" alt=\"image.png\"><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954156660-9fdff866-3e36-4a30-8565-51856356f1fc.png#averageHue=%23090109&clientId=u9f841287-a109-4&from=paste&id=u996c909a&originHeight=164&originWidth=1763&originalType=url&ratio=1&rotation=0&showTitle=false&size=35157&status=done&style=none&taskId=u0c33c4a8-b702-4f8c-9f31-70491336d60&title=\" alt=\"image.png\"><br> t1  t2  1100 join_buffer  t2  100 100*1000&#x3D;10 <br>?</p>\n<p> N M M+N M*N<br>NM</p>\n<p>join_buffert1mysql<strong></strong><br> join_buffer<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650954434057-b82dcdd6-f89a-42cb-b067-9c45e777e1ac.png#averageHue=%23ebece1&clientId=u9f841287-a109-4&from=paste&id=u2a584d0a&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=291462&status=done&style=none&taskId=u8f432b2f-13dd-47a2-9beb-2f0043323ed&title=\" alt=\"image.png\"><br> 4  5 join_buffer </p>\n<p> N K  M K N  K  K *N (0,1)</p>\n<p> N+<em>N</em>M N*M  <br>join_buffer_sizejoin_buffer_size  join  join_buffer_size </p>\n<p><strong> join </strong></p>\n<h2 id=\"BKA\"><a href=\"#BKA\" class=\"headerlink\" title=\"BKA\"></a>BKA</h2><p>Batched Key Access(BKA)NLJ</p>\n<p><code>Multi-Range Read  (MRR)</code></p>\n<p>NLJ  t1 a  t2  join t2 MRR  t2  t1  t2</p>\n<p> t1  join_buffer</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1650955774308-bf38ea60-0d50-4b0b-a3da-cbd9b6a031eb.png#averageHue=%23dae2cf&clientId=u9f841287-a109-4&from=paste&id=u1b2c7b3b&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=143155&status=done&style=none&taskId=uec77b0b5-13d3-42fb-969d-134a255c2b9&title=\" alt=\"image.png\"></p>\n<p> join_buffer  P1<del>P100 join buffer  P1</del>P100  100 </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> optimizer_switch<span class=\"operator\">=</span><span class=\"string\">&#x27;mrr=on,mrr_cost_based=off,batched_key_access=on&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p> MRRBKA  MRR</p>\n<h1 id=\"InnoDB--Memory-\"><a href=\"#InnoDB--Memory-\" class=\"headerlink\" title=\"InnoDB  Memory \"></a>InnoDB  Memory </h1><p>InnoDB  idIndex Organizied Table<br> Memory Heap Organizied Table</p>\n<p>:</p>\n<ol>\n<li>InnoDB </li>\n<li>InnoDB </li>\n<li>InnoDB </li>\n<li>InnoDB </li>\n<li>InnoDB  Blob  Text  varchar(N) char(N)</li>\n</ol>\n<p><br> Memory  hash </p>\n<p><br></p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>  </p>\n<p></p>\n<p></p>\n<p>InnoDB  InnoDB  16KB</p>\n<p> k&#x3D;5 </p>\n<p></p>\n<h3 id=\"change-buffer\"><a href=\"#change-buffer\" class=\"headerlink\" title=\"change buffer\"></a>change buffer</h3><p>InnoDB  change buffer  change buffer </p>\n<p> change bufferchange buffer <br><code>change buffer ibdata1change bufferredo logibdata1</code></p>\n<p> change buffer  merge merge  mergeshutdown merge </p>\n<p> (4,400)  k&#x3D;4  change buffer </p>\n<p>change buffer  buffer pool change buffer  innodb_change_buffer_max_size  50  change buffer  buffer pool  50%<br><code>Buffer Pool  innodb_buffer_pool_size Buffer Pool </code></p>\n<p><br>InnoDB </p>\n<ul>\n<li></li>\n<li> </li>\n</ul>\n<p>InnoDB </p>\n<ul>\n<li></li>\n<li> change buffer</li>\n</ul>\n<p> IO change buffer </p>\n<p> change buffer </p>\n<p> merge  change buffer  merge change buffer </p>\n<p> change buffer </p>\n<p> change buffer merge  IO  change buffer change buffer </p>\n<p></p>\n<p> change bufferchange buffer </p>\n<h3 id=\"change-buffer--redo-log\"><a href=\"#change-buffer--redo-log\" class=\"headerlink\" title=\"change buffer  redo log\"></a>change buffer  redo log</h3><p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t(id,k) <span class=\"keyword\">values</span>(id1,k1),(id2,k2);</span><br></pre></td></tr></table></figure>\n<p>k1  (InnoDB buffer pool) k2 <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448480028-98b82840-60c9-4dec-a9da-fa2e7f384d1e.png#averageHue=%23a7bc99&clientId=ubdd7c6a3-1836-4&from=paste&id=u386044d6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=523388&status=done&style=none&taskId=udf24454a-a8ef-49b0-b750-fc23cf86083&title=\" alt=\"image.png\"><br></p>\n<ol>\n<li>Page 1 </li>\n<li>Page 2  change buffer  Page 2 </li>\n<li> redo log  3  4</li>\n</ol>\n<p></p>\n<p></p>\n<p> select * from t where k in (k1, k2)<br><code>ibdata1 redo logib_log_fileX</code><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648448593841-dadf2d65-6d2f-4a8f-b8ed-6e5fa1737979.png#averageHue=%23bfcdb3&clientId=ubdd7c6a3-1836-4&from=paste&id=u55f462e7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=382614&status=done&style=none&taskId=u1afa9e5d-34f7-4de8-8b10-99e34853198&title=\" alt=\"image.png\"><br> Page 1 WAL  redo log </p>\n<p> Page 2  Page 2  change buffer merge</p>\n<p> Page 2 </p>\n<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><p> SQL  MySQL \t<br><code>mysqlmysqlserver</code></p>\n<p> CPU </p>\n<p></p>\n<p>MySQL </p>\n<p>cardinality</p>\n<p> show index <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648454396086-286835f4-56a0-4855-bbdb-929959b8897c.png#averageHue=%23090109&clientId=ubdd7c6a3-1836-4&from=paste&id=u25bc3d64&originHeight=209&originWidth=1850&originalType=url&ratio=1&rotation=0&showTitle=false&size=42815&status=done&style=none&taskId=uac7e024d-d508-470a-9a49-13b6181534f&title=\" alt=\"image.png\"></p>\n<p>MySQL  MySQL </p>\n<p>InnoDB  N </p>\n<p> 1&#x2F;M </p>\n<p> MySQL  innodb_stats_persistent <br> on  N  20M  10<br> off  N  8M  16</p>\n<h2 id=\"MySQL\"><a href=\"#MySQL\" class=\"headerlink\" title=\"MySQL\"></a>MySQL</h2><p> SQL </p>\n<p>InnoDB  redo log redo log </p>\n<p></p>\n<p></p>\n<p> MySQL flush</p>\n<p><strong> flush </strong></p>\n<ol>\n<li>InnoDB  redo log  checkpoint redo log </li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648456454734-b1c65cc5-a2d1-474b-95f6-935db1efad7a.png#averageHue=%23f3f0ea&clientId=u6601b37f-239d-4&from=paste&id=X7cS6&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=255505&status=done&style=none&taskId=ued0fa08d-ba43-47ee-949d-335a83988ba&title=\" alt=\"image.png\"><br><code>checkpoint  checkpoint  CP  CP flush  write pos  CP redo log </code></p>\n<ol start=\"2\">\n<li></li>\n<li>MySQL </li>\n<li>MySQL MySQL  flush  MySQL </li>\n</ol>\n<p>InnoDB </p>\n<p></p>\n<p></p>\n<ul>\n<li></li>\n<li> 0</li>\n</ul>\n<p>InnoDB </p>\n<h3 id=\"InnoDB-\"><a href=\"#InnoDB-\" class=\"headerlink\" title=\"InnoDB \"></a>InnoDB </h3><p>innodb_io_capacity  InnoDB  IOPS IOPS  fio </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest </span><br></pre></td></tr></table></figure>\n<p><strong>InnoDB  redo log </strong></p>\n<p>InnoDB </p>\n<p> innodb_max_dirty_pages_pct  75%InnoDB  M 0  100 (F1(M))</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">F1(M)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  if M<span class=\"operator\">&gt;=</span>innodb_max_dirty_pages_pct <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"number\">100</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">100</span><span class=\"operator\">*</span>M<span class=\"operator\">/</span>innodb_max_dirty_pages_pct;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>InnoDB  checkpoint  NInnoDB  N  0  100  F2(N)F2(N)  N </p>\n<p> F1(M)  F2(N)  R innodb_io_capacity  R% </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648457335769-b4d029f5-e5db-49f4-afac-8d4da16e3500.png#averageHue=%23edefe4&clientId=u6601b37f-239d-4&from=paste&id=uf9222f00&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=435479&status=done&style=none&taskId=u86033bb8-9020-4268-a3f2-4bffcba8a75&title=\" alt=\"image.png\"><br> 75%</p>\n<p> Innodb_buffer_pool_pages_dirty&#x2F;Innodb_buffer_pool_pages_total </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@a</span> <span class=\"keyword\">from</span> global_status <span class=\"keyword\">where</span> VARIABLE_NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_buffer_pool_pages_dirty&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@b</span> <span class=\"keyword\">from</span> global_status <span class=\"keyword\">where</span> VARIABLE_NAME <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_buffer_pool_pages_total&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@a</span><span class=\"operator\">/</span><span class=\"variable\">@b</span>;</span><br></pre></td></tr></table></figure>\n\n<p> flush  MySQL </p>\n<p> InnoDB innodb_flush_neighbors  1  0 </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-innodb-file-per-table\"><a href=\"#-innodb-file-per-table\" class=\"headerlink\" title=\" innodb_file_per_table\"></a> innodb_file_per_table</h3><p> innodb_file_per_table </p>\n<ul>\n<li> OFF </li>\n<li> ON  InnoDB  .ibd </li>\n</ul>\n<p> MySQL 5.6.6  ON </p>\n<p> drop table \t</p>\n<p> innodb_file_per_table  ON</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648458246901-2059df42-0c96-480b-ab06-32e2de24bf39.png#averageHue=%23f1f1eb&clientId=u6601b37f-239d-4&from=paste&id=u60cc30d7&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=125104&status=done&style=none&taskId=uea35a2b3-8b62-4c81-996a-89295f00942&title=\" alt=\"image.png\"><br> R4 InnoDB  R4  ID  300  600  ()</p>\n<p>R4  ID  400  ID  800 </p>\n<p> B+   page A page A  ID&#x3D;50 page A </p>\n<p></p>\n<p> delete </p>\n<p>delete  delete </p>\n<p></p>\n<p><br> page A <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648459031612-11d73511-84fb-4435-a36c-041513621a6e.png#averageHue=%23ecece4&clientId=u6601b37f-239d-4&from=paste&id=ub5d91120&originHeight=1522&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=386541&status=done&style=none&taskId=u936777ff-9e33-4869-a5d0-ec6cc0b8295&title=\" alt=\"image.png\"><br> page A  ID  550  page B page A  1 </p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> A</p>\n<p> A  B ID  A  B </p>\n<p> B  A  B  B  B  A  B  B  A A </p>\n<p> <strong>alter table A engine&#x3D;InnoDB</strong>  MySQL 5.5  B MySQL </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460656185-14aee1dd-885c-47b2-a030-28ea6ec8cb57.png#averageHue=%23eae9df&clientId=u6601b37f-239d-4&from=paste&id=u9c4de8a8&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=514037&status=done&style=none&taskId=uc61ce6a1-1af4-40f9-a3aa-94c8c8cbb13&title=\" alt=\"image.png\"></p>\n<p> A  DDL  A  DDL  Online </p>\n<p><strong> MySQL 5.6  Online DDL</strong></p>\n<p> Online DDL </p>\n<ol>\n<li> A </li>\n<li> A  B+ </li>\n<li> A row log state2 </li>\n<li> A  state3 </li>\n<li> A </li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648460673335-4500620b-e333-4439-8366-d2f4c69765aa.png#averageHue=%23e8e8dd&clientId=u6601b37f-239d-4&from=paste&id=u53977a6f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=397982&status=done&style=none&taskId=u68a17300-301c-4350-b4ff-8913ac7b306&title=\" alt=\"image.png\"><br><code>Online DDL MDL, MDLMDLOnline MDL</code></p>\n<h2 id=\"count-\"><a href=\"#count-\" class=\"headerlink\" title=\"count(*)\"></a>count(*)</h2><h3 id=\"count-\"><a href=\"#count-\" class=\"headerlink\" title=\"count(*) \"></a>count(*) </h3><ul>\n<li>MyISAM  count(*) </li>\n<li> InnoDB  count(*) </li>\n</ul>\n<p><code>MyISAM count whereInnoDB</code></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648518819244-17e71729-17f5-41d0-af7f-c120ae34b61d.png#averageHue=%23f9f9f9&clientId=ue5c9d5d3-f062-4&from=paste&id=u1d9077ed&originHeight=362&originWidth=943&originalType=url&ratio=1&rotation=0&showTitle=false&size=68577&status=done&style=none&taskId=u52029278-5cd6-4933-bd23-f236702007c&title=\" alt=\"image.png\"><br> InnoDB  MVCC  count(*) InnoDB </p>\n<p>InnoDB  count(*) <strong>MySQL </strong></p>\n<h3 id=\"-count-\"><a href=\"#-count-\" class=\"headerlink\" title=\" count \"></a> count </h3><p>count()  count  NULL 1</p>\n<p>count(*)count( id)  count(1)  count( NULL </p>\n<p><strong> count( id) </strong>InnoDB  id  server server  id </p>\n<p><strong> count(1) </strong>InnoDB <strong></strong>server 1</p>\n<p>count(1)  count( id)  id </p>\n<p><strong> count() </strong> not null  null<br> null null null </p>\n<p><strong> count(*) </strong>count(*)  null</p>\n<p><strong>count()&lt;count( id)&lt;count(1)count(*)</strong></p>\n<h2 id=\"order-by\"><a href=\"#order-by\" class=\"headerlink\" title=\"order by\"></a>order by</h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> city,name,age <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> city<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> name limit <span class=\"number\">1000</span>  ;(city)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563803148-12d05c2e-862d-41a3-92cc-079081c02eec.png#averageHue=%2305040e&clientId=ub49b8c3b-28e5-4&from=paste&id=u51b876bf&originHeight=126&originWidth=1470&originalType=url&ratio=1&rotation=0&showTitle=false&size=275103&status=done&style=none&taskId=u04ab12bb-161a-4189-8085-6ff37e68c53&title=\" alt=\"image.png\"><br>Extra Using filesortMySQL  sort_buffer<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648563889459-6771ce6b-40c0-43fe-b195-d8b4fd06dba4.png#averageHue=%23f1f0ea&clientId=ub49b8c3b-28e5-4&from=paste&id=u5ad65b3c&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=244167&status=done&style=none&taskId=u4687b797-6402-426d-b26f-c616d1dcf1f&title=\" alt=\"image.png\"><br> city&#x3D; ID_X  ID_(X+N) <br> </p>\n<ol>\n<li> sort_buffer namecityage </li>\n<li> city  city&#x3D; id ID_X</li>\n<li> id  namecityage  sort_buffer </li>\n<li> city  id</li>\n<li> 34  city  id  ID_Y</li>\n<li> sort_buffer  name </li>\n<li> 1000 </li>\n</ol>\n<p> name  sort_buffer_size</p>\n<p>sort_buffer_size MySQL sort_buffer sort_buffer_size</p>\n<p></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* optimizer_trace */</span></span><br><span class=\"line\"><span class=\"keyword\">SET</span> optimizer_trace<span class=\"operator\">=</span><span class=\"string\">&#x27;enabled=on&#x27;</span>; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* @aInnodb_rows_read */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@a</span> <span class=\"keyword\">from</span>  performance_schema.session_status <span class=\"keyword\">where</span> variable_name <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_rows_read&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*  */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> city, name,age <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> city<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> name limit <span class=\"number\">1000</span>; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*  OPTIMIZER_TRACE  */</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> `information_schema`.`OPTIMIZER_TRACE`\\G</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* @bInnodb_rows_read */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> VARIABLE_VALUE <span class=\"keyword\">into</span> <span class=\"variable\">@b</span> <span class=\"keyword\">from</span> performance_schema.session_status <span class=\"keyword\">where</span> variable_name <span class=\"operator\">=</span> <span class=\"string\">&#x27;Innodb_rows_read&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* Innodb_rows_read */</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@b</span><span class=\"operator\">-</span><span class=\"variable\">@a</span>;</span><br></pre></td></tr></table></figure>\n<p> OPTIMIZER_TRACE  number_of_tmp_files <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648564689820-6f0d8fa4-6687-4e4f-ad20-5e6a1d4a1280.png#averageHue=%23090109&clientId=ub49b8c3b-28e5-4&from=paste&id=ud81073ab&originHeight=183&originWidth=713&originalType=url&ratio=1&rotation=0&showTitle=false&size=103799&status=done&style=none&taskId=ufc87cf83-e1f6-4102-90a8-7243ba19e13&title=\" alt=\"image.png\"><br>number_of_tmp_files  12 MySQL  12  12 </p>\n<p> sort_buffer_size number_of_tmp_files  0</p>\n<p><strong>sort_buffer_size </strong>number_of_tmp_files sort_buffer_sizesort_buffer_size</p>\n<p><strong>examined_rows&#x3D;4000 4000 </strong></p>\n<p><strong>sort_mode  packed_additional_fields  name  varchar(16)</strong></p>\n<p><strong> select @b-@a  4000 4000 </strong></p>\n<h3 id=\"rowid-\"><a href=\"#rowid-\" class=\"headerlink\" title=\"rowid \"></a>rowid </h3><p> sort_buffer <strong> sort_buffer </strong></p>\n<p></p>\n<p> MySQL ?</p>\n<p> MySQL </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SET</span> max_length_for_sort_data <span class=\"operator\">=</span> <span class=\"number\">16</span>;</span><br></pre></td></tr></table></figure>\n<p>MySQL MySQL </p>\n<p> sort_buffer  name  id</p>\n<p> city  age </p>\n<ol>\n<li> sort_buffer name  id</li>\n<li> city  city&#x3D; id ID_X</li>\n<li> id  nameid  sort_buffer </li>\n<li> city  id</li>\n<li> 34  city&#x3D; ID_Y</li>\n<li> sort_buffer  name </li>\n<li> 1000  id  cityname  age </li>\n</ol>\n<p>rowid  t  7</p>\n<p> MySQL  sort_buffer  id cityname  age <code></code></p>\n<p><strong>rowid  OPTIMIZER_TRACE </strong><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566128890-cf3076d8-183b-4f66-95fb-6db07943954f.png#averageHue=%23080109&clientId=ub49b8c3b-28e5-4&from=paste&id=u025fd973&originHeight=183&originWidth=468&originalType=url&ratio=1&rotation=0&showTitle=false&size=93232&status=done&style=none&taskId=uaae4be2c-c501-4cc6-b296-5a9fed1e59a&title=\" alt=\"image.png\"><br><strong>select @b-@a  5000 </strong> id  limit 1000 1000 </p>\n<p><strong>sort_mode  &lt;sort_key, rowid&gt;</strong> name  id </p>\n<p><strong>number_of_tmp_files  10 </strong> 4000 </p>\n<p> MySQL  rowid </p>\n<p> MySQL  sort_buffer </p>\n<p> MySQL <strong></strong></p>\n<p> order by MySQL <strong></strong></p>\n<p> city  name </p>\n<p> city  name <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566346093-471e3c9b-0b83-4c38-95cd-1c6b5d7f58ca.png#averageHue=%23f0efe8&clientId=ub49b8c3b-28e5-4&from=paste&id=u9d957077&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=250929&status=done&style=none&taskId=ub68238d3-09db-4d04-9d04-8aa7a1bb945&title=\" alt=\"image.png\"><br> city&#x3D; city name </p>\n<p></p>\n<ol>\n<li> (city,name)  city&#x3D; id</li>\n<li> id  namecityage </li>\n<li> (city,name)  id 23</li>\n<li> 1000  city&#x3D;</li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566428823-b2716a19-cb2c-48a4-a0ad-94552cf1ae7d.png#averageHue=%2307020a&clientId=ub49b8c3b-28e5-4&from=paste&id=u30022e94&originHeight=127&originWidth=1382&originalType=url&ratio=1&rotation=0&showTitle=true&size=250223&status=done&style=none&taskId=u72da902c-04e1-462b-87e2-4c65adca397&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\" alt=\" (city,name) \" title=\" (city,name) \"><br><code>rows,Using index condition ICP</code> </p>\n<p>Extra  Using filesort  (city,name)  4000  1000 <strong> 1000 </strong></p>\n<p> cityname  age </p>\n<p> cit\ty  name </p>\n<ol>\n<li> (city,name,age)  city&#x3D; cityname  age </li>\n<li> (city,name,age) </li>\n<li> 2 1000  city&#x3D;</li>\n</ol>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648566612447-97a4f6c2-8f67-4a0b-8614-eb63ab8093aa.png#averageHue=%2306030d&clientId=ub49b8c3b-28e5-4&from=paste&id=ufc70bd2c&originHeight=125&originWidth=1586&originalType=url&ratio=1&rotation=0&showTitle=true&size=266076&status=done&style=none&taskId=u3093dc9d-f32b-4b81-b102-2d08dd4fe1b&title=%E5%BC%95%E5%85%A5%20%28city%2Cname%2Cage%29%20%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%90%8E%EF%BC%8C%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\" alt=\" (city,name,age) \" title=\" (city,name,age) \">Extra Using index</p>\n<h2 id=\"order-by-rand\"><a href=\"#order-by-rand\" class=\"headerlink\" title=\"order by rand()\"></a>order by rand()</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> word <span class=\"keyword\">from</span> words <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> rand() limit <span class=\"number\">3</span>;</span><br></pre></td></tr></table></figure>\n<p> 3  SQL </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648802439889-2e2907be-5fc4-411a-b79f-f9a29153b597.png#averageHue=%2308020a&clientId=ud645e606-5915-4&from=paste&id=u14caa359&originHeight=142&originWidth=1553&originalType=url&ratio=1&rotation=0&showTitle=false&size=269434&status=done&style=none&taskId=uc50316d7-c136-4ce7-92d6-3c16c7a8496&title=\" alt=\"image.png\"><br>Extra  Using temporaryUsing filesort</p>\n<p> InnoDB <br>MySQL  rowid </p>\n<p>:</p>\n<ol>\n<li> memory  double  R varchar(64)  W</li>\n<li> words  word  word  rand()  0  1  word  R  W  10000</li>\n<li> 10000  R </li>\n<li> sort_buffersort_buffer  double </li>\n<li> R  sort_buffer  10000 20000</li>\n<li> sort_buffer  R </li>\n<li> word  20003</li>\n</ol>\n<p> InnoDB  6  rowid rowid  InnoDB  rowid  ID InnoDB  rowid MEMORY  rowid </p>\n<p><strong>order by rand()  rowid </strong></p>\n<p><strong></strong></p>\n<p>**tmp_table_size ** 16M tmp_table_size</p>\n<p> InnoDB <strong>internal_tmp_disk_storage_engine</strong> <br> InnoDB </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> SQL  R  3  rowid 3  10000  9997 </p>\n<p><code></code></p>\n<ul>\n<li> 10000  (R,rowid)</li>\n<li> (R,rowid) R  R R (R,rowid)  (R,rowid)</li>\n<li> 2  10000  (R,rowid) </li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> city,name,age <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> city<span class=\"operator\">=</span><span class=\"string\">&#x27;&#x27;</span> <span class=\"keyword\">order</span> <span class=\"keyword\">by</span> name limit <span class=\"number\">1000</span>  ;</span><br></pre></td></tr></table></figure>\n<p> limit SQL  limit 1000 1000  (name,rowid) sort_buffer_size <code>limit 3 sort_buffer_size </code></p>\n<h2 id=\"group-by\"><a href=\"#group-by\" class=\"headerlink\" title=\"group by\"></a>group by</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> t1(id <span class=\"type\">int</span> <span class=\"keyword\">primary</span> key, a <span class=\"type\">int</span>, b <span class=\"type\">int</span>, index(a));</span><br><span class=\"line\">delimiter ;;</span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> idata()</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  <span class=\"keyword\">declare</span> i <span class=\"type\">int</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">set</span> i<span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br><span class=\"line\">  while(i<span class=\"operator\">&lt;=</span><span class=\"number\">1000</span>)do</span><br><span class=\"line\">    <span class=\"keyword\">insert</span> <span class=\"keyword\">into</span> t1 <span class=\"keyword\">values</span>(i, i, i);</span><br><span class=\"line\">    <span class=\"keyword\">set</span> i<span class=\"operator\">=</span>i<span class=\"operator\">+</span><span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">end</span> while;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;;</span><br><span class=\"line\">delimiter ;</span><br><span class=\"line\"><span class=\"keyword\">call</span> idata();</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> id<span class=\"operator\">%</span><span class=\"number\">10</span> <span class=\"keyword\">as</span> m, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> c <span class=\"keyword\">from</span> t1 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> m;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112503277-b1df9ad1-1d95-417a-b8e9-48a390770a29.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=ua744d424&originHeight=143&originWidth=1702&originalType=url&ratio=1&rotation=0&showTitle=false&size=30065&status=done&style=none&taskId=u53a60222-d9e4-44f3-a5c7-c090d7a9176&title=\" alt=\"image.png\"><br> Extra </p>\n<ul>\n<li>Using index a</li>\n</ul>\n<p><code>selectidaa  mysqla</code></p>\n<ul>\n<li>Using temporary</li>\n<li>Using filesort</li>\n</ul>\n<p>:</p>\n<ul>\n<li> m  c m</li>\n<li> t1  a id  id%10  x</li>\n<li> x  (x,1);</li>\n<li> x  x  c  1 m </li>\n</ul>\n<h3 id=\"group-by---\"><a href=\"#group-by---\" class=\"headerlink\" title=\"group by   \"></a><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651112629688-9b998014-3798-4028-931b-9518eb10ce2a.png#averageHue=%23eceee3&clientId=ud1598026-e3a9-4&from=paste&id=u878ce08e&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=184375&status=done&style=none&taskId=ub60c1c98-b904-4010-937c-eea5dfc94e9&title=\" alt=\"image.png\">group by   </h3><p>group by  group by </p>\n<p><strong> group by </strong><br>group by  id%100 </p>\n<p><br>group by </p>\n<h3 id=\"group-by---\"><a href=\"#group-by---\" class=\"headerlink\" title=\"group by   \"></a>group by   </h3><p> group by  group by </p>\n<p> group by  SQL_BIG_RESULT hint</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> SQL_BIG_RESULT id<span class=\"operator\">%</span><span class=\"number\">100</span> <span class=\"keyword\">as</span> m, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">as</span> c <span class=\"keyword\">from</span> t1 <span class=\"keyword\">group</span> <span class=\"keyword\">by</span> m;</span><br></pre></td></tr></table></figure>\n<p>MySQL  B+ <br></p>\n<ul>\n<li> sort_buffer m</li>\n<li> t1  a id ,  id%100  sort_buffer </li>\n<li> sort_buffer  m  sort_buffer </li>\n<li></li>\n</ul>\n<p><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113519486-bb3649d2-8c16-4e6a-8062-50510591e8a6.png#averageHue=%23ecede2&clientId=ud1598026-e3a9-4&from=paste&id=u6443cf73&originHeight=880&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=false&size=210067&status=done&style=none&taskId=u0c92938c-024f-4ede-8a67-6aa3e16f37b&title=\" alt=\"image.png\"><br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1651113533494-091befc2-665e-42da-a822-2fa5fc25cb92.png#averageHue=%23090109&clientId=ud1598026-e3a9-4&from=paste&id=u68823f55&originHeight=131&originWidth=1393&originalType=url&ratio=1&rotation=0&showTitle=false&size=26738&status=done&style=none&taskId=u04fcce2b-a93b-4148-a3cf-bb5c45ac1b9&title=\" alt=\"image.png\"><br> Extra <br><strong> group by  tmp_table_size </strong></p>\n<h3 id=\"MySQL-\"><a href=\"#MySQL-\" class=\"headerlink\" title=\"MySQL \"></a>MySQL </h3><ol>\n<li></li>\n<li>join_buffer sort_buffer </li>\n<li>union  group by </li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">from</span> tradelog <span class=\"keyword\">where</span> <span class=\"keyword\">month</span>(t_modified)<span class=\"operator\">=</span><span class=\"number\">7</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">t_modified</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>sql MySQL <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822518074-948569d9-c7f4-49f5-9441-51b175a23451.png#averageHue=%23f0f1e8&clientId=ud5261830-7282-4&from=paste&id=ua20d9e1f&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=191123&status=done&style=none&taskId=u64ba332a-9084-4148-a92a-ecdce1abbba&title=t_modified%20%E7%B4%A2%E5%BC%95%E7%A4%BA%E6%84%8F%E5%9B%BE\" alt=\"t_modified \" title=\"t_modified \"><br> SQL  where t_modified&#x3D;2018-7-1 t_modified&#x3D;2018-7-1<br><strong> month()  7 </strong></p>\n<p><strong></strong><br></p>\n<p> t_modified t_modified  t_modified\t\t</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648822684575-4deb9a96-f251-4f0c-a536-19871141453c.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=u523bd677&originHeight=143&originWidth=1637&originalType=url&ratio=1&rotation=0&showTitle=true&size=30107&status=done&style=none&taskId=u05bb406e-1cdf-4bce-933e-d07153bbc8c&title=explain%E7%BB%93%E6%9E%9C\" alt=\"explain\" title=\"explain\"><br><code> select * from tradelog where id + 1 = 10000  SQL  1  MySQL  id  9999  SQL  where id = 10000 -1 </code></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> tradelog <span class=\"keyword\">where</span> tradeid<span class=\"operator\">=</span><span class=\"number\">110717</span>;</span><br><span class=\"line\">tradeid</span><br><span class=\"line\">tradeid  <span class=\"type\">varchar</span>(<span class=\"number\">32</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">tradelog </span><br></pre></td></tr></table></figure>\n<p>explain <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648823298719-44df7f75-794e-4dc6-ac68-e1be2aee1bf7.png#averageHue=%23090109&clientId=ud5261830-7282-4&from=paste&id=uf55b0bbd&originHeight=142&originWidth=289&originalType=url&ratio=1&rotation=0&showTitle=false&size=6704&status=done&style=none&taskId=u73751b53-f437-460b-90a1-85cdf341157&title=\" alt=\"image.png\"><br>select 10 &gt; 9  1 MySQL  MySQL <br><code>ascii 101ascii90</code></p>\n<p>sql</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> tradelog <span class=\"keyword\">where</span>  <span class=\"built_in\">CAST</span>(tradid <span class=\"keyword\">AS</span> signed <span class=\"type\">int</span>) <span class=\"operator\">=</span> <span class=\"number\">110717</span>;</span><br></pre></td></tr></table></figure>\n<p></p>\n<h2 id=\"select-\"><a href=\"#select-\" class=\"headerlink\" title=\"select \"></a>select </h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n<p></p>\n<p> t  show processlist </p>\n<h3 id=\"MDL\"><a href=\"#MDL\" class=\"headerlink\" title=\"MDL\"></a>MDL</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878603446-1b67ed04-aa0f-4961-bdb2-c048db08684d.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=u6b91757f&originHeight=213&originWidth=1312&originalType=url&ratio=1&rotation=0&showTitle=true&size=295984&status=done&style=none&taskId=ua6b64a57-39e2-4f8b-a20b-acb19d0de19&title=Waiting%20for%20table%20metadata%20lock\" alt=\"Waiting for table metadata lock\" title=\"Waiting for table metadata lock\"><br> t  MDL  select </p>\n<p> show processlist session A  Command Sleep performance_schema  sys MySQL  performance_schema&#x3D;on off  10% )</p>\n<p> <strong>sys.schema_table_lock_waits</strong>  process id kill <br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648878943676-cb1e66f6-9274-4266-8aa5-3473ff341e1b.png#averageHue=%23f7f7f7&clientId=u9da0f65c-5a8c-4&from=paste&id=ud724efe0&originHeight=251&originWidth=940&originalType=url&ratio=1&rotation=0&showTitle=false&size=83355&status=done&style=none&taskId=u8346b506-65e9-42ee-b198-0ecd2158dde&title=\" alt=\"image.png\"></p>\n<h3 id=\"flush\"><a href=\"#flush\" class=\"headerlink\" title=\"flush\"></a>flush</h3><p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648879417166-43881340-f096-4563-b5e4-9bc5829cc62b.png#averageHue=%2308010a&clientId=u9da0f65c-5a8c-4&from=paste&id=u25a60694&originHeight=147&originWidth=1221&originalType=url&ratio=1&rotation=0&showTitle=true&size=221669&status=done&style=none&taskId=u5a5b1b06-1adc-4505-9c55-cfed57c8142&title=Waiting%20for%20table%20flush\" alt=\"Waiting for table flush\" title=\"Waiting for table flush\"><br> t  flush MySQL  flush </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flush tables t <span class=\"keyword\">with</span> read lock;</span><br><span class=\"line\">flush tables <span class=\"keyword\">with</span> read lock;</span><br></pre></td></tr></table></figure>\n<p> flush  t  t MySQL </p>\n<p></p>\n<p> Waiting for table flush  flush tables  select <br> flush</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> lock <span class=\"keyword\">in</span> share mode;</span><br></pre></td></tr></table></figure>\n<p> id&#x3D;1  select </p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648881044186-e94acc20-7f4a-4b13-8ce4-9f73b9518af8.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=uc3a1df43&originHeight=223&originWidth=1285&originalType=url&ratio=1&rotation=0&showTitle=false&size=291379&status=done&style=none&taskId=u1c9e4b89-2356-43cb-aef5-c8285c293e0&title=\" alt=\"image.png\"></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql<span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t sys.innodb_lock_waits <span class=\"keyword\">where</span> locked_table<span class=\"operator\">=</span><span class=\"string\">&#x27;`test`.`t`&#x27;</span>\\G</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883270487-dab3c3c5-e153-4d52-a60a-71f1fe51fcea.png#averageHue=%23080109&clientId=u9da0f65c-5a8c-4&from=paste&id=ued0ab6db&originHeight=669&originWidth=864&originalType=url&ratio=1&rotation=0&showTitle=true&size=580038&status=done&style=none&taskId=u3b80a197-9c94-402c-937a-19cb179068a&title=%E9%80%9A%E8%BF%87%20sys.innodb_lock_waits%20%E6%9F%A5%E8%A1%8C%E9%94%81\" alt=\" sys.innodb_lock_waits \" title=\" sys.innodb_lock_waits \">4  KILL QUERY 4  KILL 4KILL QUERY 4 4  update  KILL QUERY id&#x3D;1 </p>\n<p>KILL 4  id&#x3D;1 </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span>   <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t <span class=\"keyword\">where</span> id<span class=\"operator\">=</span><span class=\"number\">1</span> lock <span class=\"keyword\">in</span> share mode  <span class=\"number\">1000001</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883585247-7e59dcec-0278-410b-82ab-1025272a021c.png#averageHue=%23f9f9f9&clientId=u9da0f65c-5a8c-4&from=paste&id=udaac8027&originHeight=322&originWidth=936&originalType=url&ratio=1&rotation=0&showTitle=false&size=52745&status=done&style=none&taskId=udb5dcded-28c0-407c-becc-849e1a9f50d&title=\" alt=\"image.png\"><br>sessionBsessionAsessionBundo log<br><img src=\"https://cdn.nlark.com/yuque/0/2022/png/22451783/1648883707434-705f7d40-60d4-4ffa-8029-406518fe2664.png#averageHue=%23edefe3&clientId=u9da0f65c-5a8c-4&from=paste&id=uccb7b493&originHeight=856&originWidth=1142&originalType=url&ratio=1&rotation=0&showTitle=true&size=215323&status=done&style=none&taskId=u3ead1e96-17fc-4831-b8f7-da92f1c225f&title=%E7%AC%AC%E4%B8%80%E4%B8%AAselect%E9%9C%80%E8%A6%81%E5%9B%9E%E6%BB%9A100w%E6%AC%A1%E6%89%8D%E8%83%BD%E5%B0%86%E8%BF%99%E4%B8%AA%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E\" alt=\"select100w\" title=\"select100w\"><code> lock in share mode  SQL  1000001 </code><br><code>undo log  2  1 3  2</code></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h2>"}],"PostAsset":[],"PostCategory":[],"PostTag":[],"Tag":[]}}